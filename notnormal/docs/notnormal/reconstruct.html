<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>notnormal.reconstruct API documentation</title>
            <link rel="icon" href="assets\logo.png"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../notnormal.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;notnormal</a>

            <img src="assets\logo.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#augment_clusters">augment_clusters</a>
            </li>
            <li>
                    <a class="function" href="#fit_noise">fit_noise</a>
            </li>
            <li>
                    <a class="function" href="#generate_noise">generate_noise</a>
            </li>
            <li>
                    <a class="function" href="#piecwise_fit_noise">piecwise_fit_noise</a>
            </li>
            <li>
                    <a class="function" href="#reconstruct_noise">reconstruct_noise</a>
            </li>
            <li>
                    <a class="function" href="#shape_cluster">shape_cluster</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../notnormal.html">notnormal</a><wbr>.reconstruct    </h1>

                
                        <input id="mod-reconstruct-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-reconstruct-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="c1"># Auto-generated __init__.py file.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.events</span><span class="w"> </span><span class="kn">import</span> <span class="n">shape_cluster</span><span class="p">,</span> <span class="n">augment_clusters</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.noise</span><span class="w"> </span><span class="kn">import</span> <span class="n">reconstruct_noise</span><span class="p">,</span> <span class="n">fit_noise</span><span class="p">,</span> <span class="n">piecwise_fit_noise</span><span class="p">,</span> <span class="n">generate_noise</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a>    <span class="s2">&quot;augment_clusters&quot;</span><span class="p">,</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a>    <span class="s2">&quot;fit_noise&quot;</span><span class="p">,</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a>    <span class="s2">&quot;generate_noise&quot;</span><span class="p">,</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a>    <span class="s2">&quot;piecwise_fit_noise&quot;</span><span class="p">,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a>    <span class="s2">&quot;reconstruct_noise&quot;</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a>    <span class="s2">&quot;shape_cluster&quot;</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="augment_clusters">
                            <input id="augment_clusters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">augment_clusters</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">clusters</span><span class="p">:</span> <span class="n"><a href="models.html#ShapeClusters">notnormal.models.ShapeClusters</a></span>,</span><span class="param">	<span class="n">n_vectors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>,</span><span class="param">	<span class="n">weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span>,</span><span class="param">	<span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_attempts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>,</span><span class="param">	<span class="n">sample_global</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">dist_losses</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n"><a href="models.html#ShapeClusters">notnormal.models.ShapeClusters</a></span>:</span></span>

                <label class="view-source-button" for="augment_clusters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#augment_clusters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="augment_clusters-146"><a href="#augment_clusters-146"><span class="linenos">146</span></a><span class="k">def</span><span class="w"> </span><span class="nf">augment_clusters</span><span class="p">(</span>
</span><span id="augment_clusters-147"><a href="#augment_clusters-147"><span class="linenos">147</span></a>    <span class="n">clusters</span><span class="p">:</span> <span class="n">ShapeClusters</span><span class="p">,</span>
</span><span id="augment_clusters-148"><a href="#augment_clusters-148"><span class="linenos">148</span></a>    <span class="n">n_vectors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="augment_clusters-149"><a href="#augment_clusters-149"><span class="linenos">149</span></a>    <span class="n">max_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="augment_clusters-150"><a href="#augment_clusters-150"><span class="linenos">150</span></a>    <span class="n">weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="p">,</span>
</span><span id="augment_clusters-151"><a href="#augment_clusters-151"><span class="linenos">151</span></a>    <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="augment_clusters-152"><a href="#augment_clusters-152"><span class="linenos">152</span></a>    <span class="n">max_attempts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="augment_clusters-153"><a href="#augment_clusters-153"><span class="linenos">153</span></a>    <span class="n">sample_global</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="augment_clusters-154"><a href="#augment_clusters-154"><span class="linenos">154</span></a>    <span class="n">dist_losses</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="augment_clusters-155"><a href="#augment_clusters-155"><span class="linenos">155</span></a>    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="augment_clusters-156"><a href="#augment_clusters-156"><span class="linenos">156</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ShapeClusters</span><span class="p">:</span>
</span><span id="augment_clusters-157"><a href="#augment_clusters-157"><span class="linenos">157</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="augment_clusters-158"><a href="#augment_clusters-158"><span class="linenos">158</span></a><span class="sd">    Augment the event vectors using the representative vectors and scaling features derived from both local and global</span>
</span><span id="augment_clusters-159"><a href="#augment_clusters-159"><span class="linenos">159</span></a><span class="sd">    models. This function extends shape clustering by generating new event vectors based on the representative vectors</span>
</span><span id="augment_clusters-160"><a href="#augment_clusters-160"><span class="linenos">160</span></a><span class="sd">    (which encode the shapes in the population and their density) and the scales at which those shapes are observed.</span>
</span><span id="augment_clusters-161"><a href="#augment_clusters-161"><span class="linenos">161</span></a><span class="sd">    Distributional estimates of the global scaling features enables sampling of new scales that are consistent with the</span>
</span><span id="augment_clusters-162"><a href="#augment_clusters-162"><span class="linenos">162</span></a><span class="sd">    shape agnostic scaling features, providing an accurate representation of the overall population. Cluster specific</span>
</span><span id="augment_clusters-163"><a href="#augment_clusters-163"><span class="linenos">163</span></a><span class="sd">    (local) estimates enables sampling of scales consistent with each specific shape (representative vector), but</span>
</span><span id="augment_clusters-164"><a href="#augment_clusters-164"><span class="linenos">164</span></a><span class="sd">    provide a less accurate estimate under the sparser subset of events. By using density aware rejection sampling on</span>
</span><span id="augment_clusters-165"><a href="#augment_clusters-165"><span class="linenos">165</span></a><span class="sd">    both global and local models, scaling features can be sampled which respect both the overall and shape specific</span>
</span><span id="augment_clusters-166"><a href="#augment_clusters-166"><span class="linenos">166</span></a><span class="sd">    distribution of scales. In this way, augmented events can be generated which respect shape, the scales those shapes</span>
</span><span id="augment_clusters-167"><a href="#augment_clusters-167"><span class="linenos">167</span></a><span class="sd">    are observed at, and the distribution of scales in the entire population. Note, the sample_global parameter controls</span>
</span><span id="augment_clusters-168"><a href="#augment_clusters-168"><span class="linenos">168</span></a><span class="sd">    which model is sampled from, with samples being accepted if the log likelihood ratio between the not sampled and</span>
</span><span id="augment_clusters-169"><a href="#augment_clusters-169"><span class="linenos">169</span></a><span class="sd">    sampled models exceeds a threshold. When True, the local model has a higher weighting, when False, the global</span>
</span><span id="augment_clusters-170"><a href="#augment_clusters-170"><span class="linenos">170</span></a><span class="sd">    model has a higher weighting, see: _sample_log_method.</span>
</span><span id="augment_clusters-171"><a href="#augment_clusters-171"><span class="linenos">171</span></a>
</span><span id="augment_clusters-172"><a href="#augment_clusters-172"><span class="linenos">172</span></a><span class="sd">    Args:</span>
</span><span id="augment_clusters-173"><a href="#augment_clusters-173"><span class="linenos">173</span></a><span class="sd">        clusters (ShapeClusters): An object containing the clustering results.</span>
</span><span id="augment_clusters-174"><a href="#augment_clusters-174"><span class="linenos">174</span></a><span class="sd">        n_vectors (int | None): The number of vectors to generate. If None, one generation will occur per event in</span>
</span><span id="augment_clusters-175"><a href="#augment_clusters-175"><span class="linenos">175</span></a><span class="sd">            ShapeClusters. Default is None.</span>
</span><span id="augment_clusters-176"><a href="#augment_clusters-176"><span class="linenos">176</span></a><span class="sd">        max_k (int): The maximum number of components to fit (scaling features). Default is 50.</span>
</span><span id="augment_clusters-177"><a href="#augment_clusters-177"><span class="linenos">177</span></a><span class="sd">        weight (float): The weight concentration prior for the Dirichlet Process (scaling features). Default is 1e-2.</span>
</span><span id="augment_clusters-178"><a href="#augment_clusters-178"><span class="linenos">178</span></a><span class="sd">        random_state (int | None): Random seed for reproducibility (scaling features only). Default is None.</span>
</span><span id="augment_clusters-179"><a href="#augment_clusters-179"><span class="linenos">179</span></a><span class="sd">        max_attempts (int): The maximum number of attempts to sample a candidate. Default is 100.</span>
</span><span id="augment_clusters-180"><a href="#augment_clusters-180"><span class="linenos">180</span></a><span class="sd">        sample_global (bool): Whether to sample from the global model or the local model. Default is True.</span>
</span><span id="augment_clusters-181"><a href="#augment_clusters-181"><span class="linenos">181</span></a><span class="sd">        dist_losses (bool): Whether to compute the augmentation distributional losses. Default is True.</span>
</span><span id="augment_clusters-182"><a href="#augment_clusters-182"><span class="linenos">182</span></a><span class="sd">        verbose (bool): Whether to print verbose output during processing. Default is False.</span>
</span><span id="augment_clusters-183"><a href="#augment_clusters-183"><span class="linenos">183</span></a>
</span><span id="augment_clusters-184"><a href="#augment_clusters-184"><span class="linenos">184</span></a><span class="sd">    Returns:</span>
</span><span id="augment_clusters-185"><a href="#augment_clusters-185"><span class="linenos">185</span></a><span class="sd">        ShapeClusters: The input clustering results with augmentation results added.</span>
</span><span id="augment_clusters-186"><a href="#augment_clusters-186"><span class="linenos">186</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="augment_clusters-187"><a href="#augment_clusters-187"><span class="linenos">187</span></a>
</span><span id="augment_clusters-188"><a href="#augment_clusters-188"><span class="linenos">188</span></a>    <span class="c1"># Get args</span>
</span><span id="augment_clusters-189"><a href="#augment_clusters-189"><span class="linenos">189</span></a>    <span class="n">clusters</span><span class="o">.</span><span class="n">aug_args</span> <span class="o">=</span> <span class="n">EventAugmentationArgs</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">EventAugmentationArgs</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">})</span>
</span><span id="augment_clusters-190"><a href="#augment_clusters-190"><span class="linenos">190</span></a>
</span><span id="augment_clusters-191"><a href="#augment_clusters-191"><span class="linenos">191</span></a>    <span class="c1"># Fit scaling features to the clusters</span>
</span><span id="augment_clusters-192"><a href="#augment_clusters-192"><span class="linenos">192</span></a>    <span class="n">clusters</span> <span class="o">=</span> <span class="n">_fit_scaling_features</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="n">max_k</span><span class="o">=</span><span class="n">max_k</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="augment_clusters-193"><a href="#augment_clusters-193"><span class="linenos">193</span></a>
</span><span id="augment_clusters-194"><a href="#augment_clusters-194"><span class="linenos">194</span></a>    <span class="c1"># Augment the event vectors</span>
</span><span id="augment_clusters-195"><a href="#augment_clusters-195"><span class="linenos">195</span></a>    <span class="n">clusters</span> <span class="o">=</span> <span class="n">_augment_vectors</span><span class="p">(</span>
</span><span id="augment_clusters-196"><a href="#augment_clusters-196"><span class="linenos">196</span></a>        <span class="n">clusters</span><span class="p">,</span>
</span><span id="augment_clusters-197"><a href="#augment_clusters-197"><span class="linenos">197</span></a>        <span class="n">n_vectors</span><span class="o">=</span><span class="n">n_vectors</span><span class="p">,</span>
</span><span id="augment_clusters-198"><a href="#augment_clusters-198"><span class="linenos">198</span></a>        <span class="n">max_attempts</span><span class="o">=</span><span class="n">max_attempts</span><span class="p">,</span>
</span><span id="augment_clusters-199"><a href="#augment_clusters-199"><span class="linenos">199</span></a>        <span class="n">sample_global</span><span class="o">=</span><span class="n">sample_global</span><span class="p">,</span>
</span><span id="augment_clusters-200"><a href="#augment_clusters-200"><span class="linenos">200</span></a>        <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
</span><span id="augment_clusters-201"><a href="#augment_clusters-201"><span class="linenos">201</span></a>        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="augment_clusters-202"><a href="#augment_clusters-202"><span class="linenos">202</span></a>    <span class="p">)</span>
</span><span id="augment_clusters-203"><a href="#augment_clusters-203"><span class="linenos">203</span></a>
</span><span id="augment_clusters-204"><a href="#augment_clusters-204"><span class="linenos">204</span></a>    <span class="c1"># Calculate distributional losses if requested</span>
</span><span id="augment_clusters-205"><a href="#augment_clusters-205"><span class="linenos">205</span></a>    <span class="k">if</span> <span class="n">dist_losses</span><span class="p">:</span>
</span><span id="augment_clusters-206"><a href="#augment_clusters-206"><span class="linenos">206</span></a>        <span class="n">clusters</span><span class="o">.</span><span class="n">aug_distributional_loss</span> <span class="o">=</span> <span class="n">_distributional_loss</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="n">recon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="augment_clusters-207"><a href="#augment_clusters-207"><span class="linenos">207</span></a>
</span><span id="augment_clusters-208"><a href="#augment_clusters-208"><span class="linenos">208</span></a>    <span class="k">return</span> <span class="n">clusters</span>
</span></pre></div>


            <div class="docstring"><p>Augment the event vectors using the representative vectors and scaling features derived from both local and global
models. This function extends shape clustering by generating new event vectors based on the representative vectors
(which encode the shapes in the population and their density) and the scales at which those shapes are observed.
Distributional estimates of the global scaling features enables sampling of new scales that are consistent with the
shape agnostic scaling features, providing an accurate representation of the overall population. Cluster specific
(local) estimates enables sampling of scales consistent with each specific shape (representative vector), but
provide a less accurate estimate under the sparser subset of events. By using density aware rejection sampling on
both global and local models, scaling features can be sampled which respect both the overall and shape specific
distribution of scales. In this way, augmented events can be generated which respect shape, the scales those shapes
are observed at, and the distribution of scales in the entire population. Note, the sample_global parameter controls
which model is sampled from, with samples being accepted if the log likelihood ratio between the not sampled and
sampled models exceeds a threshold. When True, the local model has a higher weighting, when False, the global
model has a higher weighting, see: _sample_log_method.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>clusters (ShapeClusters):</strong>  An object containing the clustering results.</li>
<li><strong>n_vectors (int | None):</strong>  The number of vectors to generate. If None, one generation will occur per event in
ShapeClusters. Default is None.</li>
<li><strong>max_k (int):</strong>  The maximum number of components to fit (scaling features). Default is 50.</li>
<li><strong>weight (float):</strong>  The weight concentration prior for the Dirichlet Process (scaling features). Default is 1e-2.</li>
<li><strong>random_state (int | None):</strong>  Random seed for reproducibility (scaling features only). Default is None.</li>
<li><strong>max_attempts (int):</strong>  The maximum number of attempts to sample a candidate. Default is 100.</li>
<li><strong>sample_global (bool):</strong>  Whether to sample from the global model or the local model. Default is True.</li>
<li><strong>dist_losses (bool):</strong>  Whether to compute the augmentation distributional losses. Default is True.</li>
<li><strong>verbose (bool):</strong>  Whether to print verbose output during processing. Default is False.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>ShapeClusters: The input clustering results with augmentation results added.</p>
</blockquote>
</div>


                </section>
                <section id="fit_noise">
                            <input id="fit_noise-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fit_noise</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">f</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">pxx</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">aa_order</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">aa_cutoff</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">n_regimes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>,</span><span class="param">	<span class="n">maxiter</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>,</span><span class="param">	<span class="n">popsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span>,</span><span class="param">	<span class="n">mutation</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>,</span><span class="param">	<span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><a href="models.html#NoiseFitResults">notnormal.models.NoiseFitResults</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="fit_noise-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#fit_noise"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="fit_noise-141"><a href="#fit_noise-141"><span class="linenos">141</span></a><span class="k">def</span><span class="w"> </span><span class="nf">fit_noise</span><span class="p">(</span>
</span><span id="fit_noise-142"><a href="#fit_noise-142"><span class="linenos">142</span></a>    <span class="n">f</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span>
</span><span id="fit_noise-143"><a href="#fit_noise-143"><span class="linenos">143</span></a>    <span class="n">pxx</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span>
</span><span id="fit_noise-144"><a href="#fit_noise-144"><span class="linenos">144</span></a>    <span class="n">aa_order</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="fit_noise-145"><a href="#fit_noise-145"><span class="linenos">145</span></a>    <span class="n">aa_cutoff</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="fit_noise-146"><a href="#fit_noise-146"><span class="linenos">146</span></a>    <span class="n">n_regimes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="fit_noise-147"><a href="#fit_noise-147"><span class="linenos">147</span></a>    <span class="n">maxiter</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span>
</span><span id="fit_noise-148"><a href="#fit_noise-148"><span class="linenos">148</span></a>    <span class="n">popsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
</span><span id="fit_noise-149"><a href="#fit_noise-149"><span class="linenos">149</span></a>    <span class="n">mutation</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">),</span>
</span><span id="fit_noise-150"><a href="#fit_noise-150"><span class="linenos">150</span></a>    <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="fit_noise-151"><a href="#fit_noise-151"><span class="linenos">151</span></a>    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="fit_noise-152"><a href="#fit_noise-152"><span class="linenos">152</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">NoiseFitResults</span><span class="p">]:</span>
</span><span id="fit_noise-153"><a href="#fit_noise-153"><span class="linenos">153</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="fit_noise-154"><a href="#fit_noise-154"><span class="linenos">154</span></a><span class="sd">    Fit noise regimes to the provided power spectral density (PSD) using global differential evolution optimisation</span>
</span><span id="fit_noise-155"><a href="#fit_noise-155"><span class="linenos">155</span></a><span class="sd">    followed by local L-BFGS-B optimisation. The fitting is done by minimising the sum of squared log error between the</span>
</span><span id="fit_noise-156"><a href="#fit_noise-156"><span class="linenos">156</span></a><span class="sd">    predicted and actual PSDs, taking into account the true anti-aliasing filter.</span>
</span><span id="fit_noise-157"><a href="#fit_noise-157"><span class="linenos">157</span></a>
</span><span id="fit_noise-158"><a href="#fit_noise-158"><span class="linenos">158</span></a><span class="sd">    Args:</span>
</span><span id="fit_noise-159"><a href="#fit_noise-159"><span class="linenos">159</span></a><span class="sd">        f (ndarray): The frequency array of the true noise.</span>
</span><span id="fit_noise-160"><a href="#fit_noise-160"><span class="linenos">160</span></a><span class="sd">        pxx (ndarray): The PSD array of the true noise.</span>
</span><span id="fit_noise-161"><a href="#fit_noise-161"><span class="linenos">161</span></a><span class="sd">        aa_order (int): The order of the anti-aliasing filter.</span>
</span><span id="fit_noise-162"><a href="#fit_noise-162"><span class="linenos">162</span></a><span class="sd">        aa_cutoff (int): The cutoff frequency for the anti-aliasing filter.</span>
</span><span id="fit_noise-163"><a href="#fit_noise-163"><span class="linenos">163</span></a><span class="sd">        n_regimes (int | list[int]): The number of noise regimes to fit or a list of noise regime numbers to fit. Default is (2, 3).</span>
</span><span id="fit_noise-164"><a href="#fit_noise-164"><span class="linenos">164</span></a><span class="sd">        maxiter (tuple[int, int]): The maximum number evaluations for differential evolution and L-BFGS-B. Default is (2000, 10000).</span>
</span><span id="fit_noise-165"><a href="#fit_noise-165"><span class="linenos">165</span></a><span class="sd">        popsize (int): The population size multiplier for differential evolution. Default is 500.</span>
</span><span id="fit_noise-166"><a href="#fit_noise-166"><span class="linenos">166</span></a><span class="sd">        mutation (tuple[float, float]): The mutation constant for differential evolution. Default is (0.7, 1.2).</span>
</span><span id="fit_noise-167"><a href="#fit_noise-167"><span class="linenos">167</span></a><span class="sd">        random_state (int | None): Random seed for reproducibility. Default is None.</span>
</span><span id="fit_noise-168"><a href="#fit_noise-168"><span class="linenos">168</span></a><span class="sd">        verbose (bool): Whether to print verbose output during processing. Default is False.</span>
</span><span id="fit_noise-169"><a href="#fit_noise-169"><span class="linenos">169</span></a>
</span><span id="fit_noise-170"><a href="#fit_noise-170"><span class="linenos">170</span></a><span class="sd">    Returns:</span>
</span><span id="fit_noise-171"><a href="#fit_noise-171"><span class="linenos">171</span></a><span class="sd">        dict[int, NoiseFitResults]: A dictionary of noise fitting results keyed by the number of regimes.</span>
</span><span id="fit_noise-172"><a href="#fit_noise-172"><span class="linenos">172</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="fit_noise-173"><a href="#fit_noise-173"><span class="linenos">173</span></a>
</span><span id="fit_noise-174"><a href="#fit_noise-174"><span class="linenos">174</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pxx</span><span class="p">):</span>
</span><span id="fit_noise-175"><a href="#fit_noise-175"><span class="linenos">175</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Frequency and PSD arrays must have the same length.&quot;</span><span class="p">)</span>
</span><span id="fit_noise-176"><a href="#fit_noise-176"><span class="linenos">176</span></a>
</span><span id="fit_noise-177"><a href="#fit_noise-177"><span class="linenos">177</span></a>    <span class="n">n_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_regimes</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_regimes</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">n_regimes</span><span class="p">)</span>
</span><span id="fit_noise-178"><a href="#fit_noise-178"><span class="linenos">178</span></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_list</span><span class="p">):</span>
</span><span id="fit_noise-179"><a href="#fit_noise-179"><span class="linenos">179</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of regimes must be at least 1.&quot;</span><span class="p">)</span>
</span><span id="fit_noise-180"><a href="#fit_noise-180"><span class="linenos">180</span></a>
</span><span id="fit_noise-181"><a href="#fit_noise-181"><span class="linenos">181</span></a>    <span class="c1"># Configure progress bar</span>
</span><span id="fit_noise-182"><a href="#fit_noise-182"><span class="linenos">182</span></a>    <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">n_list</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Fitting Noise&#39;</span><span class="p">,</span> <span class="n">bar_format</span><span class="o">=</span><span class="n">_BAR_FORMAT</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">)</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
</span><span id="fit_noise-183"><a href="#fit_noise-183"><span class="linenos">183</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="fit_noise-184"><a href="#fit_noise-184"><span class="linenos">184</span></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_list</span><span class="p">:</span>
</span><span id="fit_noise-185"><a href="#fit_noise-185"><span class="linenos">185</span></a>            <span class="c1"># Get logarithmic indices to reduce the number of points for fitting and bias towards lower frequencies</span>
</span><span id="fit_noise-186"><a href="#fit_noise-186"><span class="linenos">186</span></a>            <span class="n">log_indices</span> <span class="o">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)),</span> <span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">e</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="fit_noise-187"><a href="#fit_noise-187"><span class="linenos">187</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">log_indices</span><span class="p">]</span>
</span><span id="fit_noise-188"><a href="#fit_noise-188"><span class="linenos">188</span></a>            <span class="n">pxx</span> <span class="o">=</span> <span class="n">pxx</span><span class="p">[</span><span class="n">log_indices</span><span class="p">]</span>
</span><span id="fit_noise-189"><a href="#fit_noise-189"><span class="linenos">189</span></a>
</span><span id="fit_noise-190"><a href="#fit_noise-190"><span class="linenos">190</span></a>            <span class="c1"># Bessel power response for AA filter shaping</span>
</span><span id="fit_noise-191"><a href="#fit_noise-191"><span class="linenos">191</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">h_filter</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">(</span><span class="o">*</span><span class="n">bessel</span><span class="p">(</span><span class="n">aa_order</span><span class="p">,</span> <span class="n">aa_cutoff</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;ba&#39;</span><span class="p">),</span> <span class="n">worN</span><span class="o">=</span><span class="n">f</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">)</span>
</span><span id="fit_noise-192"><a href="#fit_noise-192"><span class="linenos">192</span></a>            <span class="n">p_filter</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">h_filter</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="fit_noise-193"><a href="#fit_noise-193"><span class="linenos">193</span></a>
</span><span id="fit_noise-194"><a href="#fit_noise-194"><span class="linenos">194</span></a>            <span class="c1"># Get the maximum possible C value 10 * (highest density, lowest frequency and highest exponent)</span>
</span><span id="fit_noise-195"><a href="#fit_noise-195"><span class="linenos">195</span></a>            <span class="n">c_max</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">pxx</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="fit_noise-196"><a href="#fit_noise-196"><span class="linenos">196</span></a>            <span class="c1"># Get the minimum possible C value 0.1 * (lowest density, highest frequency and lowest exponent)</span>
</span><span id="fit_noise-197"><a href="#fit_noise-197"><span class="linenos">197</span></a>            <span class="n">c_min</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="mf">0.01</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="n">pxx</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="fit_noise-198"><a href="#fit_noise-198"><span class="linenos">198</span></a>            <span class="c1"># [-2, 2] bounds to cover expected range of exponents, log(c_i) to improve numerical stability</span>
</span><span id="fit_noise-199"><a href="#fit_noise-199"><span class="linenos">199</span></a>            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="n">c_min</span><span class="p">,</span> <span class="n">c_max</span><span class="p">)]</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="p">[(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">n</span>
</span><span id="fit_noise-200"><a href="#fit_noise-200"><span class="linenos">200</span></a>
</span><span id="fit_noise-201"><a href="#fit_noise-201"><span class="linenos">201</span></a>            <span class="c1"># Global optimization to get initial guesses</span>
</span><span id="fit_noise-202"><a href="#fit_noise-202"><span class="linenos">202</span></a>            <span class="n">global_opt</span> <span class="o">=</span> <span class="n">differential_evolution</span><span class="p">(</span>
</span><span id="fit_noise-203"><a href="#fit_noise-203"><span class="linenos">203</span></a>                <span class="n">_objective</span><span class="p">,</span>
</span><span id="fit_noise-204"><a href="#fit_noise-204"><span class="linenos">204</span></a>                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
</span><span id="fit_noise-205"><a href="#fit_noise-205"><span class="linenos">205</span></a>                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">pxx</span><span class="p">,</span> <span class="n">p_filter</span><span class="p">),</span>
</span><span id="fit_noise-206"><a href="#fit_noise-206"><span class="linenos">206</span></a>                <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;randtobest1bin&#39;</span><span class="p">,</span>
</span><span id="fit_noise-207"><a href="#fit_noise-207"><span class="linenos">207</span></a>                <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="fit_noise-208"><a href="#fit_noise-208"><span class="linenos">208</span></a>                <span class="n">popsize</span><span class="o">=</span><span class="n">popsize</span><span class="p">,</span>
</span><span id="fit_noise-209"><a href="#fit_noise-209"><span class="linenos">209</span></a>                <span class="n">mutation</span><span class="o">=</span><span class="n">mutation</span><span class="p">,</span>
</span><span id="fit_noise-210"><a href="#fit_noise-210"><span class="linenos">210</span></a>                <span class="n">tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
</span><span id="fit_noise-211"><a href="#fit_noise-211"><span class="linenos">211</span></a>                <span class="n">seed</span><span class="o">=</span><span class="n">random_state</span>
</span><span id="fit_noise-212"><a href="#fit_noise-212"><span class="linenos">212</span></a>            <span class="p">)</span>
</span><span id="fit_noise-213"><a href="#fit_noise-213"><span class="linenos">213</span></a>
</span><span id="fit_noise-214"><a href="#fit_noise-214"><span class="linenos">214</span></a>            <span class="c1"># Perform local optimization</span>
</span><span id="fit_noise-215"><a href="#fit_noise-215"><span class="linenos">215</span></a>            <span class="n">local_opt</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
</span><span id="fit_noise-216"><a href="#fit_noise-216"><span class="linenos">216</span></a>                <span class="n">_objective</span><span class="p">,</span>
</span><span id="fit_noise-217"><a href="#fit_noise-217"><span class="linenos">217</span></a>                <span class="n">global_opt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
</span><span id="fit_noise-218"><a href="#fit_noise-218"><span class="linenos">218</span></a>                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">pxx</span><span class="p">,</span> <span class="n">p_filter</span><span class="p">),</span>
</span><span id="fit_noise-219"><a href="#fit_noise-219"><span class="linenos">219</span></a>                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
</span><span id="fit_noise-220"><a href="#fit_noise-220"><span class="linenos">220</span></a>                <span class="n">method</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span>
</span><span id="fit_noise-221"><a href="#fit_noise-221"><span class="linenos">221</span></a>                <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;maxiter&#39;</span><span class="p">:</span> <span class="n">maxiter</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;ftol&#39;</span><span class="p">:</span> <span class="mf">1e-10</span><span class="p">}</span>
</span><span id="fit_noise-222"><a href="#fit_noise-222"><span class="linenos">222</span></a>            <span class="p">)</span>
</span><span id="fit_noise-223"><a href="#fit_noise-223"><span class="linenos">223</span></a>
</span><span id="fit_noise-224"><a href="#fit_noise-224"><span class="linenos">224</span></a>            <span class="c1"># Store results</span>
</span><span id="fit_noise-225"><a href="#fit_noise-225"><span class="linenos">225</span></a>            <span class="n">results</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">NoiseFitResults</span><span class="p">(</span>
</span><span id="fit_noise-226"><a href="#fit_noise-226"><span class="linenos">226</span></a>                <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
</span><span id="fit_noise-227"><a href="#fit_noise-227"><span class="linenos">227</span></a>                <span class="n">pxx</span><span class="o">=</span><span class="n">pxx</span><span class="p">,</span>
</span><span id="fit_noise-228"><a href="#fit_noise-228"><span class="linenos">228</span></a>                <span class="n">p_filter</span><span class="o">=</span><span class="n">p_filter</span><span class="p">,</span>
</span><span id="fit_noise-229"><a href="#fit_noise-229"><span class="linenos">229</span></a>                <span class="n">n_regimes</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
</span><span id="fit_noise-230"><a href="#fit_noise-230"><span class="linenos">230</span></a>                <span class="n">cs</span><span class="o">=</span><span class="n">exp</span><span class="p">(</span><span class="n">local_opt</span><span class="o">.</span><span class="n">x</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">local_opt</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]),</span>
</span><span id="fit_noise-231"><a href="#fit_noise-231"><span class="linenos">231</span></a>                <span class="n">ms</span><span class="o">=</span><span class="n">local_opt</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">local_opt</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:],</span>
</span><span id="fit_noise-232"><a href="#fit_noise-232"><span class="linenos">232</span></a>                <span class="n">alphas</span><span class="o">=</span><span class="p">[(</span><span class="n">m</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">local_opt</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">local_opt</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:]],</span>
</span><span id="fit_noise-233"><a href="#fit_noise-233"><span class="linenos">233</span></a>                <span class="n">SSLE</span><span class="o">=</span><span class="n">local_opt</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span>
</span><span id="fit_noise-234"><a href="#fit_noise-234"><span class="linenos">234</span></a>                <span class="n">success</span><span class="o">=</span><span class="n">local_opt</span><span class="o">.</span><span class="n">success</span><span class="p">,</span>
</span><span id="fit_noise-235"><a href="#fit_noise-235"><span class="linenos">235</span></a>                <span class="n">global_opt</span><span class="o">=</span><span class="n">global_opt</span><span class="p">,</span>
</span><span id="fit_noise-236"><a href="#fit_noise-236"><span class="linenos">236</span></a>                <span class="n">local_opt</span><span class="o">=</span><span class="n">local_opt</span>
</span><span id="fit_noise-237"><a href="#fit_noise-237"><span class="linenos">237</span></a>            <span class="p">)</span>
</span><span id="fit_noise-238"><a href="#fit_noise-238"><span class="linenos">238</span></a>
</span><span id="fit_noise-239"><a href="#fit_noise-239"><span class="linenos">239</span></a>            <span class="c1"># Update the progress bar</span>
</span><span id="fit_noise-240"><a href="#fit_noise-240"><span class="linenos">240</span></a>            <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="fit_noise-241"><a href="#fit_noise-241"><span class="linenos">241</span></a>
</span><span id="fit_noise-242"><a href="#fit_noise-242"><span class="linenos">242</span></a>    <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Fit noise regimes to the provided power spectral density (PSD) using global differential evolution optimisation
followed by local L-BFGS-B optimisation. The fitting is done by minimising the sum of squared log error between the
predicted and actual PSDs, taking into account the true anti-aliasing filter.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>f (ndarray):</strong>  The frequency array of the true noise.</li>
<li><strong>pxx (ndarray):</strong>  The PSD array of the true noise.</li>
<li><strong>aa_order (int):</strong>  The order of the anti-aliasing filter.</li>
<li><strong>aa_cutoff (int):</strong>  The cutoff frequency for the anti-aliasing filter.</li>
<li><strong>n_regimes (int | list[int]):</strong>  The number of noise regimes to fit or a list of noise regime numbers to fit. Default is (2, 3).</li>
<li><strong>maxiter (tuple[int, int]):</strong>  The maximum number evaluations for differential evolution and L-BFGS-B. Default is (2000, 10000).</li>
<li><strong>popsize (int):</strong>  The population size multiplier for differential evolution. Default is 500.</li>
<li><strong>mutation (tuple[float, float]):</strong>  The mutation constant for differential evolution. Default is (0.7, 1.2).</li>
<li><strong>random_state (int | None):</strong>  Random seed for reproducibility. Default is None.</li>
<li><strong>verbose (bool):</strong>  Whether to print verbose output during processing. Default is False.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>dict[int, NoiseFitResults]: A dictionary of noise fitting results keyed by the number of regimes.</p>
</blockquote>
</div>


                </section>
                <section id="generate_noise">
                            <input id="generate_noise-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_noise</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">alphas</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>,</span><span class="param">	<span class="n">cs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>,</span><span class="param">	<span class="n">length</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">complex_gen</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">psd_period</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">nfft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">aa_cutoff</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">aa_order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="generate_noise-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#generate_noise"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="generate_noise-305"><a href="#generate_noise-305"><span class="linenos">305</span></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_noise</span><span class="p">(</span>
</span><span id="generate_noise-306"><a href="#generate_noise-306"><span class="linenos">306</span></a>    <span class="n">alphas</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="generate_noise-307"><a href="#generate_noise-307"><span class="linenos">307</span></a>    <span class="n">cs</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="generate_noise-308"><a href="#generate_noise-308"><span class="linenos">308</span></a>    <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="generate_noise-309"><a href="#generate_noise-309"><span class="linenos">309</span></a>    <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="generate_noise-310"><a href="#generate_noise-310"><span class="linenos">310</span></a>    <span class="n">complex_gen</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="generate_noise-311"><a href="#generate_noise-311"><span class="linenos">311</span></a>    <span class="n">psd_period</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="generate_noise-312"><a href="#generate_noise-312"><span class="linenos">312</span></a>    <span class="n">nfft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="generate_noise-313"><a href="#generate_noise-313"><span class="linenos">313</span></a>    <span class="n">aa_cutoff</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="generate_noise-314"><a href="#generate_noise-314"><span class="linenos">314</span></a>    <span class="n">aa_order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="generate_noise-315"><a href="#generate_noise-315"><span class="linenos">315</span></a>    <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="generate_noise-316"><a href="#generate_noise-316"><span class="linenos">316</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">]]:</span>
</span><span id="generate_noise-317"><a href="#generate_noise-317"><span class="linenos">317</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="generate_noise-318"><a href="#generate_noise-318"><span class="linenos">318</span></a><span class="sd">    Generate a composition of noise regimes based on the provided alpha and c values using a modified version of the</span>
</span><span id="generate_noise-319"><a href="#generate_noise-319"><span class="linenos">319</span></a><span class="sd">    spectral method. Optionally applies an anti-aliasing filter to the generated noise to match the conditions of the</span>
</span><span id="generate_noise-320"><a href="#generate_noise-320"><span class="linenos">320</span></a><span class="sd">    trace the values were derived from.</span>
</span><span id="generate_noise-321"><a href="#generate_noise-321"><span class="linenos">321</span></a>
</span><span id="generate_noise-322"><a href="#generate_noise-322"><span class="linenos">322</span></a><span class="sd">    Args:</span>
</span><span id="generate_noise-323"><a href="#generate_noise-323"><span class="linenos">323</span></a><span class="sd">        alphas (ndarray[float]): The detrended fluctuation analysis (DFA) alpha exponents (directly related to H) of the noise regimes.</span>
</span><span id="generate_noise-324"><a href="#generate_noise-324"><span class="linenos">324</span></a><span class="sd">        cs (ndarray[float]): The frequency domain numerators (directly related to variance) of the noise regimes.</span>
</span><span id="generate_noise-325"><a href="#generate_noise-325"><span class="linenos">325</span></a><span class="sd">        length (int): The length of the noise regimes to generate.</span>
</span><span id="generate_noise-326"><a href="#generate_noise-326"><span class="linenos">326</span></a><span class="sd">        sample_rate (int): The sample rate of the noise regimes.</span>
</span><span id="generate_noise-327"><a href="#generate_noise-327"><span class="linenos">327</span></a><span class="sd">        complex_gen (bool): Whether to generate noise regimes starting with complex noise. Default is False.</span>
</span><span id="generate_noise-328"><a href="#generate_noise-328"><span class="linenos">328</span></a><span class="sd">        psd_period (float | None): The period of the power spectral density (PSD) for scale matching. Default is None.</span>
</span><span id="generate_noise-329"><a href="#generate_noise-329"><span class="linenos">329</span></a><span class="sd">        nfft (int | None): The number of PSD FFT points for scale matching. Default is None.</span>
</span><span id="generate_noise-330"><a href="#generate_noise-330"><span class="linenos">330</span></a><span class="sd">        aa_cutoff (int | None): The cutoff frequency for the anti-aliasing filter. Default is None.</span>
</span><span id="generate_noise-331"><a href="#generate_noise-331"><span class="linenos">331</span></a><span class="sd">        aa_order (int | None): The order of the anti-aliasing filter. Default is None.</span>
</span><span id="generate_noise-332"><a href="#generate_noise-332"><span class="linenos">332</span></a><span class="sd">        random_state (int | None): Random seed for reproducibility. Default is None.</span>
</span><span id="generate_noise-333"><a href="#generate_noise-333"><span class="linenos">333</span></a>
</span><span id="generate_noise-334"><a href="#generate_noise-334"><span class="linenos">334</span></a><span class="sd">    Returns:</span>
</span><span id="generate_noise-335"><a href="#generate_noise-335"><span class="linenos">335</span></a><span class="sd">        tuple[ndarray, dict[float, ndarray]]: A tuple containing the total generated noise and a dictionary of individual</span>
</span><span id="generate_noise-336"><a href="#generate_noise-336"><span class="linenos">336</span></a><span class="sd">        noise regimes keyed by their alpha values.</span>
</span><span id="generate_noise-337"><a href="#generate_noise-337"><span class="linenos">337</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="generate_noise-338"><a href="#generate_noise-338"><span class="linenos">338</span></a>
</span><span id="generate_noise-339"><a href="#generate_noise-339"><span class="linenos">339</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">alphas</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cs</span><span class="p">):</span>
</span><span id="generate_noise-340"><a href="#generate_noise-340"><span class="linenos">340</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The length of alphas and cs must be the same.&quot;</span><span class="p">)</span>
</span><span id="generate_noise-341"><a href="#generate_noise-341"><span class="linenos">341</span></a>
</span><span id="generate_noise-342"><a href="#generate_noise-342"><span class="linenos">342</span></a>    <span class="c1"># Simulate the regimes</span>
</span><span id="generate_noise-343"><a href="#generate_noise-343"><span class="linenos">343</span></a>    <span class="n">regimes</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="generate_noise-344"><a href="#generate_noise-344"><span class="linenos">344</span></a>    <span class="k">for</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
</span><span id="generate_noise-345"><a href="#generate_noise-345"><span class="linenos">345</span></a>        <span class="n">regimes</span><span class="p">[</span><span class="n">alpha</span><span class="p">]</span> <span class="o">=</span> <span class="n">_generate_regime</span><span class="p">(</span>
</span><span id="generate_noise-346"><a href="#generate_noise-346"><span class="linenos">346</span></a>            <span class="n">alpha</span><span class="p">,</span>
</span><span id="generate_noise-347"><a href="#generate_noise-347"><span class="linenos">347</span></a>            <span class="n">c</span><span class="p">,</span>
</span><span id="generate_noise-348"><a href="#generate_noise-348"><span class="linenos">348</span></a>            <span class="n">length</span><span class="p">,</span>
</span><span id="generate_noise-349"><a href="#generate_noise-349"><span class="linenos">349</span></a>            <span class="n">sample_rate</span><span class="p">,</span>
</span><span id="generate_noise-350"><a href="#generate_noise-350"><span class="linenos">350</span></a>            <span class="n">complex_gen</span><span class="o">=</span><span class="n">complex_gen</span><span class="p">,</span>
</span><span id="generate_noise-351"><a href="#generate_noise-351"><span class="linenos">351</span></a>            <span class="n">psd_period</span><span class="o">=</span><span class="n">psd_period</span><span class="p">,</span>
</span><span id="generate_noise-352"><a href="#generate_noise-352"><span class="linenos">352</span></a>            <span class="n">nfft</span><span class="o">=</span><span class="n">nfft</span><span class="p">,</span>
</span><span id="generate_noise-353"><a href="#generate_noise-353"><span class="linenos">353</span></a>            <span class="n">random_state</span><span class="o">=</span> <span class="n">random_state</span>
</span><span id="generate_noise-354"><a href="#generate_noise-354"><span class="linenos">354</span></a>        <span class="p">)</span>
</span><span id="generate_noise-355"><a href="#generate_noise-355"><span class="linenos">355</span></a>
</span><span id="generate_noise-356"><a href="#generate_noise-356"><span class="linenos">356</span></a>    <span class="c1"># Sum the noises</span>
</span><span id="generate_noise-357"><a href="#generate_noise-357"><span class="linenos">357</span></a>    <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">regimes</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="generate_noise-358"><a href="#generate_noise-358"><span class="linenos">358</span></a>
</span><span id="generate_noise-359"><a href="#generate_noise-359"><span class="linenos">359</span></a>    <span class="c1"># Apply the AA filter if specified</span>
</span><span id="generate_noise-360"><a href="#generate_noise-360"><span class="linenos">360</span></a>    <span class="k">if</span> <span class="n">aa_cutoff</span> <span class="ow">and</span> <span class="n">aa_order</span><span class="p">:</span>
</span><span id="generate_noise-361"><a href="#generate_noise-361"><span class="linenos">361</span></a>        <span class="n">total</span> <span class="o">=</span> <span class="n">_aa_filter</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">aa_cutoff</span><span class="p">,</span> <span class="n">aa_order</span><span class="p">)</span>
</span><span id="generate_noise-362"><a href="#generate_noise-362"><span class="linenos">362</span></a>
</span><span id="generate_noise-363"><a href="#generate_noise-363"><span class="linenos">363</span></a>    <span class="k">return</span> <span class="n">total</span><span class="p">,</span> <span class="n">regimes</span>
</span></pre></div>


            <div class="docstring"><p>Generate a composition of noise regimes based on the provided alpha and c values using a modified version of the
spectral method. Optionally applies an anti-aliasing filter to the generated noise to match the conditions of the
trace the values were derived from.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>alphas (ndarray[float]):</strong>  The detrended fluctuation analysis (DFA) alpha exponents (directly related to H) of the noise regimes.</li>
<li><strong>cs (ndarray[float]):</strong>  The frequency domain numerators (directly related to variance) of the noise regimes.</li>
<li><strong>length (int):</strong>  The length of the noise regimes to generate.</li>
<li><strong>sample_rate (int):</strong>  The sample rate of the noise regimes.</li>
<li><strong>complex_gen (bool):</strong>  Whether to generate noise regimes starting with complex noise. Default is False.</li>
<li><strong>psd_period (float | None):</strong>  The period of the power spectral density (PSD) for scale matching. Default is None.</li>
<li><strong>nfft (int | None):</strong>  The number of PSD FFT points for scale matching. Default is None.</li>
<li><strong>aa_cutoff (int | None):</strong>  The cutoff frequency for the anti-aliasing filter. Default is None.</li>
<li><strong>aa_order (int | None):</strong>  The order of the anti-aliasing filter. Default is None.</li>
<li><strong>random_state (int | None):</strong>  Random seed for reproducibility. Default is None.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>tuple[ndarray, dict[float, ndarray]]: A tuple containing the total generated noise and a dictionary of individual
  noise regimes keyed by their alpha values.</p>
</blockquote>
</div>


                </section>
                <section id="piecwise_fit_noise">
                            <input id="piecwise_fit_noise-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">piecwise_fit_noise</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">f</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">pxx</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">n_regimes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="piecwise_fit_noise-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#piecwise_fit_noise"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="piecwise_fit_noise-245"><a href="#piecwise_fit_noise-245"><span class="linenos">245</span></a><span class="k">def</span><span class="w"> </span><span class="nf">piecwise_fit_noise</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">pxx</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">n_regimes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="piecwise_fit_noise-246"><a href="#piecwise_fit_noise-246"><span class="linenos">246</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="piecwise_fit_noise-247"><a href="#piecwise_fit_noise-247"><span class="linenos">247</span></a><span class="sd">    Fit piecewise linear noise regimes to the provided power spectral density (PSD) using Nelder-Mead optimisation.</span>
</span><span id="piecwise_fit_noise-248"><a href="#piecwise_fit_noise-248"><span class="linenos">248</span></a><span class="sd">    The fitting is done by minimising the mean squared error between the predicted and actual PSDs. This function</span>
</span><span id="piecwise_fit_noise-249"><a href="#piecwise_fit_noise-249"><span class="linenos">249</span></a><span class="sd">    does not take into the account the anti-aliasing filter parameters, does not fit summed noise regimes, and does not</span>
</span><span id="piecwise_fit_noise-250"><a href="#piecwise_fit_noise-250"><span class="linenos">250</span></a><span class="sd">    generate. It is a simpler fitting method that can be used for quick estimates of the noise regimes, for diagnostic</span>
</span><span id="piecwise_fit_noise-251"><a href="#piecwise_fit_noise-251"><span class="linenos">251</span></a><span class="sd">    purposes, or for visualisation.</span>
</span><span id="piecwise_fit_noise-252"><a href="#piecwise_fit_noise-252"><span class="linenos">252</span></a>
</span><span id="piecwise_fit_noise-253"><a href="#piecwise_fit_noise-253"><span class="linenos">253</span></a><span class="sd">    Args:</span>
</span><span id="piecwise_fit_noise-254"><a href="#piecwise_fit_noise-254"><span class="linenos">254</span></a><span class="sd">        f (ndarray): The frequency array of the true noise.</span>
</span><span id="piecwise_fit_noise-255"><a href="#piecwise_fit_noise-255"><span class="linenos">255</span></a><span class="sd">        pxx (ndarray): The PSD array of the true noise.</span>
</span><span id="piecwise_fit_noise-256"><a href="#piecwise_fit_noise-256"><span class="linenos">256</span></a><span class="sd">        n_regimes (int | list[int]): The number of noise regimes to fit or a list of noise regime numbers to fit. Default is (2, 3).</span>
</span><span id="piecwise_fit_noise-257"><a href="#piecwise_fit_noise-257"><span class="linenos">257</span></a>
</span><span id="piecwise_fit_noise-258"><a href="#piecwise_fit_noise-258"><span class="linenos">258</span></a><span class="sd">    Returns:</span>
</span><span id="piecwise_fit_noise-259"><a href="#piecwise_fit_noise-259"><span class="linenos">259</span></a><span class="sd">        dict[int, dict[str, Any]]: A dictionary of noise fitting results keyed by the number of regimes.</span>
</span><span id="piecwise_fit_noise-260"><a href="#piecwise_fit_noise-260"><span class="linenos">260</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="piecwise_fit_noise-261"><a href="#piecwise_fit_noise-261"><span class="linenos">261</span></a>
</span><span id="piecwise_fit_noise-262"><a href="#piecwise_fit_noise-262"><span class="linenos">262</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pxx</span><span class="p">):</span>
</span><span id="piecwise_fit_noise-263"><a href="#piecwise_fit_noise-263"><span class="linenos">263</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Frequency and PSD arrays must have the same length.&quot;</span><span class="p">)</span>
</span><span id="piecwise_fit_noise-264"><a href="#piecwise_fit_noise-264"><span class="linenos">264</span></a>
</span><span id="piecwise_fit_noise-265"><a href="#piecwise_fit_noise-265"><span class="linenos">265</span></a>    <span class="n">n_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_regimes</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_regimes</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">n_regimes</span><span class="p">)</span>
</span><span id="piecwise_fit_noise-266"><a href="#piecwise_fit_noise-266"><span class="linenos">266</span></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_list</span><span class="p">):</span>
</span><span id="piecwise_fit_noise-267"><a href="#piecwise_fit_noise-267"><span class="linenos">267</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of regimes must be at least 1.&quot;</span><span class="p">)</span>
</span><span id="piecwise_fit_noise-268"><a href="#piecwise_fit_noise-268"><span class="linenos">268</span></a>
</span><span id="piecwise_fit_noise-269"><a href="#piecwise_fit_noise-269"><span class="linenos">269</span></a>    <span class="c1"># Log transform for straight line fitting</span>
</span><span id="piecwise_fit_noise-270"><a href="#piecwise_fit_noise-270"><span class="linenos">270</span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="piecwise_fit_noise-271"><a href="#piecwise_fit_noise-271"><span class="linenos">271</span></a>    <span class="n">pxx</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">pxx</span><span class="p">)</span>
</span><span id="piecwise_fit_noise-272"><a href="#piecwise_fit_noise-272"><span class="linenos">272</span></a>
</span><span id="piecwise_fit_noise-273"><a href="#piecwise_fit_noise-273"><span class="linenos">273</span></a>    <span class="c1"># Objective function for piecewise linear fit</span>
</span><span id="piecwise_fit_noise-274"><a href="#piecwise_fit_noise-274"><span class="linenos">274</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">objective</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="piecwise_fit_noise-275"><a href="#piecwise_fit_noise-275"><span class="linenos">275</span></a>        <span class="n">px</span> <span class="o">=</span> <span class="n">r_</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">prediction</span><span class="p">[:</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span>
</span><span id="piecwise_fit_noise-276"><a href="#piecwise_fit_noise-276"><span class="linenos">276</span></a>        <span class="n">py</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="piecwise_fit_noise-277"><a href="#piecwise_fit_noise-277"><span class="linenos">277</span></a>        <span class="k">return</span> <span class="n">mean</span><span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">interp</span><span class="p">(</span><span class="n">x</span> <span class="p">,</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="piecwise_fit_noise-278"><a href="#piecwise_fit_noise-278"><span class="linenos">278</span></a>
</span><span id="piecwise_fit_noise-279"><a href="#piecwise_fit_noise-279"><span class="linenos">279</span></a>    <span class="n">fits</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="piecwise_fit_noise-280"><a href="#piecwise_fit_noise-280"><span class="linenos">280</span></a>    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_list</span><span class="p">:</span>
</span><span id="piecwise_fit_noise-281"><a href="#piecwise_fit_noise-281"><span class="linenos">281</span></a>        <span class="c1"># Create initial guess as n equally spaced points in the frequency domain (with first and last points fixed)</span>
</span><span id="piecwise_fit_noise-282"><a href="#piecwise_fit_noise-282"><span class="linenos">282</span></a>        <span class="n">init_f</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="n">cumsum</span><span class="p">(</span><span class="n">full</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span><span class="p">)))</span>
</span><span id="piecwise_fit_noise-283"><a href="#piecwise_fit_noise-283"><span class="linenos">283</span></a>        <span class="n">init_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="n">val</span><span class="p">))</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">init_f</span><span class="p">]</span>
</span><span id="piecwise_fit_noise-284"><a href="#piecwise_fit_noise-284"><span class="linenos">284</span></a>        <span class="n">initial_guess</span> <span class="o">=</span> <span class="n">r_</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">init_idx</span><span class="p">],</span> <span class="n">r_</span><span class="p">[</span><span class="n">pxx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pxx</span><span class="p">[</span><span class="n">init_idx</span><span class="p">],</span> <span class="n">pxx</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">pxx</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]]</span>
</span><span id="piecwise_fit_noise-285"><a href="#piecwise_fit_noise-285"><span class="linenos">285</span></a>
</span><span id="piecwise_fit_noise-286"><a href="#piecwise_fit_noise-286"><span class="linenos">286</span></a>        <span class="c1"># Nelder-Mead optimization</span>
</span><span id="piecwise_fit_noise-287"><a href="#piecwise_fit_noise-287"><span class="linenos">287</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">pxx</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">)</span>
</span><span id="piecwise_fit_noise-288"><a href="#piecwise_fit_noise-288"><span class="linenos">288</span></a>
</span><span id="piecwise_fit_noise-289"><a href="#piecwise_fit_noise-289"><span class="linenos">289</span></a>        <span class="c1"># Store results</span>
</span><span id="piecwise_fit_noise-290"><a href="#piecwise_fit_noise-290"><span class="linenos">290</span></a>        <span class="n">fits</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="piecwise_fit_noise-291"><a href="#piecwise_fit_noise-291"><span class="linenos">291</span></a>        <span class="n">fits</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>
</span><span id="piecwise_fit_noise-292"><a href="#piecwise_fit_noise-292"><span class="linenos">292</span></a>        <span class="n">fits</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;pxx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pxx</span>
</span><span id="piecwise_fit_noise-293"><a href="#piecwise_fit_noise-293"><span class="linenos">293</span></a>        <span class="n">fits</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;line fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">interp</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">r_</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[:</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:]))</span>
</span><span id="piecwise_fit_noise-294"><a href="#piecwise_fit_noise-294"><span class="linenos">294</span></a>        <span class="n">fits</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;n_regimes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="piecwise_fit_noise-295"><a href="#piecwise_fit_noise-295"><span class="linenos">295</span></a>        <span class="n">fits</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;crossovers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[:</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="piecwise_fit_noise-296"><a href="#piecwise_fit_noise-296"><span class="linenos">296</span></a>        <span class="n">fits</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="n">diff</span><span class="p">(</span><span class="n">r_</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[:</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]))</span>
</span><span id="piecwise_fit_noise-297"><a href="#piecwise_fit_noise-297"><span class="linenos">297</span></a>        <span class="n">fits</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;alphas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">m</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">fits</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;ms&#39;</span><span class="p">]],</span>
</span><span id="piecwise_fit_noise-298"><a href="#piecwise_fit_noise-298"><span class="linenos">298</span></a>        <span class="n">fits</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;MSE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span>
</span><span id="piecwise_fit_noise-299"><a href="#piecwise_fit_noise-299"><span class="linenos">299</span></a>        <span class="n">fits</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span>
</span><span id="piecwise_fit_noise-300"><a href="#piecwise_fit_noise-300"><span class="linenos">300</span></a>        <span class="n">fits</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;opt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="piecwise_fit_noise-301"><a href="#piecwise_fit_noise-301"><span class="linenos">301</span></a>
</span><span id="piecwise_fit_noise-302"><a href="#piecwise_fit_noise-302"><span class="linenos">302</span></a>    <span class="k">return</span> <span class="n">fits</span>
</span></pre></div>


            <div class="docstring"><p>Fit piecewise linear noise regimes to the provided power spectral density (PSD) using Nelder-Mead optimisation.
The fitting is done by minimising the mean squared error between the predicted and actual PSDs. This function
does not take into the account the anti-aliasing filter parameters, does not fit summed noise regimes, and does not
generate. It is a simpler fitting method that can be used for quick estimates of the noise regimes, for diagnostic
purposes, or for visualisation.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>f (ndarray):</strong>  The frequency array of the true noise.</li>
<li><strong>pxx (ndarray):</strong>  The PSD array of the true noise.</li>
<li><strong>n_regimes (int | list[int]):</strong>  The number of noise regimes to fit or a list of noise regime numbers to fit. Default is (2, 3).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>dict[int, dict[str, Any]]: A dictionary of noise fitting results keyed by the number of regimes.</p>
</blockquote>
</div>


                </section>
                <section id="reconstruct_noise">
                            <input id="reconstruct_noise-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reconstruct_noise</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">trace</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n"><a href="models.html#Trace">notnormal.models.Trace</a></span>,</span><span class="param">	<span class="n">event_mask</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n"><a href="models.html#Events">notnormal.models.Events</a></span>,</span><span class="param">	<span class="n">aa_cutoff</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">aa_order</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">n_regimes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>,</span><span class="param">	<span class="n">sample_rate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">maxiter</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>,</span><span class="param">	<span class="n">popsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span>,</span><span class="param">	<span class="n">mutation</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>,</span><span class="param">	<span class="n">psd_period</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">nfft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">generate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">=</span> <span class="s1">&#39;best&#39;</span>,</span><span class="param">	<span class="n">complex_gen</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n"><a href="models.html#NoiseReconstructResults">notnormal.models.NoiseReconstructResults</a></span>:</span></span>

                <label class="view-source-button" for="reconstruct_noise-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#reconstruct_noise"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="reconstruct_noise-27"><a href="#reconstruct_noise-27"><span class="linenos"> 27</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reconstruct_noise</span><span class="p">(</span>
</span><span id="reconstruct_noise-28"><a href="#reconstruct_noise-28"><span class="linenos"> 28</span></a>    <span class="n">trace</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">|</span> <span class="n">Trace</span><span class="p">,</span>
</span><span id="reconstruct_noise-29"><a href="#reconstruct_noise-29"><span class="linenos"> 29</span></a>    <span class="n">event_mask</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">|</span> <span class="n">Events</span><span class="p">,</span>
</span><span id="reconstruct_noise-30"><a href="#reconstruct_noise-30"><span class="linenos"> 30</span></a>    <span class="n">aa_cutoff</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="reconstruct_noise-31"><a href="#reconstruct_noise-31"><span class="linenos"> 31</span></a>    <span class="n">aa_order</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="reconstruct_noise-32"><a href="#reconstruct_noise-32"><span class="linenos"> 32</span></a>    <span class="n">n_regimes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="reconstruct_noise-33"><a href="#reconstruct_noise-33"><span class="linenos"> 33</span></a>    <span class="n">sample_rate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="reconstruct_noise-34"><a href="#reconstruct_noise-34"><span class="linenos"> 34</span></a>    <span class="n">maxiter</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span>
</span><span id="reconstruct_noise-35"><a href="#reconstruct_noise-35"><span class="linenos"> 35</span></a>    <span class="n">popsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
</span><span id="reconstruct_noise-36"><a href="#reconstruct_noise-36"><span class="linenos"> 36</span></a>    <span class="n">mutation</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">),</span>
</span><span id="reconstruct_noise-37"><a href="#reconstruct_noise-37"><span class="linenos"> 37</span></a>    <span class="n">psd_period</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="reconstruct_noise-38"><a href="#reconstruct_noise-38"><span class="linenos"> 38</span></a>    <span class="n">nfft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="reconstruct_noise-39"><a href="#reconstruct_noise-39"><span class="linenos"> 39</span></a>    <span class="n">generate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">=</span> <span class="s1">&#39;best&#39;</span><span class="p">,</span>
</span><span id="reconstruct_noise-40"><a href="#reconstruct_noise-40"><span class="linenos"> 40</span></a>    <span class="n">complex_gen</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="reconstruct_noise-41"><a href="#reconstruct_noise-41"><span class="linenos"> 41</span></a>    <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="reconstruct_noise-42"><a href="#reconstruct_noise-42"><span class="linenos"> 42</span></a>    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="reconstruct_noise-43"><a href="#reconstruct_noise-43"><span class="linenos"> 43</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoiseReconstructResults</span><span class="p">:</span>
</span><span id="reconstruct_noise-44"><a href="#reconstruct_noise-44"><span class="linenos"> 44</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="reconstruct_noise-45"><a href="#reconstruct_noise-45"><span class="linenos"> 45</span></a><span class="sd">    This function uses global differential evolution optimisation and local L-BFGS-B optimisation to fit a composition</span>
</span><span id="reconstruct_noise-46"><a href="#reconstruct_noise-46"><span class="linenos"> 46</span></a><span class="sd">    of noise regimes to the power spectral density (PSD) of the noise, given by the trace without events. The fitting</span>
</span><span id="reconstruct_noise-47"><a href="#reconstruct_noise-47"><span class="linenos"> 47</span></a><span class="sd">    accounts for the anti-aliasing filter parameters, enabling an accurate fit which respects the condition of the noise</span>
</span><span id="reconstruct_noise-48"><a href="#reconstruct_noise-48"><span class="linenos"> 48</span></a><span class="sd">    post-sampling. Following, each individual noise regime is generated using a modified version of the spectral method</span>
</span><span id="reconstruct_noise-49"><a href="#reconstruct_noise-49"><span class="linenos"> 49</span></a><span class="sd">    that expands into the negative detrended fluctuation analysis (DFA) alpha and applies post-generation scaling to</span>
</span><span id="reconstruct_noise-50"><a href="#reconstruct_noise-50"><span class="linenos"> 50</span></a><span class="sd">    maximise the accuracy of each individual regime. Finally, the composition is computed, the anti-aliasing filter is</span>
</span><span id="reconstruct_noise-51"><a href="#reconstruct_noise-51"><span class="linenos"> 51</span></a><span class="sd">    applied by estimating the Bessel filter using the window design method, and the spectral angular map (SAM) against</span>
</span><span id="reconstruct_noise-52"><a href="#reconstruct_noise-52"><span class="linenos"> 52</span></a><span class="sd">    the true noise is computed to evaluate the quality of the reconstruction.</span>
</span><span id="reconstruct_noise-53"><a href="#reconstruct_noise-53"><span class="linenos"> 53</span></a>
</span><span id="reconstruct_noise-54"><a href="#reconstruct_noise-54"><span class="linenos"> 54</span></a><span class="sd">    Note: This function is computationally expensive. It is recommended to drop popsize to 50 or lower to get an estimate</span>
</span><span id="reconstruct_noise-55"><a href="#reconstruct_noise-55"><span class="linenos"> 55</span></a><span class="sd">    on the number of regimes, confirm solely the best fit with a conservative PSD period (e.g. 0.1 s) and then run a</span>
</span><span id="reconstruct_noise-56"><a href="#reconstruct_noise-56"><span class="linenos"> 56</span></a><span class="sd">    higher popsize (e.g. 500) with a longer PSD period (e.g. 1-2 s) to get the best fit for the noise regimes.</span>
</span><span id="reconstruct_noise-57"><a href="#reconstruct_noise-57"><span class="linenos"> 57</span></a>
</span><span id="reconstruct_noise-58"><a href="#reconstruct_noise-58"><span class="linenos"> 58</span></a><span class="sd">    Args:</span>
</span><span id="reconstruct_noise-59"><a href="#reconstruct_noise-59"><span class="linenos"> 59</span></a><span class="sd">        trace (ndarray | Trace): The trace to be processed or a Trace object. If ndarray, the sample rate must be provided.</span>
</span><span id="reconstruct_noise-60"><a href="#reconstruct_noise-60"><span class="linenos"> 60</span></a><span class="sd">        event_mask (ndarray | Events): A boolean mask indicating the events in the trace or an Events object.</span>
</span><span id="reconstruct_noise-61"><a href="#reconstruct_noise-61"><span class="linenos"> 61</span></a><span class="sd">        n_regimes (int | list[int]): The number of noise regimes to fit or a list of noise regime numbers to fit. Default is [2, 3].</span>
</span><span id="reconstruct_noise-62"><a href="#reconstruct_noise-62"><span class="linenos"> 62</span></a><span class="sd">        aa_order (int): The order of the anti-aliasing filter.</span>
</span><span id="reconstruct_noise-63"><a href="#reconstruct_noise-63"><span class="linenos"> 63</span></a><span class="sd">        aa_cutoff (int): The cutoff frequency for the anti-aliasing filter.</span>
</span><span id="reconstruct_noise-64"><a href="#reconstruct_noise-64"><span class="linenos"> 64</span></a><span class="sd">        sample_rate (int | None): The sample rate of the trace. Has to be provided if trace is a ndarray. Default is None.</span>
</span><span id="reconstruct_noise-65"><a href="#reconstruct_noise-65"><span class="linenos"> 65</span></a><span class="sd">        maxiter (tuple[int, int]): The maximum number evaluations for differential evolution and L-BFGS-B. Default is (2000, 10000).</span>
</span><span id="reconstruct_noise-66"><a href="#reconstruct_noise-66"><span class="linenos"> 66</span></a><span class="sd">        popsize (int): The population size multiplier for differential evolution. Default is 500.</span>
</span><span id="reconstruct_noise-67"><a href="#reconstruct_noise-67"><span class="linenos"> 67</span></a><span class="sd">        mutation (tuple[float, float]): The mutation constant for differential evolution. Default is (0.7, 1.2).</span>
</span><span id="reconstruct_noise-68"><a href="#reconstruct_noise-68"><span class="linenos"> 68</span></a><span class="sd">        psd_period (float | None): The period for the PSD calculation. Default is None.</span>
</span><span id="reconstruct_noise-69"><a href="#reconstruct_noise-69"><span class="linenos"> 69</span></a><span class="sd">        nfft (int | None): The length of FFT to use for PSD calculation. Default is None.</span>
</span><span id="reconstruct_noise-70"><a href="#reconstruct_noise-70"><span class="linenos"> 70</span></a><span class="sd">        generate (str | bool): Whether to generate noise regimes. If &#39;Best&#39;, only the best fit is generated. Default is &#39;best&#39;.</span>
</span><span id="reconstruct_noise-71"><a href="#reconstruct_noise-71"><span class="linenos"> 71</span></a><span class="sd">        complex_gen (bool): Whether to generate noise regimes starting with complex noise. Default is False.</span>
</span><span id="reconstruct_noise-72"><a href="#reconstruct_noise-72"><span class="linenos"> 72</span></a><span class="sd">        random_state (int | None): Random seed for reproducibility. Default is None.</span>
</span><span id="reconstruct_noise-73"><a href="#reconstruct_noise-73"><span class="linenos"> 73</span></a><span class="sd">        verbose (bool): Whether to print verbose output during processing. Default is False.</span>
</span><span id="reconstruct_noise-74"><a href="#reconstruct_noise-74"><span class="linenos"> 74</span></a>
</span><span id="reconstruct_noise-75"><a href="#reconstruct_noise-75"><span class="linenos"> 75</span></a><span class="sd">    Returns:</span>
</span><span id="reconstruct_noise-76"><a href="#reconstruct_noise-76"><span class="linenos"> 76</span></a><span class="sd">        NoiseReconstructResults: An object containing the reconstruction results.</span>
</span><span id="reconstruct_noise-77"><a href="#reconstruct_noise-77"><span class="linenos"> 77</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="reconstruct_noise-78"><a href="#reconstruct_noise-78"><span class="linenos"> 78</span></a>
</span><span id="reconstruct_noise-79"><a href="#reconstruct_noise-79"><span class="linenos"> 79</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">Trace</span><span class="p">):</span>
</span><span id="reconstruct_noise-80"><a href="#reconstruct_noise-80"><span class="linenos"> 80</span></a>        <span class="n">sample_rate</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">,</span> <span class="n">trace</span><span class="o">.</span><span class="n">trace</span>
</span><span id="reconstruct_noise-81"><a href="#reconstruct_noise-81"><span class="linenos"> 81</span></a>    <span class="k">if</span> <span class="n">sample_rate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="reconstruct_noise-82"><a href="#reconstruct_noise-82"><span class="linenos"> 82</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sample rate must be provided if trace is a ndarray.&quot;</span><span class="p">)</span>
</span><span id="reconstruct_noise-83"><a href="#reconstruct_noise-83"><span class="linenos"> 83</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event_mask</span><span class="p">,</span> <span class="n">Events</span><span class="p">):</span>
</span><span id="reconstruct_noise-84"><a href="#reconstruct_noise-84"><span class="linenos"> 84</span></a>        <span class="n">event_mask</span> <span class="o">=</span> <span class="n">get_event_mask</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">event_mask</span><span class="p">)</span>
</span><span id="reconstruct_noise-85"><a href="#reconstruct_noise-85"><span class="linenos"> 85</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">event_mask</span><span class="p">):</span>
</span><span id="reconstruct_noise-86"><a href="#reconstruct_noise-86"><span class="linenos"> 86</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The length of the trace and the event mask must be the same.&quot;</span><span class="p">)</span>
</span><span id="reconstruct_noise-87"><a href="#reconstruct_noise-87"><span class="linenos"> 87</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="reconstruct_noise-88"><a href="#reconstruct_noise-88"><span class="linenos"> 88</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The trace must not be empty.&quot;</span><span class="p">)</span>
</span><span id="reconstruct_noise-89"><a href="#reconstruct_noise-89"><span class="linenos"> 89</span></a>
</span><span id="reconstruct_noise-90"><a href="#reconstruct_noise-90"><span class="linenos"> 90</span></a>    <span class="c1"># Get args</span>
</span><span id="reconstruct_noise-91"><a href="#reconstruct_noise-91"><span class="linenos"> 91</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">NoiseReconstructionArgs</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">NoiseReconstructionArgs</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">})</span>
</span><span id="reconstruct_noise-92"><a href="#reconstruct_noise-92"><span class="linenos"> 92</span></a>
</span><span id="reconstruct_noise-93"><a href="#reconstruct_noise-93"><span class="linenos"> 93</span></a>    <span class="c1"># Get the trace without the events</span>
</span><span id="reconstruct_noise-94"><a href="#reconstruct_noise-94"><span class="linenos"> 94</span></a>    <span class="n">removed_trace</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="o">~</span><span class="n">event_mask</span><span class="p">]</span>
</span><span id="reconstruct_noise-95"><a href="#reconstruct_noise-95"><span class="linenos"> 95</span></a>
</span><span id="reconstruct_noise-96"><a href="#reconstruct_noise-96"><span class="linenos"> 96</span></a>    <span class="c1"># Get the PSD, only need at most twice the aa cutoff for accurate fitting</span>
</span><span id="reconstruct_noise-97"><a href="#reconstruct_noise-97"><span class="linenos"> 97</span></a>    <span class="n">f</span><span class="p">,</span> <span class="n">pxx</span> <span class="o">=</span> <span class="n">get_psd</span><span class="p">(</span><span class="n">removed_trace</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">aa_cutoff</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">psd_period</span><span class="o">=</span><span class="n">psd_period</span><span class="p">,</span> <span class="n">nfft</span><span class="o">=</span><span class="n">nfft</span><span class="p">)</span>
</span><span id="reconstruct_noise-98"><a href="#reconstruct_noise-98"><span class="linenos"> 98</span></a>
</span><span id="reconstruct_noise-99"><a href="#reconstruct_noise-99"><span class="linenos"> 99</span></a>    <span class="c1"># Fit the noise regimes</span>
</span><span id="reconstruct_noise-100"><a href="#reconstruct_noise-100"><span class="linenos">100</span></a>    <span class="n">fits</span> <span class="o">=</span> <span class="n">fit_noise</span><span class="p">(</span>
</span><span id="reconstruct_noise-101"><a href="#reconstruct_noise-101"><span class="linenos">101</span></a>        <span class="n">f</span><span class="p">,</span>
</span><span id="reconstruct_noise-102"><a href="#reconstruct_noise-102"><span class="linenos">102</span></a>        <span class="n">pxx</span><span class="p">,</span>
</span><span id="reconstruct_noise-103"><a href="#reconstruct_noise-103"><span class="linenos">103</span></a>        <span class="n">aa_order</span><span class="p">,</span>
</span><span id="reconstruct_noise-104"><a href="#reconstruct_noise-104"><span class="linenos">104</span></a>        <span class="n">aa_cutoff</span><span class="p">,</span>
</span><span id="reconstruct_noise-105"><a href="#reconstruct_noise-105"><span class="linenos">105</span></a>        <span class="n">n_regimes</span><span class="o">=</span><span class="n">n_regimes</span><span class="p">,</span>
</span><span id="reconstruct_noise-106"><a href="#reconstruct_noise-106"><span class="linenos">106</span></a>        <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
</span><span id="reconstruct_noise-107"><a href="#reconstruct_noise-107"><span class="linenos">107</span></a>        <span class="n">popsize</span><span class="o">=</span><span class="n">popsize</span><span class="p">,</span>
</span><span id="reconstruct_noise-108"><a href="#reconstruct_noise-108"><span class="linenos">108</span></a>        <span class="n">mutation</span><span class="o">=</span><span class="n">mutation</span><span class="p">,</span>
</span><span id="reconstruct_noise-109"><a href="#reconstruct_noise-109"><span class="linenos">109</span></a>        <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
</span><span id="reconstruct_noise-110"><a href="#reconstruct_noise-110"><span class="linenos">110</span></a>        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="reconstruct_noise-111"><a href="#reconstruct_noise-111"><span class="linenos">111</span></a>    <span class="p">)</span>
</span><span id="reconstruct_noise-112"><a href="#reconstruct_noise-112"><span class="linenos">112</span></a>
</span><span id="reconstruct_noise-113"><a href="#reconstruct_noise-113"><span class="linenos">113</span></a>    <span class="c1"># Get the best result</span>
</span><span id="reconstruct_noise-114"><a href="#reconstruct_noise-114"><span class="linenos">114</span></a>    <span class="n">best_fit</span><span class="p">,</span> <span class="n">loss_curves</span> <span class="o">=</span> <span class="n">_get_best_fit</span><span class="p">(</span><span class="n">fits</span><span class="p">)</span>
</span><span id="reconstruct_noise-115"><a href="#reconstruct_noise-115"><span class="linenos">115</span></a>
</span><span id="reconstruct_noise-116"><a href="#reconstruct_noise-116"><span class="linenos">116</span></a>    <span class="c1"># No generation requested</span>
</span><span id="reconstruct_noise-117"><a href="#reconstruct_noise-117"><span class="linenos">117</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">generate</span><span class="p">:</span>
</span><span id="reconstruct_noise-118"><a href="#reconstruct_noise-118"><span class="linenos">118</span></a>        <span class="k">return</span> <span class="n">NoiseReconstructResults</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fits</span><span class="p">,</span> <span class="n">best_fit</span><span class="p">,</span> <span class="n">loss_curves</span><span class="p">)</span>
</span><span id="reconstruct_noise-119"><a href="#reconstruct_noise-119"><span class="linenos">119</span></a>
</span><span id="reconstruct_noise-120"><a href="#reconstruct_noise-120"><span class="linenos">120</span></a>    <span class="c1"># Generate the noise regimes</span>
</span><span id="reconstruct_noise-121"><a href="#reconstruct_noise-121"><span class="linenos">121</span></a>    <span class="n">fits</span> <span class="o">=</span> <span class="n">_generate_noises</span><span class="p">(</span>
</span><span id="reconstruct_noise-122"><a href="#reconstruct_noise-122"><span class="linenos">122</span></a>        <span class="n">fits</span><span class="p">,</span>
</span><span id="reconstruct_noise-123"><a href="#reconstruct_noise-123"><span class="linenos">123</span></a>        <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">),</span>
</span><span id="reconstruct_noise-124"><a href="#reconstruct_noise-124"><span class="linenos">124</span></a>        <span class="n">sample_rate</span><span class="p">,</span>
</span><span id="reconstruct_noise-125"><a href="#reconstruct_noise-125"><span class="linenos">125</span></a>        <span class="n">complex_gen</span><span class="o">=</span><span class="n">complex_gen</span><span class="p">,</span>
</span><span id="reconstruct_noise-126"><a href="#reconstruct_noise-126"><span class="linenos">126</span></a>        <span class="n">psd_period</span><span class="o">=</span><span class="n">psd_period</span><span class="p">,</span>
</span><span id="reconstruct_noise-127"><a href="#reconstruct_noise-127"><span class="linenos">127</span></a>        <span class="n">nfft</span><span class="o">=</span><span class="n">nfft</span><span class="p">,</span>
</span><span id="reconstruct_noise-128"><a href="#reconstruct_noise-128"><span class="linenos">128</span></a>        <span class="n">aa_cutoff</span><span class="o">=</span><span class="n">aa_cutoff</span><span class="p">,</span>
</span><span id="reconstruct_noise-129"><a href="#reconstruct_noise-129"><span class="linenos">129</span></a>        <span class="n">aa_order</span><span class="o">=</span><span class="n">aa_order</span><span class="p">,</span>
</span><span id="reconstruct_noise-130"><a href="#reconstruct_noise-130"><span class="linenos">130</span></a>        <span class="n">n_regimes</span><span class="o">=</span><span class="n">n_regimes</span> <span class="k">if</span> <span class="n">generate</span> <span class="o">!=</span> <span class="s1">&#39;best&#39;</span> <span class="k">else</span> <span class="n">best_fit</span><span class="o">.</span><span class="n">n_regimes</span><span class="p">,</span>
</span><span id="reconstruct_noise-131"><a href="#reconstruct_noise-131"><span class="linenos">131</span></a>        <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
</span><span id="reconstruct_noise-132"><a href="#reconstruct_noise-132"><span class="linenos">132</span></a>        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="reconstruct_noise-133"><a href="#reconstruct_noise-133"><span class="linenos">133</span></a>    <span class="p">)</span>
</span><span id="reconstruct_noise-134"><a href="#reconstruct_noise-134"><span class="linenos">134</span></a>
</span><span id="reconstruct_noise-135"><a href="#reconstruct_noise-135"><span class="linenos">135</span></a>    <span class="c1"># Compute the SAM for the generated noise regimes</span>
</span><span id="reconstruct_noise-136"><a href="#reconstruct_noise-136"><span class="linenos">136</span></a>    <span class="n">fits</span> <span class="o">=</span> <span class="n">_compute_sam</span><span class="p">(</span><span class="n">fits</span><span class="p">,</span> <span class="n">removed_trace</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">psd_period</span><span class="o">=</span><span class="n">psd_period</span><span class="p">,</span> <span class="n">nfft</span><span class="o">=</span><span class="n">nfft</span><span class="p">)</span>
</span><span id="reconstruct_noise-137"><a href="#reconstruct_noise-137"><span class="linenos">137</span></a>
</span><span id="reconstruct_noise-138"><a href="#reconstruct_noise-138"><span class="linenos">138</span></a>    <span class="k">return</span> <span class="n">NoiseReconstructResults</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fits</span><span class="p">,</span> <span class="n">best_fit</span><span class="p">,</span> <span class="n">loss_curves</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function uses global differential evolution optimisation and local L-BFGS-B optimisation to fit a composition
of noise regimes to the power spectral density (PSD) of the noise, given by the trace without events. The fitting
accounts for the anti-aliasing filter parameters, enabling an accurate fit which respects the condition of the noise
post-sampling. Following, each individual noise regime is generated using a modified version of the spectral method
that expands into the negative detrended fluctuation analysis (DFA) alpha and applies post-generation scaling to
maximise the accuracy of each individual regime. Finally, the composition is computed, the anti-aliasing filter is
applied by estimating the Bessel filter using the window design method, and the spectral angular map (SAM) against
the true noise is computed to evaluate the quality of the reconstruction.</p>

<p>Note: This function is computationally expensive. It is recommended to drop popsize to 50 or lower to get an estimate
on the number of regimes, confirm solely the best fit with a conservative PSD period (e.g. 0.1 s) and then run a
higher popsize (e.g. 500) with a longer PSD period (e.g. 1-2 s) to get the best fit for the noise regimes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>trace (ndarray | Trace):</strong>  The trace to be processed or a Trace object. If ndarray, the sample rate must be provided.</li>
<li><strong>event_mask (ndarray | Events):</strong>  A boolean mask indicating the events in the trace or an Events object.</li>
<li><strong>n_regimes (int | list[int]):</strong>  The number of noise regimes to fit or a list of noise regime numbers to fit. Default is [2, 3].</li>
<li><strong>aa_order (int):</strong>  The order of the anti-aliasing filter.</li>
<li><strong>aa_cutoff (int):</strong>  The cutoff frequency for the anti-aliasing filter.</li>
<li><strong>sample_rate (int | None):</strong>  The sample rate of the trace. Has to be provided if trace is a ndarray. Default is None.</li>
<li><strong>maxiter (tuple[int, int]):</strong>  The maximum number evaluations for differential evolution and L-BFGS-B. Default is (2000, 10000).</li>
<li><strong>popsize (int):</strong>  The population size multiplier for differential evolution. Default is 500.</li>
<li><strong>mutation (tuple[float, float]):</strong>  The mutation constant for differential evolution. Default is (0.7, 1.2).</li>
<li><strong>psd_period (float | None):</strong>  The period for the PSD calculation. Default is None.</li>
<li><strong>nfft (int | None):</strong>  The length of FFT to use for PSD calculation. Default is None.</li>
<li><strong>generate (str | bool):</strong>  Whether to generate noise regimes. If 'Best', only the best fit is generated. Default is 'best'.</li>
<li><strong>complex_gen (bool):</strong>  Whether to generate noise regimes starting with complex noise. Default is False.</li>
<li><strong>random_state (int | None):</strong>  Random seed for reproducibility. Default is None.</li>
<li><strong>verbose (bool):</strong>  Whether to print verbose output during processing. Default is False.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>NoiseReconstructResults: An object containing the reconstruction results.</p>
</blockquote>
</div>


                </section>
                <section id="shape_cluster">
                            <input id="shape_cluster-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">shape_cluster</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">vectors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">|</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n"><a href="models.html#Events">notnormal.models.Events</a></span>,</span><span class="param">	<span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>,</span><span class="param">	<span class="n">direction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">n_components</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cosine&#39;</span>,</span><span class="param">	<span class="n">spread</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">min_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">n_neighbors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">init_params</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;kmeans&#39;</span>,</span><span class="param">	<span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>,</span><span class="param">	<span class="n">n_init</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">reconstruct</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">align</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">dist_losses</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">full_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n"><a href="models.html#ShapeClusterResults">notnormal.models.ShapeClusterResults</a></span>:</span></span>

                <label class="view-source-button" for="shape_cluster-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#shape_cluster"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="shape_cluster-31"><a href="#shape_cluster-31"><span class="linenos"> 31</span></a><span class="k">def</span><span class="w"> </span><span class="nf">shape_cluster</span><span class="p">(</span>
</span><span id="shape_cluster-32"><a href="#shape_cluster-32"><span class="linenos"> 32</span></a>    <span class="n">vectors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">|</span> <span class="n">ndarray</span> <span class="o">|</span> <span class="n">Events</span><span class="p">,</span>
</span><span id="shape_cluster-33"><a href="#shape_cluster-33"><span class="linenos"> 33</span></a>    <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">21</span><span class="p">)),</span>
</span><span id="shape_cluster-34"><a href="#shape_cluster-34"><span class="linenos"> 34</span></a>    <span class="n">direction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="shape_cluster-35"><a href="#shape_cluster-35"><span class="linenos"> 35</span></a>    <span class="n">n_components</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="shape_cluster-36"><a href="#shape_cluster-36"><span class="linenos"> 36</span></a>    <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cosine&#39;</span><span class="p">,</span>
</span><span id="shape_cluster-37"><a href="#shape_cluster-37"><span class="linenos"> 37</span></a>    <span class="n">spread</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="shape_cluster-38"><a href="#shape_cluster-38"><span class="linenos"> 38</span></a>    <span class="n">min_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="shape_cluster-39"><a href="#shape_cluster-39"><span class="linenos"> 39</span></a>    <span class="n">n_neighbors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="shape_cluster-40"><a href="#shape_cluster-40"><span class="linenos"> 40</span></a>    <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="shape_cluster-41"><a href="#shape_cluster-41"><span class="linenos"> 41</span></a>    <span class="n">init_params</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;kmeans&#39;</span><span class="p">,</span>
</span><span id="shape_cluster-42"><a href="#shape_cluster-42"><span class="linenos"> 42</span></a>    <span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="shape_cluster-43"><a href="#shape_cluster-43"><span class="linenos"> 43</span></a>    <span class="n">n_init</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="shape_cluster-44"><a href="#shape_cluster-44"><span class="linenos"> 44</span></a>    <span class="n">reconstruct</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="shape_cluster-45"><a href="#shape_cluster-45"><span class="linenos"> 45</span></a>    <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="shape_cluster-46"><a href="#shape_cluster-46"><span class="linenos"> 46</span></a>    <span class="n">align</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="shape_cluster-47"><a href="#shape_cluster-47"><span class="linenos"> 47</span></a>    <span class="n">dist_losses</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="shape_cluster-48"><a href="#shape_cluster-48"><span class="linenos"> 48</span></a>    <span class="n">full_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="shape_cluster-49"><a href="#shape_cluster-49"><span class="linenos"> 49</span></a>    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="shape_cluster-50"><a href="#shape_cluster-50"><span class="linenos"> 50</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ShapeClusterResults</span><span class="p">:</span>
</span><span id="shape_cluster-51"><a href="#shape_cluster-51"><span class="linenos"> 51</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="shape_cluster-52"><a href="#shape_cluster-52"><span class="linenos"> 52</span></a><span class="sd">    Shape cluster event vectors using Uniform Manifold Approximation and Projection, along with representative vector</span>
</span><span id="shape_cluster-53"><a href="#shape_cluster-53"><span class="linenos"> 53</span></a><span class="sd">    computation and subsequent reconstruction losses. The algorithm comes from the simple idea of shape being the</span>
</span><span id="shape_cluster-54"><a href="#shape_cluster-54"><span class="linenos"> 54</span></a><span class="sd">    principal encoder of analyte identity, with different scales representing different modes of transport and</span>
</span><span id="shape_cluster-55"><a href="#shape_cluster-55"><span class="linenos"> 55</span></a><span class="sd">    interaction. Each clustering operation produces a set of representative vectors from which the original event</span>
</span><span id="shape_cluster-56"><a href="#shape_cluster-56"><span class="linenos"> 56</span></a><span class="sd">    vectors are reconstructed to yield reconstruction losses. The optimal number of clusters is determined by</span>
</span><span id="shape_cluster-57"><a href="#shape_cluster-57"><span class="linenos"> 57</span></a><span class="sd">    the point of diminishing returns in reconstruction loss, with the associated representative vectors encoding the</span>
</span><span id="shape_cluster-58"><a href="#shape_cluster-58"><span class="linenos"> 58</span></a><span class="sd">    shapes in the population.</span>
</span><span id="shape_cluster-59"><a href="#shape_cluster-59"><span class="linenos"> 59</span></a>
</span><span id="shape_cluster-60"><a href="#shape_cluster-60"><span class="linenos"> 60</span></a><span class="sd">    Args:</span>
</span><span id="shape_cluster-61"><a href="#shape_cluster-61"><span class="linenos"> 61</span></a><span class="sd">        vectors (list[ndarray] | ndarray | Events): The event vectors to cluster. Should be 2D array-like or Events</span>
</span><span id="shape_cluster-62"><a href="#shape_cluster-62"><span class="linenos"> 62</span></a><span class="sd">            object. If Events object, direction must be specified. Otherwise, vectors must be monophasic, but not</span>
</span><span id="shape_cluster-63"><a href="#shape_cluster-63"><span class="linenos"> 63</span></a><span class="sd">            required to be strictly one-sided.</span>
</span><span id="shape_cluster-64"><a href="#shape_cluster-64"><span class="linenos"> 64</span></a><span class="sd">        k (int | list[int]): Number of clusters or list of cluster numbers. Default is range(2, 21).</span>
</span><span id="shape_cluster-65"><a href="#shape_cluster-65"><span class="linenos"> 65</span></a><span class="sd">        direction (int | None): The direction of the events. Has to be provided if vectors is an Events object, otherwise</span>
</span><span id="shape_cluster-66"><a href="#shape_cluster-66"><span class="linenos"> 66</span></a><span class="sd">            ignored. Default is None.</span>
</span><span id="shape_cluster-67"><a href="#shape_cluster-67"><span class="linenos"> 67</span></a><span class="sd">        n_components (int): Number of latent space dimensions (UMAP). Default is 10.</span>
</span><span id="shape_cluster-68"><a href="#shape_cluster-68"><span class="linenos"> 68</span></a><span class="sd">        metric (str): Metric to compute distances (UMAP). Default is &#39;cosine&#39;.</span>
</span><span id="shape_cluster-69"><a href="#shape_cluster-69"><span class="linenos"> 69</span></a><span class="sd">        spread (float): The effective scale of embedded points (UMAP). Default is 1.0.</span>
</span><span id="shape_cluster-70"><a href="#shape_cluster-70"><span class="linenos"> 70</span></a><span class="sd">        min_dist (float): The effective minimum distance between embedded points (UMAP). Default is 0.0.</span>
</span><span id="shape_cluster-71"><a href="#shape_cluster-71"><span class="linenos"> 71</span></a><span class="sd">        n_neighbors (int): Size of the local neighbourhood (UMAP). Default is 5.</span>
</span><span id="shape_cluster-72"><a href="#shape_cluster-72"><span class="linenos"> 72</span></a><span class="sd">        random_state (int | None): Random seed for reproducibility (UMAP, GMM). Default is None.</span>
</span><span id="shape_cluster-73"><a href="#shape_cluster-73"><span class="linenos"> 73</span></a><span class="sd">        init_params (str): The method used to initialise the weights (GMM). Default is &#39;kmeans&#39;.</span>
</span><span id="shape_cluster-74"><a href="#shape_cluster-74"><span class="linenos"> 74</span></a><span class="sd">        max_iter (int): Number of EM iterations (GMM). Default is 100.</span>
</span><span id="shape_cluster-75"><a href="#shape_cluster-75"><span class="linenos"> 75</span></a><span class="sd">        n_init (int): Number of initialisations (GMM). Default is 1.</span>
</span><span id="shape_cluster-76"><a href="#shape_cluster-76"><span class="linenos"> 76</span></a><span class="sd">        reconstruct (bool): Whether to reconstruct the event vectors from their representative vector. Default is True.</span>
</span><span id="shape_cluster-77"><a href="#shape_cluster-77"><span class="linenos"> 77</span></a><span class="sd">        sigma (float): The noise standard deviation for interpretability and stability. Default is 0.0.</span>
</span><span id="shape_cluster-78"><a href="#shape_cluster-78"><span class="linenos"> 78</span></a><span class="sd">        align (bool): Whether to align the vectors before calculating losses. Default is True.</span>
</span><span id="shape_cluster-79"><a href="#shape_cluster-79"><span class="linenos"> 79</span></a><span class="sd">        dist_losses (bool): Whether to compute the reconstruction distributional losses. Default is True.</span>
</span><span id="shape_cluster-80"><a href="#shape_cluster-80"><span class="linenos"> 80</span></a><span class="sd">        full_results (bool): Whether to return the globally normalised + transformed vectors in the results. Default is False.</span>
</span><span id="shape_cluster-81"><a href="#shape_cluster-81"><span class="linenos"> 81</span></a><span class="sd">        verbose (bool): Whether to print verbose output during processing. Default is False.</span>
</span><span id="shape_cluster-82"><a href="#shape_cluster-82"><span class="linenos"> 82</span></a>
</span><span id="shape_cluster-83"><a href="#shape_cluster-83"><span class="linenos"> 83</span></a><span class="sd">    Returns:</span>
</span><span id="shape_cluster-84"><a href="#shape_cluster-84"><span class="linenos"> 84</span></a><span class="sd">        ShapeClusterResults: An object containing the clustering results.</span>
</span><span id="shape_cluster-85"><a href="#shape_cluster-85"><span class="linenos"> 85</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="shape_cluster-86"><a href="#shape_cluster-86"><span class="linenos"> 86</span></a>
</span><span id="shape_cluster-87"><a href="#shape_cluster-87"><span class="linenos"> 87</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vectors</span><span class="p">,</span> <span class="n">Events</span><span class="p">):</span>
</span><span id="shape_cluster-88"><a href="#shape_cluster-88"><span class="linenos"> 88</span></a>        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="shape_cluster-89"><a href="#shape_cluster-89"><span class="linenos"> 89</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Direction must be specified if vectors is an Events object.&quot;</span><span class="p">)</span>
</span><span id="shape_cluster-90"><a href="#shape_cluster-90"><span class="linenos"> 90</span></a>        <span class="n">vectors</span> <span class="o">=</span> <span class="n">vectors</span><span class="o">.</span><span class="n">get_feature</span><span class="p">(</span><span class="s1">&#39;Vector&#39;</span><span class="p">,</span> <span class="n">filter_fn</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Direction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">direction</span><span class="p">)</span>
</span><span id="shape_cluster-91"><a href="#shape_cluster-91"><span class="linenos"> 91</span></a>
</span><span id="shape_cluster-92"><a href="#shape_cluster-92"><span class="linenos"> 92</span></a>    <span class="c1"># Get args</span>
</span><span id="shape_cluster-93"><a href="#shape_cluster-93"><span class="linenos"> 93</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">ShapeClusterArgs</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ShapeClusterArgs</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">})</span>
</span><span id="shape_cluster-94"><a href="#shape_cluster-94"><span class="linenos"> 94</span></a>
</span><span id="shape_cluster-95"><a href="#shape_cluster-95"><span class="linenos"> 95</span></a>    <span class="c1"># Normalise events</span>
</span><span id="shape_cluster-96"><a href="#shape_cluster-96"><span class="linenos"> 96</span></a>    <span class="n">area_norm</span><span class="p">,</span> <span class="n">length_norm</span> <span class="o">=</span> <span class="n">_normalise_events</span><span class="p">(</span><span class="n">vectors</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="shape_cluster-97"><a href="#shape_cluster-97"><span class="linenos"> 97</span></a>
</span><span id="shape_cluster-98"><a href="#shape_cluster-98"><span class="linenos"> 98</span></a>    <span class="c1"># Reduce dimensionality</span>
</span><span id="shape_cluster-99"><a href="#shape_cluster-99"><span class="linenos"> 99</span></a>    <span class="n">transform</span><span class="p">,</span> <span class="n">umap</span> <span class="o">=</span> <span class="n">_reduce_events</span><span class="p">(</span>
</span><span id="shape_cluster-100"><a href="#shape_cluster-100"><span class="linenos">100</span></a>        <span class="n">area_norm</span><span class="p">,</span>
</span><span id="shape_cluster-101"><a href="#shape_cluster-101"><span class="linenos">101</span></a>        <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span>
</span><span id="shape_cluster-102"><a href="#shape_cluster-102"><span class="linenos">102</span></a>        <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
</span><span id="shape_cluster-103"><a href="#shape_cluster-103"><span class="linenos">103</span></a>        <span class="n">spread</span><span class="o">=</span><span class="n">spread</span><span class="p">,</span>
</span><span id="shape_cluster-104"><a href="#shape_cluster-104"><span class="linenos">104</span></a>        <span class="n">min_dist</span><span class="o">=</span><span class="n">min_dist</span><span class="p">,</span>
</span><span id="shape_cluster-105"><a href="#shape_cluster-105"><span class="linenos">105</span></a>        <span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbors</span><span class="p">,</span>
</span><span id="shape_cluster-106"><a href="#shape_cluster-106"><span class="linenos">106</span></a>        <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
</span><span id="shape_cluster-107"><a href="#shape_cluster-107"><span class="linenos">107</span></a>        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="shape_cluster-108"><a href="#shape_cluster-108"><span class="linenos">108</span></a>    <span class="p">)</span>
</span><span id="shape_cluster-109"><a href="#shape_cluster-109"><span class="linenos">109</span></a>
</span><span id="shape_cluster-110"><a href="#shape_cluster-110"><span class="linenos">110</span></a>    <span class="c1"># Cluster the reduced vectors</span>
</span><span id="shape_cluster-111"><a href="#shape_cluster-111"><span class="linenos">111</span></a>    <span class="n">clusters</span> <span class="o">=</span> <span class="n">_cluster_latent</span><span class="p">(</span>
</span><span id="shape_cluster-112"><a href="#shape_cluster-112"><span class="linenos">112</span></a>        <span class="n">transform</span><span class="p">,</span>
</span><span id="shape_cluster-113"><a href="#shape_cluster-113"><span class="linenos">113</span></a>        <span class="n">vectors</span><span class="p">,</span>
</span><span id="shape_cluster-114"><a href="#shape_cluster-114"><span class="linenos">114</span></a>        <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
</span><span id="shape_cluster-115"><a href="#shape_cluster-115"><span class="linenos">115</span></a>        <span class="n">init_params</span><span class="o">=</span><span class="n">init_params</span><span class="p">,</span>
</span><span id="shape_cluster-116"><a href="#shape_cluster-116"><span class="linenos">116</span></a>        <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span>
</span><span id="shape_cluster-117"><a href="#shape_cluster-117"><span class="linenos">117</span></a>        <span class="n">n_init</span><span class="o">=</span><span class="n">n_init</span><span class="p">,</span>
</span><span id="shape_cluster-118"><a href="#shape_cluster-118"><span class="linenos">118</span></a>        <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
</span><span id="shape_cluster-119"><a href="#shape_cluster-119"><span class="linenos">119</span></a>        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="shape_cluster-120"><a href="#shape_cluster-120"><span class="linenos">120</span></a>    <span class="p">)</span>
</span><span id="shape_cluster-121"><a href="#shape_cluster-121"><span class="linenos">121</span></a>
</span><span id="shape_cluster-122"><a href="#shape_cluster-122"><span class="linenos">122</span></a>    <span class="c1"># Calculate representative vectors and losses</span>
</span><span id="shape_cluster-123"><a href="#shape_cluster-123"><span class="linenos">123</span></a>    <span class="n">clusters</span> <span class="o">=</span> <span class="n">_representative_vectors</span><span class="p">(</span>
</span><span id="shape_cluster-124"><a href="#shape_cluster-124"><span class="linenos">124</span></a>        <span class="n">clusters</span><span class="p">,</span>
</span><span id="shape_cluster-125"><a href="#shape_cluster-125"><span class="linenos">125</span></a>        <span class="n">reconstruct</span><span class="o">=</span><span class="n">reconstruct</span><span class="p">,</span>
</span><span id="shape_cluster-126"><a href="#shape_cluster-126"><span class="linenos">126</span></a>        <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
</span><span id="shape_cluster-127"><a href="#shape_cluster-127"><span class="linenos">127</span></a>        <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">,</span>
</span><span id="shape_cluster-128"><a href="#shape_cluster-128"><span class="linenos">128</span></a>        <span class="n">dist_losses</span><span class="o">=</span><span class="n">dist_losses</span><span class="p">,</span>
</span><span id="shape_cluster-129"><a href="#shape_cluster-129"><span class="linenos">129</span></a>        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="shape_cluster-130"><a href="#shape_cluster-130"><span class="linenos">130</span></a>    <span class="p">)</span>
</span><span id="shape_cluster-131"><a href="#shape_cluster-131"><span class="linenos">131</span></a>
</span><span id="shape_cluster-132"><a href="#shape_cluster-132"><span class="linenos">132</span></a>    <span class="c1"># Create results object</span>
</span><span id="shape_cluster-133"><a href="#shape_cluster-133"><span class="linenos">133</span></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">ShapeClusterResults</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">clusters</span><span class="p">)</span>
</span><span id="shape_cluster-134"><a href="#shape_cluster-134"><span class="linenos">134</span></a>
</span><span id="shape_cluster-135"><a href="#shape_cluster-135"><span class="linenos">135</span></a>    <span class="c1"># If full results are requested, add the normalised and transformed vectors</span>
</span><span id="shape_cluster-136"><a href="#shape_cluster-136"><span class="linenos">136</span></a>    <span class="k">if</span> <span class="n">full_results</span><span class="p">:</span>
</span><span id="shape_cluster-137"><a href="#shape_cluster-137"><span class="linenos">137</span></a>        <span class="n">results</span><span class="o">.</span><span class="n">area_norm</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">length_norm</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">umap</span> <span class="o">=</span> <span class="n">area_norm</span><span class="p">,</span> <span class="n">length_norm</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">umap</span>
</span><span id="shape_cluster-138"><a href="#shape_cluster-138"><span class="linenos">138</span></a>
</span><span id="shape_cluster-139"><a href="#shape_cluster-139"><span class="linenos">139</span></a>    <span class="c1"># Get the knee of reconstruction losses</span>
</span><span id="shape_cluster-140"><a href="#shape_cluster-140"><span class="linenos">140</span></a>    <span class="k">if</span> <span class="n">reconstruct</span><span class="p">:</span>
</span><span id="shape_cluster-141"><a href="#shape_cluster-141"><span class="linenos">141</span></a>        <span class="n">results</span><span class="o">.</span><span class="n">best_fit</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">loss_curves</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">knees</span> <span class="o">=</span> <span class="n">_get_knees</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span>
</span><span id="shape_cluster-142"><a href="#shape_cluster-142"><span class="linenos">142</span></a>
</span><span id="shape_cluster-143"><a href="#shape_cluster-143"><span class="linenos">143</span></a>    <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Shape cluster event vectors using Uniform Manifold Approximation and Projection, along with representative vector
computation and subsequent reconstruction losses. The algorithm comes from the simple idea of shape being the
principal encoder of analyte identity, with different scales representing different modes of transport and
interaction. Each clustering operation produces a set of representative vectors from which the original event
vectors are reconstructed to yield reconstruction losses. The optimal number of clusters is determined by
the point of diminishing returns in reconstruction loss, with the associated representative vectors encoding the
shapes in the population.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>vectors (list[ndarray] | ndarray | Events):</strong>  The event vectors to cluster. Should be 2D array-like or Events
object. If Events object, direction must be specified. Otherwise, vectors must be monophasic, but not
required to be strictly one-sided.</li>
<li><strong>k (int | list[int]):</strong>  Number of clusters or list of cluster numbers. Default is range(2, 21).</li>
<li><strong>direction (int | None):</strong>  The direction of the events. Has to be provided if vectors is an Events object, otherwise
ignored. Default is None.</li>
<li><strong>n_components (int):</strong>  Number of latent space dimensions (UMAP). Default is 10.</li>
<li><strong>metric (str):</strong>  Metric to compute distances (UMAP). Default is 'cosine'.</li>
<li><strong>spread (float):</strong>  The effective scale of embedded points (UMAP). Default is 1.0.</li>
<li><strong>min_dist (float):</strong>  The effective minimum distance between embedded points (UMAP). Default is 0.0.</li>
<li><strong>n_neighbors (int):</strong>  Size of the local neighbourhood (UMAP). Default is 5.</li>
<li><strong>random_state (int | None):</strong>  Random seed for reproducibility (UMAP, GMM). Default is None.</li>
<li><strong>init_params (str):</strong>  The method used to initialise the weights (GMM). Default is 'kmeans'.</li>
<li><strong>max_iter (int):</strong>  Number of EM iterations (GMM). Default is 100.</li>
<li><strong>n_init (int):</strong>  Number of initialisations (GMM). Default is 1.</li>
<li><strong>reconstruct (bool):</strong>  Whether to reconstruct the event vectors from their representative vector. Default is True.</li>
<li><strong>sigma (float):</strong>  The noise standard deviation for interpretability and stability. Default is 0.0.</li>
<li><strong>align (bool):</strong>  Whether to align the vectors before calculating losses. Default is True.</li>
<li><strong>dist_losses (bool):</strong>  Whether to compute the reconstruction distributional losses. Default is True.</li>
<li><strong>full_results (bool):</strong>  Whether to return the globally normalised + transformed vectors in the results. Default is False.</li>
<li><strong>verbose (bool):</strong>  Whether to print verbose output during processing. Default is False.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>ShapeClusterResults: An object containing the clustering results.</p>
</blockquote>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>