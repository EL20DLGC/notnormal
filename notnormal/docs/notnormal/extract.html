<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>notnormal.extract API documentation</title>
            <link rel="icon" href="assets\logo.png"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../notnormal.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;notnormal</a>

            <img src="assets\logo.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#initial_estimate">initial_estimate</a>
            </li>
            <li>
                    <a class="function" href="#iterate">iterate</a>
            </li>
            <li>
                    <a class="function" href="#not_normal">not_normal</a>
            </li>
            <li>
                    <a class="function" href="#parallel_iterate">parallel_iterate</a>
            </li>
            <li>
                    <a class="function" href="#simple_extractor">simple_extractor</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../notnormal.html">notnormal</a><wbr>.extract    </h1>

                
                        <input id="mod-extract-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-extract-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="c1"># Auto-generated __init__.py file.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.methods</span><span class="w"> </span><span class="kn">import</span> <span class="n">not_normal</span><span class="p">,</span> <span class="n">parallel_iterate</span><span class="p">,</span> <span class="n">iterate</span><span class="p">,</span> <span class="n">initial_estimate</span><span class="p">,</span> <span class="n">simple_extractor</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>    <span class="s2">&quot;initial_estimate&quot;</span><span class="p">,</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a>    <span class="s2">&quot;iterate&quot;</span><span class="p">,</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a>    <span class="s2">&quot;not_normal&quot;</span><span class="p">,</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a>    <span class="s2">&quot;parallel_iterate&quot;</span><span class="p">,</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a>    <span class="s2">&quot;simple_extractor&quot;</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="initial_estimate">
                            <input id="initial_estimate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">initial_estimate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">trace</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n"><a href="models.html#Trace">notnormal.models.Trace</a></span>,</span><span class="param">	<span class="n">filtered_trace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">sample_rate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">estimate_cutoff</span><span class="p">:</span> <span class="n">double</span> <span class="o">=</span> <span class="mf">10.0</span>,</span><span class="param">	<span class="n">replace_factor</span><span class="p">:</span> <span class="n">double</span> <span class="o">=</span> <span class="mf">8.0</span>,</span><span class="param">	<span class="n">replace_gap</span><span class="p">:</span> <span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span>,</span><span class="param">	<span class="n">threshold_window</span><span class="p">:</span> <span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span>,</span><span class="param">	<span class="n">z_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">output_features</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span>,</span><span class="param">	<span class="n">vector_results</span><span class="p">:</span> <span class="n">bint</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">_validate</span><span class="p">:</span> <span class="n">bint</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n"><a href="models.html#InitialEstimateResults">notnormal.models.InitialEstimateResults</a></span>:</span></span>

                <label class="view-source-button" for="initial_estimate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#initial_estimate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="initial_estimate-350"><a href="#initial_estimate-350"><span class="linenos">350</span></a><span class="k">def</span><span class="w"> </span><span class="nf">initial_estimate</span><span class="p">(</span>
</span><span id="initial_estimate-351"><a href="#initial_estimate-351"><span class="linenos">351</span></a>    <span class="n">trace</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">|</span> <span class="n">Trace</span><span class="p">,</span>
</span><span id="initial_estimate-352"><a href="#initial_estimate-352"><span class="linenos">352</span></a>    <span class="n">filtered_trace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="initial_estimate-353"><a href="#initial_estimate-353"><span class="linenos">353</span></a>    <span class="n">sample_rate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="initial_estimate-354"><a href="#initial_estimate-354"><span class="linenos">354</span></a>    <span class="n">estimate_cutoff</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
</span><span id="initial_estimate-355"><a href="#initial_estimate-355"><span class="linenos">355</span></a>    <span class="n">replace_factor</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span>
</span><span id="initial_estimate-356"><a href="#initial_estimate-356"><span class="linenos">356</span></a>    <span class="n">replace_gap</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="initial_estimate-357"><a href="#initial_estimate-357"><span class="linenos">357</span></a>    <span class="n">threshold_window</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="initial_estimate-358"><a href="#initial_estimate-358"><span class="linenos">358</span></a>    <span class="n">z_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="initial_estimate-359"><a href="#initial_estimate-359"><span class="linenos">359</span></a>    <span class="n">output_features</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span><span class="p">,</span>
</span><span id="initial_estimate-360"><a href="#initial_estimate-360"><span class="linenos">360</span></a>    <span class="n">vector_results</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">bint</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="initial_estimate-361"><a href="#initial_estimate-361"><span class="linenos">361</span></a>    <span class="n">_validate</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">bint</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="initial_estimate-362"><a href="#initial_estimate-362"><span class="linenos">362</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InitialEstimateResults</span><span class="p">:</span>
</span><span id="initial_estimate-363"><a href="#initial_estimate-363"><span class="linenos">363</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="initial_estimate-364"><a href="#initial_estimate-364"><span class="linenos">364</span></a><span class="sd">    Provides an initial estimate for the maximum cutoff frequency and event direction for the iterate function. The output</span>
</span><span id="initial_estimate-365"><a href="#initial_estimate-365"><span class="linenos">365</span></a><span class="sd">    events can also be used for wavelet filtering (notnormal.filter.methods.wavelet_filter). This is an improved version</span>
</span><span id="initial_estimate-366"><a href="#initial_estimate-366"><span class="linenos">366</span></a><span class="sd">    of the conventional event extraction method, using a robust sequence of iterations to make an initial estimate on</span>
</span><span id="initial_estimate-367"><a href="#initial_estimate-367"><span class="linenos">367</span></a><span class="sd">    the event population. From this, automatic iteration can be performed with the maximised cutoff frequency and event</span>
</span><span id="initial_estimate-368"><a href="#initial_estimate-368"><span class="linenos">368</span></a><span class="sd">    direction. The only required parameters are the input trace and sample_rate, with the estimate_cutoff frequency</span>
</span><span id="initial_estimate-369"><a href="#initial_estimate-369"><span class="linenos">369</span></a><span class="sd">    being the primary tuning parameter and ultimately decides how accurate the initial estimate is. Other parameters</span>
</span><span id="initial_estimate-370"><a href="#initial_estimate-370"><span class="linenos">370</span></a><span class="sd">    are provided for fine-tuning.</span>
</span><span id="initial_estimate-371"><a href="#initial_estimate-371"><span class="linenos">371</span></a>
</span><span id="initial_estimate-372"><a href="#initial_estimate-372"><span class="linenos">372</span></a><span class="sd">    Note: Both replace_factor and replace_gap as 0.0 indicates baseline replacement instead of individual replacement.</span>
</span><span id="initial_estimate-373"><a href="#initial_estimate-373"><span class="linenos">373</span></a>
</span><span id="initial_estimate-374"><a href="#initial_estimate-374"><span class="linenos">374</span></a><span class="sd">    Args:</span>
</span><span id="initial_estimate-375"><a href="#initial_estimate-375"><span class="linenos">375</span></a><span class="sd">        trace (ndarray | Trace): The input trace or a Trace object. If ndarray, the sample rate must be provided.</span>
</span><span id="initial_estimate-376"><a href="#initial_estimate-376"><span class="linenos">376</span></a><span class="sd">        filtered_trace (ndarray | None): The filtered version of the input trace, used for bounding events. If None,</span>
</span><span id="initial_estimate-377"><a href="#initial_estimate-377"><span class="linenos">377</span></a><span class="sd">            the trace is used. Default is None.</span>
</span><span id="initial_estimate-378"><a href="#initial_estimate-378"><span class="linenos">378</span></a><span class="sd">        sample_rate (int | None): The sample rate of the trace. Has to be provided if trace is a ndarray. Default is None.</span>
</span><span id="initial_estimate-379"><a href="#initial_estimate-379"><span class="linenos">379</span></a><span class="sd">        estimate_cutoff (float): The initial estimate for the cutoff frequency. Default is 10.0.</span>
</span><span id="initial_estimate-380"><a href="#initial_estimate-380"><span class="linenos">380</span></a><span class="sd">        replace_factor (float): Factor for replacing events in the calculation trace. Default is 8.0.</span>
</span><span id="initial_estimate-381"><a href="#initial_estimate-381"><span class="linenos">381</span></a><span class="sd">        replace_gap (float): Gap for replacing events in the calculation trace. Default is 2.0.</span>
</span><span id="initial_estimate-382"><a href="#initial_estimate-382"><span class="linenos">382</span></a><span class="sd">        threshold_window (float): The window size for threshold calculation. Default is 2.0.</span>
</span><span id="initial_estimate-383"><a href="#initial_estimate-383"><span class="linenos">383</span></a><span class="sd">        z_score (float | None): The Z-score for event detection. If None, it is calculated based on the trace length.</span>
</span><span id="initial_estimate-384"><a href="#initial_estimate-384"><span class="linenos">384</span></a><span class="sd">            Default is None.</span>
</span><span id="initial_estimate-385"><a href="#initial_estimate-385"><span class="linenos">385</span></a><span class="sd">        output_features (str | None): The output event features. Can be &#39;full&#39; for absolute features, &#39;FWHM&#39;, or &#39;FWQM&#39;</span>
</span><span id="initial_estimate-386"><a href="#initial_estimate-386"><span class="linenos">386</span></a><span class="sd">            for full width at half maximum or quarter maximum, respectively. These apply to duration, area, and peak</span>
</span><span id="initial_estimate-387"><a href="#initial_estimate-387"><span class="linenos">387</span></a><span class="sd">            amplitude. None specifies no events on the output. Default is &#39;full&#39;.</span>
</span><span id="initial_estimate-388"><a href="#initial_estimate-388"><span class="linenos">388</span></a><span class="sd">        vector_results (bool): Whether to return vector results, this is very expensive. Default is False.</span>
</span><span id="initial_estimate-389"><a href="#initial_estimate-389"><span class="linenos">389</span></a><span class="sd">        _validate (bool): Whether to validate the inputs. Do not disable unless you have validated externally.</span>
</span><span id="initial_estimate-390"><a href="#initial_estimate-390"><span class="linenos">390</span></a><span class="sd">            Default is True.</span>
</span><span id="initial_estimate-391"><a href="#initial_estimate-391"><span class="linenos">391</span></a>
</span><span id="initial_estimate-392"><a href="#initial_estimate-392"><span class="linenos">392</span></a><span class="sd">    Returns:</span>
</span><span id="initial_estimate-393"><a href="#initial_estimate-393"><span class="linenos">393</span></a><span class="sd">        InitialEstimateResults: An object containing the initial estimate results.</span>
</span><span id="initial_estimate-394"><a href="#initial_estimate-394"><span class="linenos">394</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="initial_estimate-395"><a href="#initial_estimate-395"><span class="linenos">395</span></a>
</span><span id="initial_estimate-396"><a href="#initial_estimate-396"><span class="linenos">396</span></a>    <span class="c1"># Validate all the inputs</span>
</span><span id="initial_estimate-397"><a href="#initial_estimate-397"><span class="linenos">397</span></a>    <span class="n">trace</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">filtered_trace</span><span class="p">,</span> <span class="n">z_score</span><span class="p">,</span> <span class="n">bl_args</span><span class="p">,</span> <span class="n">lr_args</span> <span class="o">=</span> <span class="n">_validate_input</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">estimate_cutoff</span><span class="p">,</span>
</span><span id="initial_estimate-398"><a href="#initial_estimate-398"><span class="linenos">398</span></a>        <span class="n">filtered_trace</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">replace_factor</span><span class="p">,</span> <span class="n">replace_gap</span><span class="p">,</span> <span class="n">threshold_window</span><span class="p">,</span> <span class="n">z_score</span><span class="p">,</span> <span class="n">output_features</span><span class="p">,</span> <span class="n">_validate</span><span class="o">=</span><span class="n">_validate</span><span class="p">)</span>
</span><span id="initial_estimate-399"><a href="#initial_estimate-399"><span class="linenos">399</span></a>
</span><span id="initial_estimate-400"><a href="#initial_estimate-400"><span class="linenos">400</span></a>    <span class="c1"># Get args</span>
</span><span id="initial_estimate-401"><a href="#initial_estimate-401"><span class="linenos">401</span></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">InitialEstimateResults</span><span class="p">(</span><span class="n">InitialEstimateArgs</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span>
</span><span id="initial_estimate-402"><a href="#initial_estimate-402"><span class="linenos">402</span></a>                                                            <span class="n">InitialEstimateArgs</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">}))</span>
</span><span id="initial_estimate-403"><a href="#initial_estimate-403"><span class="linenos">403</span></a>
</span><span id="initial_estimate-404"><a href="#initial_estimate-404"><span class="linenos">404</span></a>    <span class="c1"># Easter egg</span>
</span><span id="initial_estimate-405"><a href="#initial_estimate-405"><span class="linenos">405</span></a>    <span class="n">calc_trace</span> <span class="o">=</span> <span class="n">trace</span>
</span><span id="initial_estimate-406"><a href="#initial_estimate-406"><span class="linenos">406</span></a>    <span class="n">coordinates</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="initial_estimate-407"><a href="#initial_estimate-407"><span class="linenos">407</span></a>    <span class="n">current</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="initial_estimate-408"><a href="#initial_estimate-408"><span class="linenos">408</span></a>
</span><span id="initial_estimate-409"><a href="#initial_estimate-409"><span class="linenos">409</span></a>    <span class="c1"># Iterate 3 times</span>
</span><span id="initial_estimate-410"><a href="#initial_estimate-410"><span class="linenos">410</span></a>    <span class="n">i</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="initial_estimate-411"><a href="#initial_estimate-411"><span class="linenos">411</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="initial_estimate-412"><a href="#initial_estimate-412"><span class="linenos">412</span></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="initial_estimate-413"><a href="#initial_estimate-413"><span class="linenos">413</span></a>            <span class="c1"># Baseline, threshold, and trace statistics on the calculation trace</span>
</span><span id="initial_estimate-414"><a href="#initial_estimate-414"><span class="linenos">414</span></a>            <span class="n">baseline</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">trace_stats</span> <span class="o">=</span> <span class="n">_baseline_threshold</span><span class="p">(</span><span class="n">calc_trace</span><span class="p">,</span> <span class="n">event_coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span> <span class="o">**</span><span class="n">bl_args</span><span class="p">)</span>
</span><span id="initial_estimate-415"><a href="#initial_estimate-415"><span class="linenos">415</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="initial_estimate-416"><a href="#initial_estimate-416"><span class="linenos">416</span></a>            <span class="c1"># Do not compute trace statistics after the first iteration</span>
</span><span id="initial_estimate-417"><a href="#initial_estimate-417"><span class="linenos">417</span></a>            <span class="n">baseline</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="n">_baseline_threshold</span><span class="p">(</span><span class="n">calc_trace</span><span class="p">,</span> <span class="n">event_coordinates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compute_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">bl_args</span><span class="p">)</span>
</span><span id="initial_estimate-418"><a href="#initial_estimate-418"><span class="linenos">418</span></a>
</span><span id="initial_estimate-419"><a href="#initial_estimate-419"><span class="linenos">419</span></a>        <span class="c1"># Store results if vector_results or the final iteration</span>
</span><span id="initial_estimate-420"><a href="#initial_estimate-420"><span class="linenos">420</span></a>        <span class="n">current</span> <span class="o">=</span> <span class="n">Iteration</span><span class="p">()</span>
</span><span id="initial_estimate-421"><a href="#initial_estimate-421"><span class="linenos">421</span></a>        <span class="k">if</span> <span class="n">vector_results</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="initial_estimate-422"><a href="#initial_estimate-422"><span class="linenos">422</span></a>            <span class="n">current</span><span class="o">.</span><span class="n">calculation_trace</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">baseline</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">calc_trace</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">threshold</span>
</span><span id="initial_estimate-423"><a href="#initial_estimate-423"><span class="linenos">423</span></a>
</span><span id="initial_estimate-424"><a href="#initial_estimate-424"><span class="linenos">424</span></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="initial_estimate-425"><a href="#initial_estimate-425"><span class="linenos">425</span></a>            <span class="c1"># (1) Remove events from the side of most influence (save this initial threshold and direction)</span>
</span><span id="initial_estimate-426"><a href="#initial_estimate-426"><span class="linenos">426</span></a>            <span class="n">event_direction</span> <span class="o">=</span> <span class="s1">&#39;up&#39;</span> <span class="k">if</span> <span class="n">trace_stats</span><span class="p">[</span><span class="s1">&#39;Influence&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;down&#39;</span>
</span><span id="initial_estimate-427"><a href="#initial_estimate-427"><span class="linenos">427</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">initial_threshold</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">event_direction</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">trace_stats</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">event_direction</span><span class="p">,</span> <span class="n">trace_stats</span>
</span><span id="initial_estimate-428"><a href="#initial_estimate-428"><span class="linenos">428</span></a>            <span class="n">coordinates</span><span class="p">,</span> <span class="n">calc_trace</span><span class="p">,</span> <span class="n">event_stats</span> <span class="o">=</span> <span class="n">_locate_replace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">filtered_trace</span><span class="p">,</span> <span class="n">calc_trace</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span>
</span><span id="initial_estimate-429"><a href="#initial_estimate-429"><span class="linenos">429</span></a>                                                                   <span class="n">event_direction</span><span class="p">,</span> <span class="o">**</span><span class="n">lr_args</span><span class="p">)</span>
</span><span id="initial_estimate-430"><a href="#initial_estimate-430"><span class="linenos">430</span></a>        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="initial_estimate-431"><a href="#initial_estimate-431"><span class="linenos">431</span></a>            <span class="c1"># (2) Remove events from the opposite side</span>
</span><span id="initial_estimate-432"><a href="#initial_estimate-432"><span class="linenos">432</span></a>            <span class="n">coordinates</span><span class="p">,</span> <span class="n">calc_trace</span><span class="p">,</span> <span class="n">event_stats</span> <span class="o">=</span> <span class="n">_locate_replace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">filtered_trace</span><span class="p">,</span> <span class="n">calc_trace</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span>
</span><span id="initial_estimate-433"><a href="#initial_estimate-433"><span class="linenos">433</span></a>                                                       <span class="s1">&#39;up&#39;</span> <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">event_direction</span> <span class="o">==</span> <span class="s1">&#39;down&#39;</span> <span class="k">else</span> <span class="s1">&#39;down&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">lr_args</span><span class="p">)</span>
</span><span id="initial_estimate-434"><a href="#initial_estimate-434"><span class="linenos">434</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="initial_estimate-435"><a href="#initial_estimate-435"><span class="linenos">435</span></a>            <span class="c1"># (3) Final extraction now both sides are removed</span>
</span><span id="initial_estimate-436"><a href="#initial_estimate-436"><span class="linenos">436</span></a>            <span class="n">coordinates</span><span class="p">,</span> <span class="n">event_stats</span> <span class="o">=</span> <span class="n">_locate_replace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">filtered_trace</span><span class="p">,</span> <span class="n">calc_trace</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span>
</span><span id="initial_estimate-437"><a href="#initial_estimate-437"><span class="linenos">437</span></a>                                                       <span class="s1">&#39;biphasic&#39;</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">lr_args</span><span class="p">)</span>
</span><span id="initial_estimate-438"><a href="#initial_estimate-438"><span class="linenos">438</span></a>
</span><span id="initial_estimate-439"><a href="#initial_estimate-439"><span class="linenos">439</span></a>        <span class="c1"># Store results</span>
</span><span id="initial_estimate-440"><a href="#initial_estimate-440"><span class="linenos">440</span></a>        <span class="n">current</span><span class="o">.</span><span class="n">event_coordinates</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">event_stats</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">event_stats</span>
</span><span id="initial_estimate-441"><a href="#initial_estimate-441"><span class="linenos">441</span></a>        <span class="n">results</span><span class="o">.</span><span class="n">iterations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
</span><span id="initial_estimate-442"><a href="#initial_estimate-442"><span class="linenos">442</span></a>
</span><span id="initial_estimate-443"><a href="#initial_estimate-443"><span class="linenos">443</span></a>
</span><span id="initial_estimate-444"><a href="#initial_estimate-444"><span class="linenos">444</span></a>    <span class="c1"># (4) Calculate the required cutoffs (using the initial threshold)</span>
</span><span id="initial_estimate-445"><a href="#initial_estimate-445"><span class="linenos">445</span></a>    <span class="n">event_stats</span><span class="p">[</span><span class="s1">&#39;Max Cutoff&#39;</span><span class="p">],</span> <span class="n">all_cutoffs</span> <span class="o">=</span> <span class="n">_calculate_cutoffs</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">initial_threshold</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span>
</span><span id="initial_estimate-446"><a href="#initial_estimate-446"><span class="linenos">446</span></a>                                                                <span class="n">estimate_cutoff</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">)</span>
</span><span id="initial_estimate-447"><a href="#initial_estimate-447"><span class="linenos">447</span></a>    <span class="n">results</span><span class="o">.</span><span class="n">max_cutoff</span> <span class="o">=</span> <span class="n">event_stats</span><span class="p">[</span><span class="s1">&#39;Max Cutoff&#39;</span><span class="p">]</span>
</span><span id="initial_estimate-448"><a href="#initial_estimate-448"><span class="linenos">448</span></a>
</span><span id="initial_estimate-449"><a href="#initial_estimate-449"><span class="linenos">449</span></a>    <span class="c1"># If events are requested</span>
</span><span id="initial_estimate-450"><a href="#initial_estimate-450"><span class="linenos">450</span></a>    <span class="k">if</span> <span class="n">output_features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="initial_estimate-451"><a href="#initial_estimate-451"><span class="linenos">451</span></a>        <span class="c1"># Extract the events</span>
</span><span id="initial_estimate-452"><a href="#initial_estimate-452"><span class="linenos">452</span></a>        <span class="n">results</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">simple_extractor</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">output_features</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</span><span id="initial_estimate-453"><a href="#initial_estimate-453"><span class="linenos">453</span></a>        <span class="n">results</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="s1">&#39;Max Cutoff&#39;</span><span class="p">,</span> <span class="n">all_cutoffs</span><span class="p">)</span>
</span><span id="initial_estimate-454"><a href="#initial_estimate-454"><span class="linenos">454</span></a>
</span><span id="initial_estimate-455"><a href="#initial_estimate-455"><span class="linenos">455</span></a>        <span class="c1"># Expected number of extractions which are not events</span>
</span><span id="initial_estimate-456"><a href="#initial_estimate-456"><span class="linenos">456</span></a>        <span class="n">event_stats</span><span class="p">[</span><span class="s1">&#39;False Positives&#39;</span><span class="p">],</span> <span class="n">event_stats</span><span class="p">[</span><span class="s1">&#39;Significant Events&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_expected_outliers</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span>
</span><span id="initial_estimate-457"><a href="#initial_estimate-457"><span class="linenos">457</span></a>                                                                                               <span class="n">coordinates</span><span class="p">,</span> <span class="n">z_score</span><span class="p">)</span>
</span><span id="initial_estimate-458"><a href="#initial_estimate-458"><span class="linenos">458</span></a>
</span><span id="initial_estimate-459"><a href="#initial_estimate-459"><span class="linenos">459</span></a>    <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Provides an initial estimate for the maximum cutoff frequency and event direction for the iterate function. The output
events can also be used for wavelet filtering (<a href="filter.html#wavelet_filter">notnormal.filter.methods.wavelet_filter</a>). This is an improved version
of the conventional event extraction method, using a robust sequence of iterations to make an initial estimate on
the event population. From this, automatic iteration can be performed with the maximised cutoff frequency and event
direction. The only required parameters are the input trace and sample_rate, with the estimate_cutoff frequency
being the primary tuning parameter and ultimately decides how accurate the initial estimate is. Other parameters
are provided for fine-tuning.</p>

<p>Note: Both replace_factor and replace_gap as 0.0 indicates baseline replacement instead of individual replacement.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>trace (ndarray | Trace):</strong>  The input trace or a Trace object. If ndarray, the sample rate must be provided.</li>
<li><strong>filtered_trace (ndarray | None):</strong>  The filtered version of the input trace, used for bounding events. If None,
the trace is used. Default is None.</li>
<li><strong>sample_rate (int | None):</strong>  The sample rate of the trace. Has to be provided if trace is a ndarray. Default is None.</li>
<li><strong>estimate_cutoff (float):</strong>  The initial estimate for the cutoff frequency. Default is 10.0.</li>
<li><strong>replace_factor (float):</strong>  Factor for replacing events in the calculation trace. Default is 8.0.</li>
<li><strong>replace_gap (float):</strong>  Gap for replacing events in the calculation trace. Default is 2.0.</li>
<li><strong>threshold_window (float):</strong>  The window size for threshold calculation. Default is 2.0.</li>
<li><strong>z_score (float | None):</strong>  The Z-score for event detection. If None, it is calculated based on the trace length.
Default is None.</li>
<li><strong>output_features (str | None):</strong>  The output event features. Can be 'full' for absolute features, 'FWHM', or 'FWQM'
for full width at half maximum or quarter maximum, respectively. These apply to duration, area, and peak
amplitude. None specifies no events on the output. Default is 'full'.</li>
<li><strong>vector_results (bool):</strong>  Whether to return vector results, this is very expensive. Default is False.</li>
<li><strong>_validate (bool):</strong>  Whether to validate the inputs. Do not disable unless you have validated externally.
Default is True.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>InitialEstimateResults: An object containing the initial estimate results.</p>
</blockquote>
</div>


                </section>
                <section id="iterate">
                            <input id="iterate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">iterate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">trace</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n"><a href="models.html#Trace">notnormal.models.Trace</a></span>,</span><span class="param">	<span class="n">cutoff</span><span class="p">:</span> <span class="n">double</span>,</span><span class="param">	<span class="n">event_direction</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">filtered_trace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">sample_rate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">replace_factor</span><span class="p">:</span> <span class="n">double</span> <span class="o">=</span> <span class="mf">8.0</span>,</span><span class="param">	<span class="n">replace_gap</span><span class="p">:</span> <span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span>,</span><span class="param">	<span class="n">threshold_window</span><span class="p">:</span> <span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span>,</span><span class="param">	<span class="n">z_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">output_features</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span>,</span><span class="param">	<span class="n">vector_results</span><span class="p">:</span> <span class="n">bint</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">_validate</span><span class="p">:</span> <span class="n">bint</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n"><a href="models.html#IterateResults">notnormal.models.IterateResults</a></span>:</span></span>

                <label class="view-source-button" for="iterate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#iterate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="iterate-218"><a href="#iterate-218"><span class="linenos">218</span></a><span class="k">def</span><span class="w"> </span><span class="nf">iterate</span><span class="p">(</span>
</span><span id="iterate-219"><a href="#iterate-219"><span class="linenos">219</span></a>    <span class="n">trace</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">|</span> <span class="n">Trace</span><span class="p">,</span>
</span><span id="iterate-220"><a href="#iterate-220"><span class="linenos">220</span></a>    <span class="n">cutoff</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span>
</span><span id="iterate-221"><a href="#iterate-221"><span class="linenos">221</span></a>    <span class="n">event_direction</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="iterate-222"><a href="#iterate-222"><span class="linenos">222</span></a>    <span class="n">filtered_trace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="iterate-223"><a href="#iterate-223"><span class="linenos">223</span></a>    <span class="n">sample_rate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="iterate-224"><a href="#iterate-224"><span class="linenos">224</span></a>    <span class="n">replace_factor</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span>
</span><span id="iterate-225"><a href="#iterate-225"><span class="linenos">225</span></a>    <span class="n">replace_gap</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="iterate-226"><a href="#iterate-226"><span class="linenos">226</span></a>    <span class="n">threshold_window</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="iterate-227"><a href="#iterate-227"><span class="linenos">227</span></a>    <span class="n">z_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="iterate-228"><a href="#iterate-228"><span class="linenos">228</span></a>    <span class="n">output_features</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span><span class="p">,</span>
</span><span id="iterate-229"><a href="#iterate-229"><span class="linenos">229</span></a>    <span class="n">vector_results</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">bint</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="iterate-230"><a href="#iterate-230"><span class="linenos">230</span></a>    <span class="n">_validate</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">bint</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="iterate-231"><a href="#iterate-231"><span class="linenos">231</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IterateResults</span><span class="p">:</span>
</span><span id="iterate-232"><a href="#iterate-232"><span class="linenos">232</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="iterate-233"><a href="#iterate-233"><span class="linenos">233</span></a><span class="sd">    Performs iterative anomaly detection and baseline determination based on the input (maximised) cutoff frequency and</span>
</span><span id="iterate-234"><a href="#iterate-234"><span class="linenos">234</span></a><span class="sd">    event direction deduced from initial_estimate. This function is an advanced version of the iterative method, built</span>
</span><span id="iterate-235"><a href="#iterate-235"><span class="linenos">235</span></a><span class="sd">    to be automatic when paired with the initial estimate. It uses various mechanisms to circumvent the downfalls</span>
</span><span id="iterate-236"><a href="#iterate-236"><span class="linenos">236</span></a><span class="sd">    of the maximised cutoff frequency, individual local replacement, automatic influence calculation, and an automatic</span>
</span><span id="iterate-237"><a href="#iterate-237"><span class="linenos">237</span></a><span class="sd">    stopping criterion, among other advancements. The only required parameters are the input trace, sample_rate, cutoff,</span>
</span><span id="iterate-238"><a href="#iterate-238"><span class="linenos">238</span></a><span class="sd">    and event_direction. The primary tuning parameters are the replace_factor and replace_gap, which determine how</span>
</span><span id="iterate-239"><a href="#iterate-239"><span class="linenos">239</span></a><span class="sd">    aggressive the individual replacement is and how much the event samples influence the replacement. When Both</span>
</span><span id="iterate-240"><a href="#iterate-240"><span class="linenos">240</span></a><span class="sd">    replace_factor and replace_gap are 0.0, baseline replacement is done instead of individual replacement. Other</span>
</span><span id="iterate-241"><a href="#iterate-241"><span class="linenos">241</span></a><span class="sd">    parameters are provided for fine-tuning.</span>
</span><span id="iterate-242"><a href="#iterate-242"><span class="linenos">242</span></a>
</span><span id="iterate-243"><a href="#iterate-243"><span class="linenos">243</span></a><span class="sd">    Note on the final extraction after iteration: When the stopping criterion is met, the (calc_trace - baseline) used</span>
</span><span id="iterate-244"><a href="#iterate-244"><span class="linenos">244</span></a><span class="sd">    in the previous iteration was the best for normality, so we use the event coordinates determined from that iteration</span>
</span><span id="iterate-245"><a href="#iterate-245"><span class="linenos">245</span></a><span class="sd">    (compared vs. best normality). The replacement of those coordinates then indicates that all events are replaced,</span>
</span><span id="iterate-246"><a href="#iterate-246"><span class="linenos">246</span></a><span class="sd">    so we use the calc_trace and baseline determined from this replacement. In other words, the calc_trace and baseline</span>
</span><span id="iterate-247"><a href="#iterate-247"><span class="linenos">247</span></a><span class="sd">    from the next iteration which triggered the stopping criterion. We then replace event locations in the baseline with</span>
</span><span id="iterate-248"><a href="#iterate-248"><span class="linenos">248</span></a><span class="sd">    the calc_trace, as this is a locally optimal baseline once we are sure all events have been replaced. Then, a final</span>
</span><span id="iterate-249"><a href="#iterate-249"><span class="linenos">249</span></a><span class="sd">    threshold is computed using the std method (more accurate without outliers) on the calc_trace - baseline, which is</span>
</span><span id="iterate-250"><a href="#iterate-250"><span class="linenos">250</span></a><span class="sd">    now a fully removed trace. Thus, the final extraction is computed on the locally optimal baseline and threshold.</span>
</span><span id="iterate-251"><a href="#iterate-251"><span class="linenos">251</span></a>
</span><span id="iterate-252"><a href="#iterate-252"><span class="linenos">252</span></a><span class="sd">    Args:</span>
</span><span id="iterate-253"><a href="#iterate-253"><span class="linenos">253</span></a><span class="sd">        trace (ndarray | Trace): The input trace or a Trace object. If ndarray, the sample rate must be provided.</span>
</span><span id="iterate-254"><a href="#iterate-254"><span class="linenos">254</span></a><span class="sd">        cutoff (float): The cutoff frequency for the baseline filter derived from initial_estimate.</span>
</span><span id="iterate-255"><a href="#iterate-255"><span class="linenos">255</span></a><span class="sd">        event_direction (str): The direction of events (&#39;up&#39;, &#39;down&#39;, or &#39;biphasic&#39;) derived from initial_estimate.</span>
</span><span id="iterate-256"><a href="#iterate-256"><span class="linenos">256</span></a><span class="sd">        filtered_trace (ndarray | None): The filtered version of the input trace, used for bounding events.</span>
</span><span id="iterate-257"><a href="#iterate-257"><span class="linenos">257</span></a><span class="sd">            If None, the trace is used. Default is None.</span>
</span><span id="iterate-258"><a href="#iterate-258"><span class="linenos">258</span></a><span class="sd">        sample_rate (int | None): The sample rate of the trace. Has to be provided if trace is a ndarray. Default is None.</span>
</span><span id="iterate-259"><a href="#iterate-259"><span class="linenos">259</span></a><span class="sd">        replace_factor (float): Factor for replacing events in the calculation trace. Default is 8.0.</span>
</span><span id="iterate-260"><a href="#iterate-260"><span class="linenos">260</span></a><span class="sd">        replace_gap (float): Gap for replacing events in the calculation trace. Default is 2.0.</span>
</span><span id="iterate-261"><a href="#iterate-261"><span class="linenos">261</span></a><span class="sd">        threshold_window (float): The window size for threshold calculation. Default is 2.0.</span>
</span><span id="iterate-262"><a href="#iterate-262"><span class="linenos">262</span></a><span class="sd">        z_score (float | None): The Z-score for event detection. If None, it is calculated based on the trace length.</span>
</span><span id="iterate-263"><a href="#iterate-263"><span class="linenos">263</span></a><span class="sd">            Default is None.</span>
</span><span id="iterate-264"><a href="#iterate-264"><span class="linenos">264</span></a><span class="sd">        output_features (str | None): The output event features. Can be &#39;full&#39; for absolute features, &#39;FWHM&#39;, or &#39;FWQM&#39;</span>
</span><span id="iterate-265"><a href="#iterate-265"><span class="linenos">265</span></a><span class="sd">            for full width at half maximum or quarter maximum, respectively. These apply to duration, area, and peak</span>
</span><span id="iterate-266"><a href="#iterate-266"><span class="linenos">266</span></a><span class="sd">            amplitude. None specifies no events on the output. Default is &#39;full&#39;.</span>
</span><span id="iterate-267"><a href="#iterate-267"><span class="linenos">267</span></a><span class="sd">        vector_results (bool): Whether to return vector results, this is very expensive. Default is False.</span>
</span><span id="iterate-268"><a href="#iterate-268"><span class="linenos">268</span></a><span class="sd">        _validate (bool): Whether to validate the inputs. Do not disable unless you have validated externally.</span>
</span><span id="iterate-269"><a href="#iterate-269"><span class="linenos">269</span></a><span class="sd">            Default is True.</span>
</span><span id="iterate-270"><a href="#iterate-270"><span class="linenos">270</span></a>
</span><span id="iterate-271"><a href="#iterate-271"><span class="linenos">271</span></a><span class="sd">    Returns:</span>
</span><span id="iterate-272"><a href="#iterate-272"><span class="linenos">272</span></a><span class="sd">        IterateResults: An object containing the iterate results.</span>
</span><span id="iterate-273"><a href="#iterate-273"><span class="linenos">273</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="iterate-274"><a href="#iterate-274"><span class="linenos">274</span></a>
</span><span id="iterate-275"><a href="#iterate-275"><span class="linenos">275</span></a>    <span class="c1"># Validate all the inputs</span>
</span><span id="iterate-276"><a href="#iterate-276"><span class="linenos">276</span></a>    <span class="n">trace</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">filtered_trace</span><span class="p">,</span> <span class="n">z_score</span><span class="p">,</span> <span class="n">bl_args</span><span class="p">,</span> <span class="n">lr_args</span> <span class="o">=</span> <span class="n">_validate_input</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">filtered_trace</span><span class="p">,</span>
</span><span id="iterate-277"><a href="#iterate-277"><span class="linenos">277</span></a>       <span class="n">sample_rate</span><span class="p">,</span> <span class="n">replace_factor</span><span class="p">,</span> <span class="n">replace_gap</span><span class="p">,</span> <span class="n">threshold_window</span><span class="p">,</span> <span class="n">z_score</span><span class="p">,</span> <span class="n">output_features</span><span class="p">,</span> <span class="n">event_direction</span><span class="p">,</span> <span class="n">_validate</span><span class="p">)</span>
</span><span id="iterate-278"><a href="#iterate-278"><span class="linenos">278</span></a>
</span><span id="iterate-279"><a href="#iterate-279"><span class="linenos">279</span></a>    <span class="c1"># Init results and get args</span>
</span><span id="iterate-280"><a href="#iterate-280"><span class="linenos">280</span></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">IterateResults</span><span class="p">(</span><span class="n">IterateArgs</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">IterateArgs</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">}))</span>
</span><span id="iterate-281"><a href="#iterate-281"><span class="linenos">281</span></a>
</span><span id="iterate-282"><a href="#iterate-282"><span class="linenos">282</span></a>    <span class="c1"># Easter egg</span>
</span><span id="iterate-283"><a href="#iterate-283"><span class="linenos">283</span></a>    <span class="n">calc_trace</span> <span class="o">=</span> <span class="n">trace</span>
</span><span id="iterate-284"><a href="#iterate-284"><span class="linenos">284</span></a>    <span class="n">coordinates</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="iterate-285"><a href="#iterate-285"><span class="linenos">285</span></a>    <span class="n">current</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="iterate-286"><a href="#iterate-286"><span class="linenos">286</span></a>
</span><span id="iterate-287"><a href="#iterate-287"><span class="linenos">287</span></a>    <span class="c1"># Iterate until the stopping criterion is met</span>
</span><span id="iterate-288"><a href="#iterate-288"><span class="linenos">288</span></a>    <span class="n">i</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="iterate-289"><a href="#iterate-289"><span class="linenos">289</span></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="iterate-290"><a href="#iterate-290"><span class="linenos">290</span></a>        <span class="c1"># Baseline, threshold, and trace statistics on the calculation trace</span>
</span><span id="iterate-291"><a href="#iterate-291"><span class="linenos">291</span></a>        <span class="n">baseline</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">trace_stats</span> <span class="o">=</span> <span class="n">_baseline_threshold</span><span class="p">(</span><span class="n">calc_trace</span><span class="p">,</span> <span class="n">event_coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span> <span class="o">**</span><span class="n">bl_args</span><span class="p">)</span>
</span><span id="iterate-292"><a href="#iterate-292"><span class="linenos">292</span></a>
</span><span id="iterate-293"><a href="#iterate-293"><span class="linenos">293</span></a>        <span class="c1"># For calculating maximum cutoffs</span>
</span><span id="iterate-294"><a href="#iterate-294"><span class="linenos">294</span></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="iterate-295"><a href="#iterate-295"><span class="linenos">295</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">initial_threshold</span> <span class="o">=</span> <span class="n">threshold</span>
</span><span id="iterate-296"><a href="#iterate-296"><span class="linenos">296</span></a>
</span><span id="iterate-297"><a href="#iterate-297"><span class="linenos">297</span></a>        <span class="c1"># Stopping criterion</span>
</span><span id="iterate-298"><a href="#iterate-298"><span class="linenos">298</span></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">trace_stats</span><span class="p">[</span><span class="s1">&#39;Overall&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">current</span><span class="o">.</span><span class="n">trace_stats</span><span class="p">[</span><span class="s1">&#39;Overall&#39;</span><span class="p">]:</span>
</span><span id="iterate-299"><a href="#iterate-299"><span class="linenos">299</span></a>            <span class="k">break</span>
</span><span id="iterate-300"><a href="#iterate-300"><span class="linenos">300</span></a>
</span><span id="iterate-301"><a href="#iterate-301"><span class="linenos">301</span></a>        <span class="c1"># Direction criterion</span>
</span><span id="iterate-302"><a href="#iterate-302"><span class="linenos">302</span></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">event_direction</span> <span class="o">==</span> <span class="s1">&#39;down&#39;</span> <span class="ow">and</span> <span class="n">trace_stats</span><span class="p">[</span><span class="s1">&#39;Influence&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span>
</span><span id="iterate-303"><a href="#iterate-303"><span class="linenos">303</span></a>                      <span class="n">event_direction</span> <span class="o">==</span> <span class="s1">&#39;up&#39;</span> <span class="ow">and</span> <span class="n">trace_stats</span><span class="p">[</span><span class="s1">&#39;Influence&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="iterate-304"><a href="#iterate-304"><span class="linenos">304</span></a>            <span class="n">event_direction</span> <span class="o">=</span> <span class="s1">&#39;biphasic&#39;</span>
</span><span id="iterate-305"><a href="#iterate-305"><span class="linenos">305</span></a>
</span><span id="iterate-306"><a href="#iterate-306"><span class="linenos">306</span></a>        <span class="c1"># Store results</span>
</span><span id="iterate-307"><a href="#iterate-307"><span class="linenos">307</span></a>        <span class="n">current</span> <span class="o">=</span> <span class="n">Iteration</span><span class="p">()</span>
</span><span id="iterate-308"><a href="#iterate-308"><span class="linenos">308</span></a>        <span class="k">if</span> <span class="n">vector_results</span><span class="p">:</span>
</span><span id="iterate-309"><a href="#iterate-309"><span class="linenos">309</span></a>            <span class="n">current</span><span class="o">.</span><span class="n">calculation_trace</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">baseline</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">calc_trace</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">threshold</span>
</span><span id="iterate-310"><a href="#iterate-310"><span class="linenos">310</span></a>
</span><span id="iterate-311"><a href="#iterate-311"><span class="linenos">311</span></a>        <span class="c1"># Locate events from the raw trace, bounds from the filtered trace, and replace events in the calculation trace</span>
</span><span id="iterate-312"><a href="#iterate-312"><span class="linenos">312</span></a>        <span class="n">coordinates</span><span class="p">,</span> <span class="n">calc_trace</span><span class="p">,</span> <span class="n">event_stats</span> <span class="o">=</span> <span class="n">_locate_replace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">filtered_trace</span><span class="p">,</span> <span class="n">calc_trace</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span>
</span><span id="iterate-313"><a href="#iterate-313"><span class="linenos">313</span></a>                                                               <span class="n">event_direction</span><span class="p">,</span> <span class="o">**</span><span class="n">lr_args</span><span class="p">)</span>
</span><span id="iterate-314"><a href="#iterate-314"><span class="linenos">314</span></a>
</span><span id="iterate-315"><a href="#iterate-315"><span class="linenos">315</span></a>        <span class="c1"># Store results</span>
</span><span id="iterate-316"><a href="#iterate-316"><span class="linenos">316</span></a>        <span class="n">current</span><span class="o">.</span><span class="n">trace_stats</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">event_coordinates</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">event_stats</span> <span class="o">=</span> <span class="n">trace_stats</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">event_stats</span>
</span><span id="iterate-317"><a href="#iterate-317"><span class="linenos">317</span></a>        <span class="n">results</span><span class="o">.</span><span class="n">iterations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
</span><span id="iterate-318"><a href="#iterate-318"><span class="linenos">318</span></a>        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="iterate-319"><a href="#iterate-319"><span class="linenos">319</span></a>
</span><span id="iterate-320"><a href="#iterate-320"><span class="linenos">320</span></a>    <span class="c1"># Determine the final baseline and threshold before extracting the final events</span>
</span><span id="iterate-321"><a href="#iterate-321"><span class="linenos">321</span></a>    <span class="n">trace_stats</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">trace_stats</span>
</span><span id="iterate-322"><a href="#iterate-322"><span class="linenos">322</span></a>    <span class="n">coordinate_view</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">longlong</span><span class="p">[:,</span> <span class="p">::</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">event_coordinates</span>
</span><span id="iterate-323"><a href="#iterate-323"><span class="linenos">323</span></a>    <span class="n">baseline</span> <span class="o">=</span> <span class="n">_event_replacer</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">calc_trace</span><span class="p">,</span> <span class="n">coordinate_view</span><span class="p">,</span> <span class="n">replace_factor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">replace_gap</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="iterate-324"><a href="#iterate-324"><span class="linenos">324</span></a>    <span class="n">threshold</span> <span class="o">=</span> <span class="n">_thresholder</span><span class="p">((</span><span class="n">calc_trace</span> <span class="o">-</span> <span class="n">baseline</span><span class="p">),</span> <span class="n">z_score</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">threshold_window</span> <span class="o">*</span> <span class="n">sample_rate</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;std&#39;</span><span class="p">,</span>
</span><span id="iterate-325"><a href="#iterate-325"><span class="linenos">325</span></a>                              <span class="n">event_mask</span><span class="o">=</span><span class="n">__event_mask</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">event_coordinates</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)))</span>
</span><span id="iterate-326"><a href="#iterate-326"><span class="linenos">326</span></a>    <span class="n">coordinates</span><span class="p">,</span> <span class="n">event_stats</span> <span class="o">=</span> <span class="n">_locate_replace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">filtered_trace</span><span class="p">,</span> <span class="n">calc_trace</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span>
</span><span id="iterate-327"><a href="#iterate-327"><span class="linenos">327</span></a>                                          <span class="s1">&#39;biphasic&#39;</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">lr_args</span><span class="p">)</span>
</span><span id="iterate-328"><a href="#iterate-328"><span class="linenos">328</span></a>
</span><span id="iterate-329"><a href="#iterate-329"><span class="linenos">329</span></a>    <span class="c1"># If events are requested</span>
</span><span id="iterate-330"><a href="#iterate-330"><span class="linenos">330</span></a>    <span class="k">if</span> <span class="n">output_features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="iterate-331"><a href="#iterate-331"><span class="linenos">331</span></a>        <span class="c1"># Extract the events</span>
</span><span id="iterate-332"><a href="#iterate-332"><span class="linenos">332</span></a>        <span class="n">results</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">simple_extractor</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">output_features</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</span><span id="iterate-333"><a href="#iterate-333"><span class="linenos">333</span></a>
</span><span id="iterate-334"><a href="#iterate-334"><span class="linenos">334</span></a>        <span class="c1"># Calculate the required cutoffs (using the initial threshold)</span>
</span><span id="iterate-335"><a href="#iterate-335"><span class="linenos">335</span></a>        <span class="n">event_stats</span><span class="p">[</span><span class="s1">&#39;Max Cutoff&#39;</span><span class="p">],</span> <span class="n">all_cutoffs</span> <span class="o">=</span> <span class="n">_calculate_cutoffs</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">initial_threshold</span><span class="p">,</span>
</span><span id="iterate-336"><a href="#iterate-336"><span class="linenos">336</span></a>                                                                    <span class="n">coordinates</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">)</span>
</span><span id="iterate-337"><a href="#iterate-337"><span class="linenos">337</span></a>        <span class="n">results</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="s1">&#39;Max Cutoff&#39;</span><span class="p">,</span> <span class="n">all_cutoffs</span><span class="p">)</span>
</span><span id="iterate-338"><a href="#iterate-338"><span class="linenos">338</span></a>
</span><span id="iterate-339"><a href="#iterate-339"><span class="linenos">339</span></a>        <span class="c1"># Expected number of extractions which are not events</span>
</span><span id="iterate-340"><a href="#iterate-340"><span class="linenos">340</span></a>        <span class="n">event_stats</span><span class="p">[</span><span class="s1">&#39;False Positives&#39;</span><span class="p">],</span> <span class="n">event_stats</span><span class="p">[</span><span class="s1">&#39;Significant Events&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_expected_outliers</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span>
</span><span id="iterate-341"><a href="#iterate-341"><span class="linenos">341</span></a>                                                                                               <span class="n">coordinates</span><span class="p">,</span> <span class="n">z_score</span><span class="p">)</span>
</span><span id="iterate-342"><a href="#iterate-342"><span class="linenos">342</span></a>
</span><span id="iterate-343"><a href="#iterate-343"><span class="linenos">343</span></a>    <span class="c1"># Store the final vectors</span>
</span><span id="iterate-344"><a href="#iterate-344"><span class="linenos">344</span></a>    <span class="n">results</span><span class="o">.</span><span class="n">iterations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Iteration</span><span class="p">(</span><span class="n">calculation_trace</span><span class="o">=</span><span class="n">calc_trace</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
</span><span id="iterate-345"><a href="#iterate-345"><span class="linenos">345</span></a>                                        <span class="n">trace_stats</span><span class="o">=</span><span class="n">trace_stats</span><span class="p">,</span> <span class="n">event_coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">event_stats</span><span class="o">=</span><span class="n">event_stats</span><span class="p">))</span>
</span><span id="iterate-346"><a href="#iterate-346"><span class="linenos">346</span></a>
</span><span id="iterate-347"><a href="#iterate-347"><span class="linenos">347</span></a>    <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Performs iterative anomaly detection and baseline determination based on the input (maximised) cutoff frequency and
event direction deduced from initial_estimate. This function is an advanced version of the iterative method, built
to be automatic when paired with the initial estimate. It uses various mechanisms to circumvent the downfalls
of the maximised cutoff frequency, individual local replacement, automatic influence calculation, and an automatic
stopping criterion, among other advancements. The only required parameters are the input trace, sample_rate, cutoff,
and event_direction. The primary tuning parameters are the replace_factor and replace_gap, which determine how
aggressive the individual replacement is and how much the event samples influence the replacement. When Both
replace_factor and replace_gap are 0.0, baseline replacement is done instead of individual replacement. Other
parameters are provided for fine-tuning.</p>

<p>Note on the final extraction after iteration: When the stopping criterion is met, the (calc_trace - baseline) used
in the previous iteration was the best for normality, so we use the event coordinates determined from that iteration
(compared vs. best normality). The replacement of those coordinates then indicates that all events are replaced,
so we use the calc_trace and baseline determined from this replacement. In other words, the calc_trace and baseline
from the next iteration which triggered the stopping criterion. We then replace event locations in the baseline with
the calc_trace, as this is a locally optimal baseline once we are sure all events have been replaced. Then, a final
threshold is computed using the std method (more accurate without outliers) on the calc_trace - baseline, which is
now a fully removed trace. Thus, the final extraction is computed on the locally optimal baseline and threshold.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>trace (ndarray | Trace):</strong>  The input trace or a Trace object. If ndarray, the sample rate must be provided.</li>
<li><strong>cutoff (float):</strong>  The cutoff frequency for the baseline filter derived from initial_estimate.</li>
<li><strong>event_direction (str):</strong>  The direction of events ('up', 'down', or 'biphasic') derived from initial_estimate.</li>
<li><strong>filtered_trace (ndarray | None):</strong>  The filtered version of the input trace, used for bounding events.
If None, the trace is used. Default is None.</li>
<li><strong>sample_rate (int | None):</strong>  The sample rate of the trace. Has to be provided if trace is a ndarray. Default is None.</li>
<li><strong>replace_factor (float):</strong>  Factor for replacing events in the calculation trace. Default is 8.0.</li>
<li><strong>replace_gap (float):</strong>  Gap for replacing events in the calculation trace. Default is 2.0.</li>
<li><strong>threshold_window (float):</strong>  The window size for threshold calculation. Default is 2.0.</li>
<li><strong>z_score (float | None):</strong>  The Z-score for event detection. If None, it is calculated based on the trace length.
Default is None.</li>
<li><strong>output_features (str | None):</strong>  The output event features. Can be 'full' for absolute features, 'FWHM', or 'FWQM'
for full width at half maximum or quarter maximum, respectively. These apply to duration, area, and peak
amplitude. None specifies no events on the output. Default is 'full'.</li>
<li><strong>vector_results (bool):</strong>  Whether to return vector results, this is very expensive. Default is False.</li>
<li><strong>_validate (bool):</strong>  Whether to validate the inputs. Do not disable unless you have validated externally.
Default is True.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>IterateResults: An object containing the iterate results.</p>
</blockquote>
</div>


                </section>
                <section id="not_normal">
                            <input id="not_normal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">not_normal</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">trace</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n"><a href="models.html#Trace">notnormal.models.Trace</a></span>,</span><span class="param">	<span class="n">sample_rate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">bounds_window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">estimate_cutoff</span><span class="p">:</span> <span class="n">double</span> <span class="o">=</span> <span class="mf">10.0</span>,</span><span class="param">	<span class="n">replace_factor</span><span class="p">:</span> <span class="n">double</span> <span class="o">=</span> <span class="mf">8.0</span>,</span><span class="param">	<span class="n">replace_gap</span><span class="p">:</span> <span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span>,</span><span class="param">	<span class="n">threshold_window</span><span class="p">:</span> <span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span>,</span><span class="param">	<span class="n">z_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">output_features</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span>,</span><span class="param">	<span class="n">vector_results</span><span class="p">:</span> <span class="n">bint</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">parallel</span><span class="p">:</span> <span class="n">bint</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n"><a href="models.html#IterateResults">notnormal.models.IterateResults</a></span><span class="p">,</span> <span class="n"><a href="models.html#InitialEstimateResults">notnormal.models.InitialEstimateResults</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="not_normal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#not_normal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="not_normal-32"><a href="#not_normal-32"><span class="linenos">32</span></a><span class="k">def</span><span class="w"> </span><span class="nf">not_normal</span><span class="p">(</span>
</span><span id="not_normal-33"><a href="#not_normal-33"><span class="linenos">33</span></a>    <span class="n">trace</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">|</span> <span class="n">Trace</span><span class="p">,</span>
</span><span id="not_normal-34"><a href="#not_normal-34"><span class="linenos">34</span></a>    <span class="n">sample_rate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="not_normal-35"><a href="#not_normal-35"><span class="linenos">35</span></a>    <span class="n">bounds_window</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="not_normal-36"><a href="#not_normal-36"><span class="linenos">36</span></a>    <span class="n">estimate_cutoff</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
</span><span id="not_normal-37"><a href="#not_normal-37"><span class="linenos">37</span></a>    <span class="n">replace_factor</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span>
</span><span id="not_normal-38"><a href="#not_normal-38"><span class="linenos">38</span></a>    <span class="n">replace_gap</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="not_normal-39"><a href="#not_normal-39"><span class="linenos">39</span></a>    <span class="n">threshold_window</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="not_normal-40"><a href="#not_normal-40"><span class="linenos">40</span></a>    <span class="n">z_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="not_normal-41"><a href="#not_normal-41"><span class="linenos">41</span></a>    <span class="n">output_features</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span><span class="p">,</span>
</span><span id="not_normal-42"><a href="#not_normal-42"><span class="linenos">42</span></a>    <span class="n">vector_results</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">bint</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="not_normal-43"><a href="#not_normal-43"><span class="linenos">43</span></a>    <span class="n">parallel</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">bint</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="not_normal-44"><a href="#not_normal-44"><span class="linenos">44</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">IterateResults</span><span class="p">,</span> <span class="n">InitialEstimateResults</span><span class="p">]:</span>
</span><span id="not_normal-45"><a href="#not_normal-45"><span class="linenos">45</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="not_normal-46"><a href="#not_normal-46"><span class="linenos">46</span></a><span class="sd">    Anomaly detection and baseline determination for (nano)electrochemical time series data. This function combines</span>
</span><span id="not_normal-47"><a href="#not_normal-47"><span class="linenos">47</span></a><span class="sd">    initial_estimate and iterate steps into a single function. There are no required parameters other than the input</span>
</span><span id="not_normal-48"><a href="#not_normal-48"><span class="linenos">48</span></a><span class="sd">    trace and sample rate (or a Trace object). See: initial_estimate and iterate for further details.</span>
</span><span id="not_normal-49"><a href="#not_normal-49"><span class="linenos">49</span></a>
</span><span id="not_normal-50"><a href="#not_normal-50"><span class="linenos">50</span></a><span class="sd">    Args:</span>
</span><span id="not_normal-51"><a href="#not_normal-51"><span class="linenos">51</span></a><span class="sd">        trace (ndarray | Trace): The input trace or a Trace object. If ndarray, the sample rate must be provided.</span>
</span><span id="not_normal-52"><a href="#not_normal-52"><span class="linenos">52</span></a><span class="sd">        sample_rate (int | None): The sample rate of the trace. Has to be provided if trace is a ndarray. Default is None.</span>
</span><span id="not_normal-53"><a href="#not_normal-53"><span class="linenos">53</span></a><span class="sd">        bounds_window (int): The window size for the median filter used in bounding. Default is 3.</span>
</span><span id="not_normal-54"><a href="#not_normal-54"><span class="linenos">54</span></a><span class="sd">        estimate_cutoff (float): The initial estimate for the cutoff frequency. Default is 10.0.</span>
</span><span id="not_normal-55"><a href="#not_normal-55"><span class="linenos">55</span></a><span class="sd">        replace_factor (float): Factor for replacing events in the calculation trace. Default is 8.0.</span>
</span><span id="not_normal-56"><a href="#not_normal-56"><span class="linenos">56</span></a><span class="sd">        replace_gap (float): Gap for replacing events in the calculation trace. Default is 2.0.</span>
</span><span id="not_normal-57"><a href="#not_normal-57"><span class="linenos">57</span></a><span class="sd">        threshold_window (float): The window size for threshold calculation. Default is 2.0.</span>
</span><span id="not_normal-58"><a href="#not_normal-58"><span class="linenos">58</span></a><span class="sd">        z_score (float | None): The Z-score for event detection. If None, it is calculated based on the trace length.</span>
</span><span id="not_normal-59"><a href="#not_normal-59"><span class="linenos">59</span></a><span class="sd">            Default is None.</span>
</span><span id="not_normal-60"><a href="#not_normal-60"><span class="linenos">60</span></a><span class="sd">        output_features (str | None): The output event features. Can be &#39;full&#39; for absolute features, &#39;FWHM&#39;, or &#39;FWQM&#39;</span>
</span><span id="not_normal-61"><a href="#not_normal-61"><span class="linenos">61</span></a><span class="sd">            for full width at half maximum or quarter maximum, respectively. These apply to duration, area, and peak</span>
</span><span id="not_normal-62"><a href="#not_normal-62"><span class="linenos">62</span></a><span class="sd">            amplitude. None specifies no events on the output. Default is &#39;full&#39;.</span>
</span><span id="not_normal-63"><a href="#not_normal-63"><span class="linenos">63</span></a><span class="sd">        vector_results (bool): Whether to return vector results, this is very expensive. Default is False.</span>
</span><span id="not_normal-64"><a href="#not_normal-64"><span class="linenos">64</span></a><span class="sd">        parallel (bool): Whether to run the iteration in parallel. Default is False.</span>
</span><span id="not_normal-65"><a href="#not_normal-65"><span class="linenos">65</span></a>
</span><span id="not_normal-66"><a href="#not_normal-66"><span class="linenos">66</span></a><span class="sd">    Returns:</span>
</span><span id="not_normal-67"><a href="#not_normal-67"><span class="linenos">67</span></a><span class="sd">        tuple[IterateResults, InitialEstimateResults]: The iteration results object and initial estimate results object.</span>
</span><span id="not_normal-68"><a href="#not_normal-68"><span class="linenos">68</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="not_normal-69"><a href="#not_normal-69"><span class="linenos">69</span></a>
</span><span id="not_normal-70"><a href="#not_normal-70"><span class="linenos">70</span></a>    <span class="c1"># Default to 1 expected outlier per trace (computed on length, of course)</span>
</span><span id="not_normal-71"><a href="#not_normal-71"><span class="linenos">71</span></a>    <span class="k">if</span> <span class="n">z_score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="not_normal-72"><a href="#not_normal-72"><span class="linenos">72</span></a>        <span class="n">z_score</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)))</span>
</span><span id="not_normal-73"><a href="#not_normal-73"><span class="linenos">73</span></a>
</span><span id="not_normal-74"><a href="#not_normal-74"><span class="linenos">74</span></a>    <span class="c1"># Default 3-point median filter for bounding</span>
</span><span id="not_normal-75"><a href="#not_normal-75"><span class="linenos">75</span></a>    <span class="n">filtered_trace</span> <span class="o">=</span> <span class="n">_bounds_filter</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">bounds_window</span><span class="p">)</span>
</span><span id="not_normal-76"><a href="#not_normal-76"><span class="linenos">76</span></a>
</span><span id="not_normal-77"><a href="#not_normal-77"><span class="linenos">77</span></a>    <span class="c1"># Initial estimate for the cutoff frequency and direction</span>
</span><span id="not_normal-78"><a href="#not_normal-78"><span class="linenos">78</span></a>    <span class="n">estimate_results</span> <span class="o">=</span> <span class="n">initial_estimate</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">filtered_trace</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">estimate_cutoff</span><span class="p">,</span> <span class="n">replace_factor</span><span class="p">,</span> <span class="n">replace_gap</span><span class="p">,</span>
</span><span id="not_normal-79"><a href="#not_normal-79"><span class="linenos">79</span></a>                                        <span class="n">threshold_window</span><span class="p">,</span> <span class="n">z_score</span><span class="p">,</span> <span class="n">output_features</span><span class="p">,</span> <span class="n">vector_results</span><span class="p">)</span>
</span><span id="not_normal-80"><a href="#not_normal-80"><span class="linenos">80</span></a>
</span><span id="not_normal-81"><a href="#not_normal-81"><span class="linenos">81</span></a>    <span class="c1"># Iterate based on the initial estimate</span>
</span><span id="not_normal-82"><a href="#not_normal-82"><span class="linenos">82</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;trace&#39;</span><span class="p">:</span> <span class="n">trace</span><span class="p">,</span> <span class="s1">&#39;cutoff&#39;</span><span class="p">:</span> <span class="n">estimate_results</span><span class="o">.</span><span class="n">max_cutoff</span><span class="p">,</span> <span class="s1">&#39;event_direction&#39;</span><span class="p">:</span> <span class="n">estimate_results</span><span class="o">.</span><span class="n">event_direction</span><span class="p">,</span>
</span><span id="not_normal-83"><a href="#not_normal-83"><span class="linenos">83</span></a>            <span class="s1">&#39;filtered_trace&#39;</span><span class="p">:</span> <span class="n">filtered_trace</span><span class="p">,</span> <span class="s1">&#39;sample_rate&#39;</span><span class="p">:</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="s1">&#39;replace_factor&#39;</span><span class="p">:</span> <span class="n">replace_factor</span><span class="p">,</span>
</span><span id="not_normal-84"><a href="#not_normal-84"><span class="linenos">84</span></a>            <span class="s1">&#39;replace_gap&#39;</span><span class="p">:</span> <span class="n">replace_gap</span><span class="p">,</span> <span class="s1">&#39;threshold_window&#39;</span><span class="p">:</span> <span class="n">threshold_window</span><span class="p">,</span> <span class="s1">&#39;z_score&#39;</span><span class="p">:</span> <span class="n">z_score</span><span class="p">,</span>
</span><span id="not_normal-85"><a href="#not_normal-85"><span class="linenos">85</span></a>            <span class="s1">&#39;output_features&#39;</span><span class="p">:</span> <span class="n">output_features</span><span class="p">,</span> <span class="s1">&#39;vector_results&#39;</span><span class="p">:</span> <span class="n">vector_results</span><span class="p">}</span>
</span><span id="not_normal-86"><a href="#not_normal-86"><span class="linenos">86</span></a>    <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
</span><span id="not_normal-87"><a href="#not_normal-87"><span class="linenos">87</span></a>        <span class="n">iteration_results</span> <span class="o">=</span> <span class="n">parallel_iterate</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
</span><span id="not_normal-88"><a href="#not_normal-88"><span class="linenos">88</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="not_normal-89"><a href="#not_normal-89"><span class="linenos">89</span></a>        <span class="n">iteration_results</span> <span class="o">=</span> <span class="n">iterate</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
</span><span id="not_normal-90"><a href="#not_normal-90"><span class="linenos">90</span></a>
</span><span id="not_normal-91"><a href="#not_normal-91"><span class="linenos">91</span></a>    <span class="k">return</span> <span class="n">iteration_results</span><span class="p">,</span> <span class="n">estimate_results</span>
</span></pre></div>


            <div class="docstring"><p>Anomaly detection and baseline determination for (nano)electrochemical time series data. This function combines
initial_estimate and iterate steps into a single function. There are no required parameters other than the input
trace and sample rate (or a Trace object). See: initial_estimate and iterate for further details.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>trace (ndarray | Trace):</strong>  The input trace or a Trace object. If ndarray, the sample rate must be provided.</li>
<li><strong>sample_rate (int | None):</strong>  The sample rate of the trace. Has to be provided if trace is a ndarray. Default is None.</li>
<li><strong>bounds_window (int):</strong>  The window size for the median filter used in bounding. Default is 3.</li>
<li><strong>estimate_cutoff (float):</strong>  The initial estimate for the cutoff frequency. Default is 10.0.</li>
<li><strong>replace_factor (float):</strong>  Factor for replacing events in the calculation trace. Default is 8.0.</li>
<li><strong>replace_gap (float):</strong>  Gap for replacing events in the calculation trace. Default is 2.0.</li>
<li><strong>threshold_window (float):</strong>  The window size for threshold calculation. Default is 2.0.</li>
<li><strong>z_score (float | None):</strong>  The Z-score for event detection. If None, it is calculated based on the trace length.
Default is None.</li>
<li><strong>output_features (str | None):</strong>  The output event features. Can be 'full' for absolute features, 'FWHM', or 'FWQM'
for full width at half maximum or quarter maximum, respectively. These apply to duration, area, and peak
amplitude. None specifies no events on the output. Default is 'full'.</li>
<li><strong>vector_results (bool):</strong>  Whether to return vector results, this is very expensive. Default is False.</li>
<li><strong>parallel (bool):</strong>  Whether to run the iteration in parallel. Default is False.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>tuple[IterateResults, InitialEstimateResults]: The iteration results object and initial estimate results object.</p>
</blockquote>
</div>


                </section>
                <section id="parallel_iterate">
                            <input id="parallel_iterate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parallel_iterate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">trace</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n"><a href="models.html#Trace">notnormal.models.Trace</a></span>,</span><span class="param">	<span class="n">cutoff</span><span class="p">:</span> <span class="n">double</span>,</span><span class="param">	<span class="n">event_direction</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">filtered_trace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">sample_rate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">replace_factor</span><span class="p">:</span> <span class="n">double</span> <span class="o">=</span> <span class="mf">8.0</span>,</span><span class="param">	<span class="n">replace_gap</span><span class="p">:</span> <span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span>,</span><span class="param">	<span class="n">threshold_window</span><span class="p">:</span> <span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span>,</span><span class="param">	<span class="n">z_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">output_features</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span>,</span><span class="param">	<span class="n">vector_results</span><span class="p">:</span> <span class="n">bint</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">segment_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="models.html#IterateResults">notnormal.models.IterateResults</a></span>:</span></span>

                <label class="view-source-button" for="parallel_iterate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parallel_iterate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parallel_iterate-94"><a href="#parallel_iterate-94"><span class="linenos"> 94</span></a><span class="k">def</span><span class="w"> </span><span class="nf">parallel_iterate</span><span class="p">(</span>
</span><span id="parallel_iterate-95"><a href="#parallel_iterate-95"><span class="linenos"> 95</span></a>    <span class="n">trace</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">|</span> <span class="n">Trace</span><span class="p">,</span>
</span><span id="parallel_iterate-96"><a href="#parallel_iterate-96"><span class="linenos"> 96</span></a>    <span class="n">cutoff</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span>
</span><span id="parallel_iterate-97"><a href="#parallel_iterate-97"><span class="linenos"> 97</span></a>    <span class="n">event_direction</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="parallel_iterate-98"><a href="#parallel_iterate-98"><span class="linenos"> 98</span></a>    <span class="n">filtered_trace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="parallel_iterate-99"><a href="#parallel_iterate-99"><span class="linenos"> 99</span></a>    <span class="n">sample_rate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="parallel_iterate-100"><a href="#parallel_iterate-100"><span class="linenos">100</span></a>    <span class="n">replace_factor</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span>
</span><span id="parallel_iterate-101"><a href="#parallel_iterate-101"><span class="linenos">101</span></a>    <span class="n">replace_gap</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="parallel_iterate-102"><a href="#parallel_iterate-102"><span class="linenos">102</span></a>    <span class="n">threshold_window</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="parallel_iterate-103"><a href="#parallel_iterate-103"><span class="linenos">103</span></a>    <span class="n">z_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="parallel_iterate-104"><a href="#parallel_iterate-104"><span class="linenos">104</span></a>    <span class="n">output_features</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span><span class="p">,</span>
</span><span id="parallel_iterate-105"><a href="#parallel_iterate-105"><span class="linenos">105</span></a>    <span class="n">vector_results</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">bint</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="parallel_iterate-106"><a href="#parallel_iterate-106"><span class="linenos">106</span></a>    <span class="n">segment_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="parallel_iterate-107"><a href="#parallel_iterate-107"><span class="linenos">107</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IterateResults</span><span class="p">:</span>
</span><span id="parallel_iterate-108"><a href="#parallel_iterate-108"><span class="linenos">108</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="parallel_iterate-109"><a href="#parallel_iterate-109"><span class="linenos">109</span></a><span class="sd">    Parallel equivalent to the iterate function.</span>
</span><span id="parallel_iterate-110"><a href="#parallel_iterate-110"><span class="linenos">110</span></a>
</span><span id="parallel_iterate-111"><a href="#parallel_iterate-111"><span class="linenos">111</span></a><span class="sd">    Args:</span>
</span><span id="parallel_iterate-112"><a href="#parallel_iterate-112"><span class="linenos">112</span></a><span class="sd">        trace (ndarray | Trace): The input trace or a Trace object. If ndarray, the sample rate must be provided.</span>
</span><span id="parallel_iterate-113"><a href="#parallel_iterate-113"><span class="linenos">113</span></a><span class="sd">        cutoff (float): The cutoff frequency for the baseline filter derived from initial_estimate.</span>
</span><span id="parallel_iterate-114"><a href="#parallel_iterate-114"><span class="linenos">114</span></a><span class="sd">        event_direction (str): The direction of events (&#39;up&#39;, &#39;down&#39;, or &#39;biphasic&#39;) derived from initial_estimate.</span>
</span><span id="parallel_iterate-115"><a href="#parallel_iterate-115"><span class="linenos">115</span></a><span class="sd">        filtered_trace (ndarray | None): The filtered version of the input trace, used for bounding events.</span>
</span><span id="parallel_iterate-116"><a href="#parallel_iterate-116"><span class="linenos">116</span></a><span class="sd">            If None, the trace is used. Default is None.</span>
</span><span id="parallel_iterate-117"><a href="#parallel_iterate-117"><span class="linenos">117</span></a><span class="sd">        sample_rate (int | None): The sample rate of the trace. Has to be provided if trace is a ndarray. Default is None.</span>
</span><span id="parallel_iterate-118"><a href="#parallel_iterate-118"><span class="linenos">118</span></a><span class="sd">        replace_factor (float): Factor for replacing events in the calculation trace. Default is 8.0.</span>
</span><span id="parallel_iterate-119"><a href="#parallel_iterate-119"><span class="linenos">119</span></a><span class="sd">        replace_gap (float): Gap for replacing events in the calculation trace. Default is 2.0.</span>
</span><span id="parallel_iterate-120"><a href="#parallel_iterate-120"><span class="linenos">120</span></a><span class="sd">        threshold_window (float): The window size for threshold calculation. Default is 2.0.</span>
</span><span id="parallel_iterate-121"><a href="#parallel_iterate-121"><span class="linenos">121</span></a><span class="sd">        z_score (float | None): The Z-score for event detection. If None, it is calculated based on the trace length.</span>
</span><span id="parallel_iterate-122"><a href="#parallel_iterate-122"><span class="linenos">122</span></a><span class="sd">            Default is None.</span>
</span><span id="parallel_iterate-123"><a href="#parallel_iterate-123"><span class="linenos">123</span></a><span class="sd">        output_features (str | None): The output event features. Can be &#39;full&#39; for absolute features, &#39;FWHM&#39;, or &#39;FWQM&#39;</span>
</span><span id="parallel_iterate-124"><a href="#parallel_iterate-124"><span class="linenos">124</span></a><span class="sd">            for full width at half maximum or quarter maximum, respectively. These apply to duration, area, and peak</span>
</span><span id="parallel_iterate-125"><a href="#parallel_iterate-125"><span class="linenos">125</span></a><span class="sd">            amplitude. None specifies no events on the output. Default is &#39;full&#39;.</span>
</span><span id="parallel_iterate-126"><a href="#parallel_iterate-126"><span class="linenos">126</span></a><span class="sd">        vector_results (bool): Whether to return vector results, this is not possible in parallel, but will assert on</span>
</span><span id="parallel_iterate-127"><a href="#parallel_iterate-127"><span class="linenos">127</span></a><span class="sd">            the fallback to serial. Default is False.</span>
</span><span id="parallel_iterate-128"><a href="#parallel_iterate-128"><span class="linenos">128</span></a><span class="sd">        segment_size (int | None): Size of segments for parallel processing. Default is None and will calculate</span>
</span><span id="parallel_iterate-129"><a href="#parallel_iterate-129"><span class="linenos">129</span></a><span class="sd">            automatically.</span>
</span><span id="parallel_iterate-130"><a href="#parallel_iterate-130"><span class="linenos">130</span></a>
</span><span id="parallel_iterate-131"><a href="#parallel_iterate-131"><span class="linenos">131</span></a><span class="sd">    Returns:</span>
</span><span id="parallel_iterate-132"><a href="#parallel_iterate-132"><span class="linenos">132</span></a><span class="sd">        IterateResults: An object containing the iterate results.</span>
</span><span id="parallel_iterate-133"><a href="#parallel_iterate-133"><span class="linenos">133</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parallel_iterate-134"><a href="#parallel_iterate-134"><span class="linenos">134</span></a>
</span><span id="parallel_iterate-135"><a href="#parallel_iterate-135"><span class="linenos">135</span></a>    <span class="c1"># Default to the same size as the confirmed stopping criterion accuracy or threshold accuracy, whichever is larger</span>
</span><span id="parallel_iterate-136"><a href="#parallel_iterate-136"><span class="linenos">136</span></a>    <span class="n">minimum_segment</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="mi">1000000</span><span class="p">,</span> <span class="p">(</span><span class="n">sample_rate</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">),</span> <span class="p">(</span><span class="n">sample_rate</span> <span class="o">*</span> <span class="n">threshold_window</span><span class="p">)])</span>
</span><span id="parallel_iterate-137"><a href="#parallel_iterate-137"><span class="linenos">137</span></a>    <span class="n">segment_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">),</span> <span class="nb">max</span><span class="p">([</span><span class="n">segment_size</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="n">minimum_segment</span><span class="p">])])</span>
</span><span id="parallel_iterate-138"><a href="#parallel_iterate-138"><span class="linenos">138</span></a>    <span class="n">splits</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">//</span> <span class="n">segment_size</span>
</span><span id="parallel_iterate-139"><a href="#parallel_iterate-139"><span class="linenos">139</span></a>
</span><span id="parallel_iterate-140"><a href="#parallel_iterate-140"><span class="linenos">140</span></a>    <span class="c1"># Not worth it to parallelize if the trace is too small</span>
</span><span id="parallel_iterate-141"><a href="#parallel_iterate-141"><span class="linenos">141</span></a>    <span class="k">if</span> <span class="n">splits</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="parallel_iterate-142"><a href="#parallel_iterate-142"><span class="linenos">142</span></a>        <span class="k">return</span> <span class="n">iterate</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">event_direction</span><span class="p">,</span> <span class="n">filtered_trace</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">replace_factor</span><span class="p">,</span> <span class="n">replace_gap</span><span class="p">,</span>
</span><span id="parallel_iterate-143"><a href="#parallel_iterate-143"><span class="linenos">143</span></a>                       <span class="n">threshold_window</span><span class="p">,</span> <span class="n">z_score</span><span class="p">,</span> <span class="n">output_features</span><span class="p">,</span> <span class="n">vector_results</span><span class="p">,</span> <span class="n">_validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="parallel_iterate-144"><a href="#parallel_iterate-144"><span class="linenos">144</span></a>
</span><span id="parallel_iterate-145"><a href="#parallel_iterate-145"><span class="linenos">145</span></a>    <span class="c1"># Validate all the inputs</span>
</span><span id="parallel_iterate-146"><a href="#parallel_iterate-146"><span class="linenos">146</span></a>    <span class="n">trace</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">filtered_trace</span><span class="p">,</span> <span class="n">z_score</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_validate_input</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">filtered_trace</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span>
</span><span id="parallel_iterate-147"><a href="#parallel_iterate-147"><span class="linenos">147</span></a>                                <span class="n">replace_factor</span><span class="p">,</span> <span class="n">replace_gap</span><span class="p">,</span> <span class="n">threshold_window</span><span class="p">,</span> <span class="n">z_score</span><span class="p">,</span> <span class="n">output_features</span><span class="p">,</span> <span class="n">event_direction</span><span class="p">)</span>
</span><span id="parallel_iterate-148"><a href="#parallel_iterate-148"><span class="linenos">148</span></a>
</span><span id="parallel_iterate-149"><a href="#parallel_iterate-149"><span class="linenos">149</span></a>    <span class="c1"># Init results and get args</span>
</span><span id="parallel_iterate-150"><a href="#parallel_iterate-150"><span class="linenos">150</span></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">IterateResults</span><span class="p">(</span><span class="n">IterateArgs</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">IterateArgs</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">},</span>
</span><span id="parallel_iterate-151"><a href="#parallel_iterate-151"><span class="linenos">151</span></a>                                         <span class="o">**</span><span class="p">{</span><span class="s1">&#39;_validate&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}))</span>
</span><span id="parallel_iterate-152"><a href="#parallel_iterate-152"><span class="linenos">152</span></a>
</span><span id="parallel_iterate-153"><a href="#parallel_iterate-153"><span class="linenos">153</span></a>    <span class="c1"># Get the chunks for parallel processing</span>
</span><span id="parallel_iterate-154"><a href="#parallel_iterate-154"><span class="linenos">154</span></a>    <span class="n">chunk_pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">array_split</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">splits</span><span class="p">),</span> <span class="n">array_split</span><span class="p">(</span><span class="n">filtered_trace</span><span class="p">,</span> <span class="n">splits</span><span class="p">)))</span>
</span><span id="parallel_iterate-155"><a href="#parallel_iterate-155"><span class="linenos">155</span></a>
</span><span id="parallel_iterate-156"><a href="#parallel_iterate-156"><span class="linenos">156</span></a>    <span class="c1"># Make an estimate of the memory required for the trace</span>
</span><span id="parallel_iterate-157"><a href="#parallel_iterate-157"><span class="linenos">157</span></a>    <span class="n">final_mem</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">available</span> <span class="o">+</span> <span class="n">swap_memory</span><span class="p">()</span><span class="o">.</span><span class="n">free</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">nbytes</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)])</span>
</span><span id="parallel_iterate-158"><a href="#parallel_iterate-158"><span class="linenos">158</span></a>    <span class="n">max_workers</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">final_mem</span> <span class="o">//</span> <span class="p">(</span><span class="n">chunk_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nbytes</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)])</span>
</span><span id="parallel_iterate-159"><a href="#parallel_iterate-159"><span class="linenos">159</span></a>    <span class="n">processes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">cpu_count</span><span class="p">(),</span> <span class="n">splits</span><span class="p">,</span> <span class="n">max_workers</span><span class="p">))</span>
</span><span id="parallel_iterate-160"><a href="#parallel_iterate-160"><span class="linenos">160</span></a>    <span class="n">chunksize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_pairs</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">processes</span><span class="p">)]))</span>
</span><span id="parallel_iterate-161"><a href="#parallel_iterate-161"><span class="linenos">161</span></a>
</span><span id="parallel_iterate-162"><a href="#parallel_iterate-162"><span class="linenos">162</span></a>    <span class="c1"># Get function (don&#39;t extract events, return vector results, or validate)</span>
</span><span id="parallel_iterate-163"><a href="#parallel_iterate-163"><span class="linenos">163</span></a>    <span class="n">args_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">trace_chunk</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">event_direction</span><span class="p">,</span> <span class="n">filtered_trace_chunk</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">replace_factor</span><span class="p">,</span> <span class="n">replace_gap</span><span class="p">,</span>
</span><span id="parallel_iterate-164"><a href="#parallel_iterate-164"><span class="linenos">164</span></a>                  <span class="n">threshold_window</span><span class="p">,</span> <span class="n">z_score</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">trace_chunk</span><span class="p">,</span> <span class="n">filtered_trace_chunk</span> <span class="ow">in</span> <span class="n">chunk_pairs</span><span class="p">]</span>
</span><span id="parallel_iterate-165"><a href="#parallel_iterate-165"><span class="linenos">165</span></a>
</span><span id="parallel_iterate-166"><a href="#parallel_iterate-166"><span class="linenos">166</span></a>    <span class="c1"># Spawn safe multiprocessing pool</span>
</span><span id="parallel_iterate-167"><a href="#parallel_iterate-167"><span class="linenos">167</span></a>    <span class="k">with</span> <span class="n">get_context</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
</span><span id="parallel_iterate-168"><a href="#parallel_iterate-168"><span class="linenos">168</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">iterate</span><span class="p">,</span> <span class="n">args_list</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">)</span>
</span><span id="parallel_iterate-169"><a href="#parallel_iterate-169"><span class="linenos">169</span></a>        <span class="n">chunk_pairs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="parallel_iterate-170"><a href="#parallel_iterate-170"><span class="linenos">170</span></a>        <span class="n">collect</span><span class="p">()</span>
</span><span id="parallel_iterate-171"><a href="#parallel_iterate-171"><span class="linenos">171</span></a>
</span><span id="parallel_iterate-172"><a href="#parallel_iterate-172"><span class="linenos">172</span></a>    <span class="c1"># Extract final iterations</span>
</span><span id="parallel_iterate-173"><a href="#parallel_iterate-173"><span class="linenos">173</span></a>    <span class="n">results</span><span class="o">.</span><span class="n">initial_threshold</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">initial_threshold</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">])</span>
</span><span id="parallel_iterate-174"><a href="#parallel_iterate-174"><span class="linenos">174</span></a>    <span class="n">attr_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;threshold&quot;</span><span class="p">,</span> <span class="s2">&quot;calculation_trace&quot;</span><span class="p">,</span> <span class="s2">&quot;trace_stats&quot;</span><span class="p">]</span>
</span><span id="parallel_iterate-175"><a href="#parallel_iterate-175"><span class="linenos">175</span></a>    <span class="n">last_items</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">iterations</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">iterations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
</span><span id="parallel_iterate-176"><a href="#parallel_iterate-176"><span class="linenos">176</span></a>    <span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">baseline</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">last_items</span><span class="p">]</span>
</span><span id="parallel_iterate-177"><a href="#parallel_iterate-177"><span class="linenos">177</span></a>    <span class="n">offsets</span> <span class="o">=</span> <span class="n">cumsum</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lengths</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="parallel_iterate-178"><a href="#parallel_iterate-178"><span class="linenos">178</span></a>
</span><span id="parallel_iterate-179"><a href="#parallel_iterate-179"><span class="linenos">179</span></a>    <span class="c1"># Reduce arrays</span>
</span><span id="parallel_iterate-180"><a href="#parallel_iterate-180"><span class="linenos">180</span></a>    <span class="n">iteration</span> <span class="o">=</span> <span class="n">Iteration</span><span class="p">()</span>
</span><span id="parallel_iterate-181"><a href="#parallel_iterate-181"><span class="linenos">181</span></a>    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">attr_names</span><span class="p">:</span>
</span><span id="parallel_iterate-182"><a href="#parallel_iterate-182"><span class="linenos">182</span></a>        <span class="n">arrays</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">last_items</span><span class="p">]</span>
</span><span id="parallel_iterate-183"><a href="#parallel_iterate-183"><span class="linenos">183</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;trace_stats&#39;</span><span class="p">:</span>
</span><span id="parallel_iterate-184"><a href="#parallel_iterate-184"><span class="linenos">184</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">mean</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">arrays</span> <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">:=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()})</span>
</span><span id="parallel_iterate-185"><a href="#parallel_iterate-185"><span class="linenos">185</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="parallel_iterate-186"><a href="#parallel_iterate-186"><span class="linenos">186</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">concatenate</span><span class="p">(</span><span class="n">arrays</span><span class="p">))</span>
</span><span id="parallel_iterate-187"><a href="#parallel_iterate-187"><span class="linenos">187</span></a>
</span><span id="parallel_iterate-188"><a href="#parallel_iterate-188"><span class="linenos">188</span></a>    <span class="c1"># Offset and concatenate event coordinates</span>
</span><span id="parallel_iterate-189"><a href="#parallel_iterate-189"><span class="linenos">189</span></a>    <span class="n">coords_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">event_coordinates</span> <span class="o">+</span> <span class="n">offset</span> <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">last_items</span><span class="p">,</span> <span class="n">offsets</span><span class="p">)</span>
</span><span id="parallel_iterate-190"><a href="#parallel_iterate-190"><span class="linenos">190</span></a>                    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">event_coordinates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">event_coordinates</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
</span><span id="parallel_iterate-191"><a href="#parallel_iterate-191"><span class="linenos">191</span></a>    <span class="n">iteration</span><span class="o">.</span><span class="n">event_coordinates</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">(</span><span class="n">coords_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">coords_list</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="parallel_iterate-192"><a href="#parallel_iterate-192"><span class="linenos">192</span></a>
</span><span id="parallel_iterate-193"><a href="#parallel_iterate-193"><span class="linenos">193</span></a>    <span class="c1"># Get event stats</span>
</span><span id="parallel_iterate-194"><a href="#parallel_iterate-194"><span class="linenos">194</span></a>    <span class="n">event_stats</span> <span class="o">=</span> <span class="n">_event_statistics</span><span class="p">(</span><span class="n">iteration</span><span class="o">.</span><span class="n">event_coordinates</span><span class="p">)</span>
</span><span id="parallel_iterate-195"><a href="#parallel_iterate-195"><span class="linenos">195</span></a>    <span class="n">iteration</span><span class="o">.</span><span class="n">event_stats</span> <span class="o">=</span> <span class="n">event_stats</span>
</span><span id="parallel_iterate-196"><a href="#parallel_iterate-196"><span class="linenos">196</span></a>
</span><span id="parallel_iterate-197"><a href="#parallel_iterate-197"><span class="linenos">197</span></a>    <span class="c1"># If events are requested</span>
</span><span id="parallel_iterate-198"><a href="#parallel_iterate-198"><span class="linenos">198</span></a>    <span class="k">if</span> <span class="n">output_features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="parallel_iterate-199"><a href="#parallel_iterate-199"><span class="linenos">199</span></a>        <span class="c1"># Extract the events</span>
</span><span id="parallel_iterate-200"><a href="#parallel_iterate-200"><span class="linenos">200</span></a>        <span class="n">results</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">simple_extractor</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">iteration</span><span class="o">.</span><span class="n">baseline</span><span class="p">,</span> <span class="n">iteration</span><span class="o">.</span><span class="n">event_coordinates</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span>
</span><span id="parallel_iterate-201"><a href="#parallel_iterate-201"><span class="linenos">201</span></a>                                          <span class="n">output_features</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</span><span id="parallel_iterate-202"><a href="#parallel_iterate-202"><span class="linenos">202</span></a>
</span><span id="parallel_iterate-203"><a href="#parallel_iterate-203"><span class="linenos">203</span></a>        <span class="c1"># Calculate the required cutoffs (using the initial threshold)</span>
</span><span id="parallel_iterate-204"><a href="#parallel_iterate-204"><span class="linenos">204</span></a>        <span class="n">event_stats</span><span class="p">[</span><span class="s1">&#39;Max Cutoff&#39;</span><span class="p">],</span> <span class="n">all_cutoffs</span> <span class="o">=</span> <span class="n">_calculate_cutoffs</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">iteration</span><span class="o">.</span><span class="n">baseline</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">initial_threshold</span><span class="p">,</span>
</span><span id="parallel_iterate-205"><a href="#parallel_iterate-205"><span class="linenos">205</span></a>                                                                    <span class="n">iteration</span><span class="o">.</span><span class="n">event_coordinates</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">)</span>
</span><span id="parallel_iterate-206"><a href="#parallel_iterate-206"><span class="linenos">206</span></a>        <span class="n">results</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="s1">&#39;Max Cutoff&#39;</span><span class="p">,</span> <span class="n">all_cutoffs</span><span class="p">)</span>
</span><span id="parallel_iterate-207"><a href="#parallel_iterate-207"><span class="linenos">207</span></a>
</span><span id="parallel_iterate-208"><a href="#parallel_iterate-208"><span class="linenos">208</span></a>        <span class="c1"># Expected number of extractions which are not events</span>
</span><span id="parallel_iterate-209"><a href="#parallel_iterate-209"><span class="linenos">209</span></a>        <span class="n">event_stats</span><span class="p">[</span><span class="s1">&#39;False Positives&#39;</span><span class="p">],</span> <span class="n">event_stats</span><span class="p">[</span><span class="s1">&#39;Significant Events&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_expected_outliers</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">iteration</span><span class="o">.</span><span class="n">baseline</span><span class="p">,</span>
</span><span id="parallel_iterate-210"><a href="#parallel_iterate-210"><span class="linenos">210</span></a>                                                              <span class="n">iteration</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span> <span class="n">iteration</span><span class="o">.</span><span class="n">event_coordinates</span><span class="p">,</span> <span class="n">z_score</span><span class="p">)</span>
</span><span id="parallel_iterate-211"><a href="#parallel_iterate-211"><span class="linenos">211</span></a>
</span><span id="parallel_iterate-212"><a href="#parallel_iterate-212"><span class="linenos">212</span></a>    <span class="c1"># Place the iteration in the results</span>
</span><span id="parallel_iterate-213"><a href="#parallel_iterate-213"><span class="linenos">213</span></a>    <span class="n">results</span><span class="o">.</span><span class="n">iterations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iteration</span><span class="p">)</span>
</span><span id="parallel_iterate-214"><a href="#parallel_iterate-214"><span class="linenos">214</span></a>
</span><span id="parallel_iterate-215"><a href="#parallel_iterate-215"><span class="linenos">215</span></a>    <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Parallel equivalent to the iterate function.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>trace (ndarray | Trace):</strong>  The input trace or a Trace object. If ndarray, the sample rate must be provided.</li>
<li><strong>cutoff (float):</strong>  The cutoff frequency for the baseline filter derived from initial_estimate.</li>
<li><strong>event_direction (str):</strong>  The direction of events ('up', 'down', or 'biphasic') derived from initial_estimate.</li>
<li><strong>filtered_trace (ndarray | None):</strong>  The filtered version of the input trace, used for bounding events.
If None, the trace is used. Default is None.</li>
<li><strong>sample_rate (int | None):</strong>  The sample rate of the trace. Has to be provided if trace is a ndarray. Default is None.</li>
<li><strong>replace_factor (float):</strong>  Factor for replacing events in the calculation trace. Default is 8.0.</li>
<li><strong>replace_gap (float):</strong>  Gap for replacing events in the calculation trace. Default is 2.0.</li>
<li><strong>threshold_window (float):</strong>  The window size for threshold calculation. Default is 2.0.</li>
<li><strong>z_score (float | None):</strong>  The Z-score for event detection. If None, it is calculated based on the trace length.
Default is None.</li>
<li><strong>output_features (str | None):</strong>  The output event features. Can be 'full' for absolute features, 'FWHM', or 'FWQM'
for full width at half maximum or quarter maximum, respectively. These apply to duration, area, and peak
amplitude. None specifies no events on the output. Default is 'full'.</li>
<li><strong>vector_results (bool):</strong>  Whether to return vector results, this is not possible in parallel, but will assert on
the fallback to serial. Default is False.</li>
<li><strong>segment_size (int | None):</strong>  Size of segments for parallel processing. Default is None and will calculate
automatically.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>IterateResults: An object containing the iterate results.</p>
</blockquote>
</div>


                </section>
                <section id="simple_extractor">
                            <input id="simple_extractor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">simple_extractor</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">trace</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n"><a href="models.html#Trace">notnormal.models.Trace</a></span>,</span><span class="param">	<span class="n">baseline</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">event_coordinates</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">sample_rate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">feature_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span>,</span><span class="param">	<span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span><span class="return-annotation">) -> <span class="n"><a href="models.html#Events">notnormal.models.Events</a></span>:</span></span>

                <label class="view-source-button" for="simple_extractor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#simple_extractor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="simple_extractor-462"><a href="#simple_extractor-462"><span class="linenos">462</span></a><span class="k">def</span><span class="w"> </span><span class="nf">simple_extractor</span><span class="p">(</span>
</span><span id="simple_extractor-463"><a href="#simple_extractor-463"><span class="linenos">463</span></a>    <span class="n">trace</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">|</span> <span class="n">Trace</span><span class="p">,</span>
</span><span id="simple_extractor-464"><a href="#simple_extractor-464"><span class="linenos">464</span></a>    <span class="n">baseline</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span>
</span><span id="simple_extractor-465"><a href="#simple_extractor-465"><span class="linenos">465</span></a>    <span class="n">event_coordinates</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span>
</span><span id="simple_extractor-466"><a href="#simple_extractor-466"><span class="linenos">466</span></a>    <span class="n">sample_rate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="simple_extractor-467"><a href="#simple_extractor-467"><span class="linenos">467</span></a>    <span class="n">feature_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span><span class="p">,</span>
</span><span id="simple_extractor-468"><a href="#simple_extractor-468"><span class="linenos">468</span></a>    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="simple_extractor-469"><a href="#simple_extractor-469"><span class="linenos">469</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Events</span><span class="p">:</span>
</span><span id="simple_extractor-470"><a href="#simple_extractor-470"><span class="linenos">470</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="simple_extractor-471"><a href="#simple_extractor-471"><span class="linenos">471</span></a><span class="sd">    Extract the events from the trace based on the event coordinates and the baseline. Then, simple features are</span>
</span><span id="simple_extractor-472"><a href="#simple_extractor-472"><span class="linenos">472</span></a><span class="sd">    calculated for each event. Duration is always in ms, while area and amplitude are in the same units as the trace.</span>
</span><span id="simple_extractor-473"><a href="#simple_extractor-473"><span class="linenos">473</span></a><span class="sd">    That is, if the trace is in pA, we have pC and pA for area and amplitude, respectively.</span>
</span><span id="simple_extractor-474"><a href="#simple_extractor-474"><span class="linenos">474</span></a>
</span><span id="simple_extractor-475"><a href="#simple_extractor-475"><span class="linenos">475</span></a><span class="sd">    Args:</span>
</span><span id="simple_extractor-476"><a href="#simple_extractor-476"><span class="linenos">476</span></a><span class="sd">        trace (ndarray): The input signal trace or a Trace object.</span>
</span><span id="simple_extractor-477"><a href="#simple_extractor-477"><span class="linenos">477</span></a><span class="sd">        baseline (ndarray): The baseline of the trace.</span>
</span><span id="simple_extractor-478"><a href="#simple_extractor-478"><span class="linenos">478</span></a><span class="sd">        event_coordinates (ndarray): The coordinates of detected events.</span>
</span><span id="simple_extractor-479"><a href="#simple_extractor-479"><span class="linenos">479</span></a><span class="sd">        sample_rate (int | None): The sample rate of the trace. Has to be provided if trace is a ndarray. Default is None.</span>
</span><span id="simple_extractor-480"><a href="#simple_extractor-480"><span class="linenos">480</span></a><span class="sd">        feature_type (str): The output event features. Can be &#39;full&#39; for absolute features, &#39;FWHM&#39;, or &#39;FWQM&#39; for full</span>
</span><span id="simple_extractor-481"><a href="#simple_extractor-481"><span class="linenos">481</span></a><span class="sd">            width at half maximum or quarter maximum, respectively. These apply to duration, area, and peak amplitude.</span>
</span><span id="simple_extractor-482"><a href="#simple_extractor-482"><span class="linenos">482</span></a><span class="sd">            Default is &#39;full&#39;.</span>
</span><span id="simple_extractor-483"><a href="#simple_extractor-483"><span class="linenos">483</span></a><span class="sd">        label (str): The label for the Events object, if a Trace object is provided, that label takes precedence.</span>
</span><span id="simple_extractor-484"><a href="#simple_extractor-484"><span class="linenos">484</span></a><span class="sd">            Default is &#39;&#39;.</span>
</span><span id="simple_extractor-485"><a href="#simple_extractor-485"><span class="linenos">485</span></a>
</span><span id="simple_extractor-486"><a href="#simple_extractor-486"><span class="linenos">486</span></a><span class="sd">    Returns:</span>
</span><span id="simple_extractor-487"><a href="#simple_extractor-487"><span class="linenos">487</span></a><span class="sd">        Events: An Events object containing the extracted events and their features.</span>
</span><span id="simple_extractor-488"><a href="#simple_extractor-488"><span class="linenos">488</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="simple_extractor-489"><a href="#simple_extractor-489"><span class="linenos">489</span></a>
</span><span id="simple_extractor-490"><a href="#simple_extractor-490"><span class="linenos">490</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">Trace</span><span class="p">):</span>
</span><span id="simple_extractor-491"><a href="#simple_extractor-491"><span class="linenos">491</span></a>        <span class="n">label</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">trace</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">,</span> <span class="n">trace</span><span class="o">.</span><span class="n">trace</span>
</span><span id="simple_extractor-492"><a href="#simple_extractor-492"><span class="linenos">492</span></a>    <span class="k">if</span> <span class="n">sample_rate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="simple_extractor-493"><a href="#simple_extractor-493"><span class="linenos">493</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sample rate must be provided if trace is a ndarray.&quot;</span><span class="p">)</span>
</span><span id="simple_extractor-494"><a href="#simple_extractor-494"><span class="linenos">494</span></a>    <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
</span><span id="simple_extractor-495"><a href="#simple_extractor-495"><span class="linenos">495</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Trace and baseline must have the same shape.&quot;</span><span class="p">)</span>
</span><span id="simple_extractor-496"><a href="#simple_extractor-496"><span class="linenos">496</span></a>    <span class="k">if</span> <span class="n">feature_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="s1">&#39;FWHM&#39;</span><span class="p">,</span> <span class="s1">&#39;FWQM&#39;</span><span class="p">):</span>
</span><span id="simple_extractor-497"><a href="#simple_extractor-497"><span class="linenos">497</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Feature type must be &#39;full&#39;, &#39;FWHM&#39;, or &#39;FWQM&#39;.&quot;</span><span class="p">)</span>
</span><span id="simple_extractor-498"><a href="#simple_extractor-498"><span class="linenos">498</span></a>
</span><span id="simple_extractor-499"><a href="#simple_extractor-499"><span class="linenos">499</span></a>    <span class="c1"># Get view</span>
</span><span id="simple_extractor-500"><a href="#simple_extractor-500"><span class="linenos">500</span></a>    <span class="n">event_coordinates</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">longlong</span><span class="p">[:,</span> <span class="p">::</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">event_coordinates</span><span class="p">)</span>
</span><span id="simple_extractor-501"><a href="#simple_extractor-501"><span class="linenos">501</span></a>
</span><span id="simple_extractor-502"><a href="#simple_extractor-502"><span class="linenos">502</span></a>    <span class="c1"># Baseline adjust the trace</span>
</span><span id="simple_extractor-503"><a href="#simple_extractor-503"><span class="linenos">503</span></a>    <span class="n">adjusted</span> <span class="o">=</span> <span class="n">trace</span> <span class="o">-</span> <span class="n">baseline</span>
</span><span id="simple_extractor-504"><a href="#simple_extractor-504"><span class="linenos">504</span></a>
</span><span id="simple_extractor-505"><a href="#simple_extractor-505"><span class="linenos">505</span></a>
</span><span id="simple_extractor-506"><a href="#simple_extractor-506"><span class="linenos">506</span></a>    <span class="n">event_number</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">Py_ssize_t</span> <span class="o">=</span> <span class="n">event_coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="simple_extractor-507"><a href="#simple_extractor-507"><span class="linenos">507</span></a>    <span class="k">if</span> <span class="n">event_number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="simple_extractor-508"><a href="#simple_extractor-508"><span class="linenos">508</span></a>        <span class="k">return</span> <span class="n">Events</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">{},</span> <span class="n">feature_type</span><span class="p">)</span>
</span><span id="simple_extractor-509"><a href="#simple_extractor-509"><span class="linenos">509</span></a>
</span><span id="simple_extractor-510"><a href="#simple_extractor-510"><span class="linenos">510</span></a>    <span class="n">events</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="simple_extractor-511"><a href="#simple_extractor-511"><span class="linenos">511</span></a>    <span class="n">event_id</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">Py_ssize_t</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="simple_extractor-512"><a href="#simple_extractor-512"><span class="linenos">512</span></a>    <span class="k">for</span> <span class="n">event_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">event_number</span><span class="p">):</span>
</span><span id="simple_extractor-513"><a href="#simple_extractor-513"><span class="linenos">513</span></a>        <span class="n">vector</span> <span class="o">=</span> <span class="n">adjusted</span><span class="p">[</span><span class="n">event_coordinates</span><span class="p">[</span><span class="n">event_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span><span class="n">event_coordinates</span><span class="p">[</span><span class="n">event_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="simple_extractor-514"><a href="#simple_extractor-514"><span class="linenos">514</span></a>
</span><span id="simple_extractor-515"><a href="#simple_extractor-515"><span class="linenos">515</span></a>        <span class="n">abs_vector</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</span><span id="simple_extractor-516"><a href="#simple_extractor-516"><span class="linenos">516</span></a>        <span class="c1"># Different feature types</span>
</span><span id="simple_extractor-517"><a href="#simple_extractor-517"><span class="linenos">517</span></a>        <span class="k">if</span> <span class="n">feature_type</span> <span class="o">==</span> <span class="s1">&#39;FWHM&#39;</span><span class="p">:</span>
</span><span id="simple_extractor-518"><a href="#simple_extractor-518"><span class="linenos">518</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">abs_vector</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="simple_extractor-519"><a href="#simple_extractor-519"><span class="linenos">519</span></a>            <span class="n">vec</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span><span class="n">abs_vector</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">]</span>
</span><span id="simple_extractor-520"><a href="#simple_extractor-520"><span class="linenos">520</span></a>        <span class="k">elif</span> <span class="n">feature_type</span> <span class="o">==</span> <span class="s1">&#39;FWQM&#39;</span><span class="p">:</span>
</span><span id="simple_extractor-521"><a href="#simple_extractor-521"><span class="linenos">521</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">abs_vector</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span>
</span><span id="simple_extractor-522"><a href="#simple_extractor-522"><span class="linenos">522</span></a>            <span class="n">vec</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span><span class="n">abs_vector</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">]</span>
</span><span id="simple_extractor-523"><a href="#simple_extractor-523"><span class="linenos">523</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="simple_extractor-524"><a href="#simple_extractor-524"><span class="linenos">524</span></a>            <span class="n">vec</span> <span class="o">=</span> <span class="n">vector</span>
</span><span id="simple_extractor-525"><a href="#simple_extractor-525"><span class="linenos">525</span></a>
</span><span id="simple_extractor-526"><a href="#simple_extractor-526"><span class="linenos">526</span></a>        <span class="n">events</span><span class="p">[</span><span class="n">event_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="simple_extractor-527"><a href="#simple_extractor-527"><span class="linenos">527</span></a>            <span class="s1">&#39;ID&#39;</span><span class="p">:</span> <span class="n">event_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="simple_extractor-528"><a href="#simple_extractor-528"><span class="linenos">528</span></a>            <span class="s1">&#39;Coordinates&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">event_coordinates</span><span class="p">[</span><span class="n">event_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">event_coordinates</span><span class="p">[</span><span class="n">event_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
</span><span id="simple_extractor-529"><a href="#simple_extractor-529"><span class="linenos">529</span></a>            <span class="s1">&#39;Vector&#39;</span><span class="p">:</span> <span class="n">vector</span><span class="p">,</span>
</span><span id="simple_extractor-530"><a href="#simple_extractor-530"><span class="linenos">530</span></a>            <span class="s1">&#39;Direction&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span> <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sign</span><span class="p">(</span><span class="n">vector</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;down&#39;</span><span class="p">,</span>
</span><span id="simple_extractor-531"><a href="#simple_extractor-531"><span class="linenos">531</span></a>            <span class="s1">&#39;Amplitude&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">vec</span><span class="p">)),</span>
</span><span id="simple_extractor-532"><a href="#simple_extractor-532"><span class="linenos">532</span></a>            <span class="s1">&#39;Duration&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span> <span class="o">/</span> <span class="n">sample_rate</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span>
</span><span id="simple_extractor-533"><a href="#simple_extractor-533"><span class="linenos">533</span></a>            <span class="s1">&#39;Area&#39;</span><span class="p">:</span> <span class="n">simpson</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">vec</span><span class="p">))</span> <span class="o">/</span> <span class="n">sample_rate</span><span class="p">,</span>
</span><span id="simple_extractor-534"><a href="#simple_extractor-534"><span class="linenos">534</span></a>            <span class="s1">&#39;Outlier&#39;</span><span class="p">:</span> <span class="kc">False</span>
</span><span id="simple_extractor-535"><a href="#simple_extractor-535"><span class="linenos">535</span></a>        <span class="p">}</span>
</span><span id="simple_extractor-536"><a href="#simple_extractor-536"><span class="linenos">536</span></a>
</span><span id="simple_extractor-537"><a href="#simple_extractor-537"><span class="linenos">537</span></a>    <span class="k">return</span> <span class="n">Events</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">feature_type</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extract the events from the trace based on the event coordinates and the baseline. Then, simple features are
calculated for each event. Duration is always in ms, while area and amplitude are in the same units as the trace.
That is, if the trace is in pA, we have pC and pA for area and amplitude, respectively.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>trace (ndarray):</strong>  The input signal trace or a Trace object.</li>
<li><strong>baseline (ndarray):</strong>  The baseline of the trace.</li>
<li><strong>event_coordinates (ndarray):</strong>  The coordinates of detected events.</li>
<li><strong>sample_rate (int | None):</strong>  The sample rate of the trace. Has to be provided if trace is a ndarray. Default is None.</li>
<li><strong>feature_type (str):</strong>  The output event features. Can be 'full' for absolute features, 'FWHM', or 'FWQM' for full
width at half maximum or quarter maximum, respectively. These apply to duration, area, and peak amplitude.
Default is 'full'.</li>
<li><strong>label (str):</strong>  The label for the Events object, if a Trace object is provided, that label takes precedence.
Default is ''.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Events: An Events object containing the extracted events and their features.</p>
</blockquote>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>